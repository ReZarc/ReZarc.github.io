<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="&#x2F;&#x2F;（因为没人看所以防丢）">
<meta property="og:type" content="article">
<meta property="og:title" content="自用板子">
<meta property="og:url" content="http://example.com/2021/08/23/%E6%9D%BF%E5%AD%90/index.html">
<meta property="og:site_name" content="Rezarc&#39;s Blog">
<meta property="og:description" content="&#x2F;&#x2F;（因为没人看所以防丢）">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://img-blog.csdnimg.cn/74206d05451840c5a0a8d30e29841a87.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5by65bC85Y2h5LuA,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/0184dafc677c40eeb7e2381fe3d42da9.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5by65bC85Y2h5LuA,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/365e574f969b44cdaeb3178d16b8aef2.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5by65bC85Y2h5LuA,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/2448af2c68224956b114971c02f61f59.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5by65bC85Y2h5LuA,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center">
<meta property="article:published_time" content="2021-08-23T04:15:52.000Z">
<meta property="article:modified_time" content="2022-07-31T03:17:51.703Z">
<meta property="article:author" content="Reza Kung">
<meta property="article:tag" content="基础算法">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img-blog.csdnimg.cn/74206d05451840c5a0a8d30e29841a87.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5by65bC85Y2h5LuA,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center">

<link rel="canonical" href="http://example.com/2021/08/23/%E6%9D%BF%E5%AD%90/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>自用板子 | Rezarc's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}</style></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Rezarc's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">HELLO WORLD</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>日程表</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a>

  </li>
        <li class="menu-item menu-item-links">

    <a href="/links/" rel="section"><i class="link fa-fw"></i>友链</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/08/23/%E6%9D%BF%E5%AD%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Reza Kung">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rezarc's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          自用板子
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-08-23 12:15:52" itemprop="dateCreated datePublished" datetime="2021-08-23T12:15:52+08:00">2021-08-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-07-31 11:17:51" itemprop="dateModified" datetime="2022-07-31T11:17:51+08:00">2022-07-31</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.4k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>//（因为没人看所以防丢）<br><span id="more"></span></p>
<p>[TOC]</p>
<h1 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h1><h2 id="并查集"><a href="#并查集" class="headerlink" title="并查集"></a>并查集</h2><h3 id="1-朴素并查集："><a href="#1-朴素并查集：" class="headerlink" title="(1)朴素并查集："></a>(1)朴素并查集：</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> p[N]; <span class="comment">//存储每个点的祖宗节点</span></span><br><span class="line"><span class="comment">// 返回x的祖宗节点</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">   <span class="keyword">return</span> p[x] == x ? x : p[x] = <span class="built_in">find</span>(p[x]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 初始化，假定节点编号是1~n</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i ++ ) p[i] = i;</span><br><span class="line"><span class="comment">// 合并a和b所在的两个集合：</span></span><br><span class="line">p[<span class="built_in">find</span>(a)] = <span class="built_in">find</span>(b);</span><br></pre></td></tr></table></figure>
<h3 id="2-维护size的并查集："><a href="#2-维护size的并查集：" class="headerlink" title="(2)维护size的并查集："></a>(2)维护size的并查集：</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> p[N], size[N];</span><br><span class="line"><span class="comment">//p[]存储每个点的祖宗节点, size[]只有祖宗节点的有意义，表示祖宗节点所在集合中的点的数量</span></span><br><span class="line"><span class="comment">// 返回x的祖宗节点</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">   <span class="keyword">return</span> p[x] == x ? x : p[x] = <span class="built_in">find</span>(p[x]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 初始化，假定节点编号是1~n</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i ++ )&#123;</span><br><span class="line">   p[i] = i;</span><br><span class="line">   size[i] = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 合并a和b所在的两个集合：</span></span><br><span class="line">size[<span class="built_in">find</span>(b)] + =  size[<span class="built_in">find</span>(a)];</span><br><span class="line">p[<span class="built_in">find</span>(a)] = <span class="built_in">find</span>(b);</span><br></pre></td></tr></table></figure>
<h3 id="3-维护到祖宗节点距离的并查集："><a href="#3-维护到祖宗节点距离的并查集：" class="headerlink" title="(3)维护到祖宗节点距离的并查集："></a>(3)维护到祖宗节点距离的并查集：</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> p[N], d[N];</span><br><span class="line"><span class="comment">//p[]存储每个点的祖宗节点, d[x]存储x到p[x]的距离</span></span><br><span class="line"><span class="comment">// 返回x的祖宗节点</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">   <span class="keyword">return</span> p[x] == x ? x : p[x] = <span class="built_in">find</span>(p[x]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 初始化，假定节点编号是1~n</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i ++ )&#123;</span><br><span class="line">   p[i] = i; d[i] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 合并a和b所在的两个集合：</span></span><br><span class="line">p[<span class="built_in">find</span>(a)] = <span class="built_in">find</span>(b);</span><br><span class="line">d[<span class="built_in">find</span>(a)] = distance; <span class="comment">// 根据具体问题，初始化find(a)的偏移量</span></span><br></pre></td></tr></table></figure>
<h2 id="堆"><a href="#堆" class="headerlink" title="堆"></a>堆</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// h[N]存储堆中的值, h[1]是堆顶，x的左儿子是2x, 右儿子是2x + 1</span></span><br><span class="line"><span class="comment">// ph[k]存储第k个插入的点在堆中的位置</span></span><br><span class="line"><span class="comment">// hp[k]存储堆中下标是k的点是第几个插入的</span></span><br><span class="line"><span class="keyword">int</span> h[N], ph[N], hp[N], size;</span><br><span class="line"><span class="comment">// 交换两个点，及其映射关系</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">heap_swap</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">  <span class="built_in">swap</span>(ph[hp[a]],ph[hp[b]]);</span><br><span class="line">  <span class="built_in">swap</span>(hp[a], hp[b]);</span><br><span class="line">  <span class="built_in">swap</span>(h[a], h[b]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">down</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> t = u;</span><br><span class="line">  <span class="keyword">if</span> (u * <span class="number">2</span> &lt;= size &amp;&amp; h[u * <span class="number">2</span>] &lt; h[t]) t = u * <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">if</span> (u * <span class="number">2</span> + <span class="number">1</span> &lt;= size &amp;&amp; h[u * <span class="number">2</span> + <span class="number">1</span>] &lt; h[t]) t = u * <span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> (u != t)&#123;</span><br><span class="line">     <span class="built_in">heap_swap</span>(u, t);</span><br><span class="line">     <span class="built_in">down</span>(t);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">up</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;</span><br><span class="line">  <span class="keyword">while</span> (u / <span class="number">2</span> &amp;&amp; h[u] &lt; h[u / <span class="number">2</span>])&#123;</span><br><span class="line">      <span class="built_in">heap_swap</span>(u, u / <span class="number">2</span>);</span><br><span class="line">     u &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// O(n)建堆</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = n / <span class="number">2</span>; i; i -- ) <span class="built_in">down</span>(i);</span><br></pre></td></tr></table></figure>
<p>priority_queue<int,vector<int>, greater<int>&gt; q; //小根堆</p>
<p>priority_queue<int> q; //大根堆</p>
<h2 id="线段树"><a href="#线段树" class="headerlink" title="线段树"></a>线段树</h2><h3 id="pushup-amp-amp-pushdown-类"><a href="#pushup-amp-amp-pushdown-类" class="headerlink" title="pushup &amp;&amp; pushdown 类"></a>pushup &amp;&amp; pushdown 类</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> i)</span></span>&#123;e[i].w = e[lc].w + e[rc].w;&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(<span class="keyword">int</span> i)</span></span>&#123;</span><br><span class="line">    e[lc].f += e[i].f;</span><br><span class="line">    e[rc].f += e[i].f;</span><br><span class="line">    e[lc].w += e[i].f * (e[lc].r - e[lc].l + <span class="number">1</span>);</span><br><span class="line">    e[rc].w += e[i].f * (e[rc].r - e[rc].l + <span class="number">1</span>);</span><br><span class="line">    e[i].f = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="建树-类"><a href="#建树-类" class="headerlink" title="建树 类"></a>建树 类</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">    e[i].l = l, e[i].r = r;</span><br><span class="line">    <span class="keyword">if</span>(l == r)&#123;</span><br><span class="line">        cin &gt;&gt; e[i].w;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">build</span>(lc, l, mid); <span class="built_in">build</span>(rc, mid + <span class="number">1</span>, r);</span><br><span class="line">    <span class="built_in">pushup</span>(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="单点修改-类"><a href="#单点修改-类" class="headerlink" title="单点修改 类"></a>单点修改 类</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">modify</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> p, ll v)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(tr[u].l == tr[u].r &amp;&amp; tr[u].l == p) tr[u].d += v, tr[u].v += v;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">int</span> mid = tr[u].l + tr[u].r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(p &lt;= mid) <span class="built_in">modify</span>(u &lt;&lt; <span class="number">1</span>, p, v);</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">modify</span>(u &lt;&lt; <span class="number">1</span> | <span class="number">1</span>, p, v);</span><br><span class="line">        <span class="built_in">pushup</span>(u);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="区间求和-类"><a href="#区间求和-类" class="headerlink" title="区间求和 类"></a>区间求和 类</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">change</span><span class="params">(<span class="keyword">int</span> i,<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(e[i].l &gt;= l &amp;&amp; e[i].r &lt;= r)&#123;</span><br><span class="line">        e[i].w += x * (e[i].r - e[i].l + <span class="number">1</span>);</span><br><span class="line">        e[i].f += x;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(e[i].f) <span class="built_in">pushdown</span>(i);</span><br><span class="line">    <span class="keyword">int</span> mid = e[i].l + e[i].r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(l &lt;= mid) <span class="built_in">change</span>(lc, l, r, x);</span><br><span class="line">    <span class="keyword">if</span>(r &gt; mid) <span class="built_in">change</span>(rc, l, r, x);</span><br><span class="line">    <span class="built_in">pushup</span>(i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="区间查询-类"><a href="#区间查询-类" class="headerlink" title="区间查询 类"></a>区间查询 类</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(e[i].l &gt;= l &amp;&amp; e[i].r &lt;= r) <span class="keyword">return</span> e[i].w;</span><br><span class="line">    <span class="keyword">if</span>(e[i].f) <span class="built_in">pushdown</span>(i);</span><br><span class="line">    <span class="keyword">int</span> mid = e[i].l + e[i].r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(l &lt;= mid) ans += <span class="built_in">query</span>(lc, l, r);</span><br><span class="line">    <span class="keyword">if</span>(r &gt; mid) ans += <span class="built_in">query</span>(rc, l, r);</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="扫描线-类"><a href="#扫描线-类" class="headerlink" title="扫描线 类"></a>扫描线 类</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> endl <span class="meta-string">&quot;\n&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ff double</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lc i &lt;&lt; 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rc i &lt;&lt; 1 | 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> all(x) x.begin(), x.end()</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mem(a, b) memset(a, b, sizeof a)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rep(i, a, b) for(int i = (int)a; i &lt;= (int)b; i ++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> per(i, a, b) for(int i = (int)a; i &gt;= (int)b; i --)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IOS ios::sync_with_stdio(0); cin.tie(0); cout.tie(0)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> ff eps = <span class="number">1e-8</span>;</span><br><span class="line"><span class="keyword">int</span> n, T;</span><br><span class="line">vector&lt;ff&gt; ys;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sgn</span><span class="params">(ff x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">fabs</span>(x) &lt; eps) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(x &lt; <span class="number">0</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(ff x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">lower_bound</span>(<span class="built_in">all</span>(ys), x) - ys.<span class="built_in">begin</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">seg</span> &#123;</span></span><br><span class="line">    ff x, y1, y2;</span><br><span class="line">    <span class="keyword">int</span> add;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> seg &amp;a) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sgn</span>(x - a.x) &lt; <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;seg[N &lt;&lt; <span class="number">1</span>];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> l, r, f;</span><br><span class="line">    ff len;</span><br><span class="line">&#125;tr[N &lt;&lt; <span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(tr[i].f) &#123;</span><br><span class="line">        tr[i].len = ys[tr[i].r + <span class="number">1</span>] - ys[tr[i].l];</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(tr[i].l != tr[i].r) &#123;</span><br><span class="line">        tr[i].len = tr[lc].len + tr[rc].len;</span><br><span class="line">    &#125; <span class="keyword">else</span> tr[i].len = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">    tr[i] = &#123;l, r&#125;;</span><br><span class="line">    <span class="keyword">if</span>(l == r) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="keyword">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">build</span>(lc, l, mid); <span class="built_in">build</span>(rc, mid + <span class="number">1</span>, r);</span><br><span class="line">    <span class="built_in">pushup</span>(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">modify</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l &lt;= tr[i].l &amp;&amp; tr[i].r &lt;= r) &#123;</span><br><span class="line">        tr[i].f += x;</span><br><span class="line">        <span class="built_in">pushup</span>(i);</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> mid = tr[i].l + tr[i].r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(l &lt;= mid) <span class="built_in">modify</span>(lc, l, r, x);</span><br><span class="line">    <span class="keyword">if</span>(mid &lt; r) <span class="built_in">modify</span>(rc, l, r, x);</span><br><span class="line">    <span class="built_in">pushup</span>(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(cin &gt;&gt; n &amp;&amp; n) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Test case #%lld\n&quot;</span>, ++ T);</span><br><span class="line">        ys.<span class="built_in">clear</span>();</span><br><span class="line">        ff x1, x2, y1, y2;</span><br><span class="line">        <span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">rep</span>(i, <span class="number">1</span>, n) &#123;</span><br><span class="line">            cin &gt;&gt; x1 &gt;&gt; y1 &gt;&gt; x2 &gt;&gt; y2;      <span class="comment">//存下来入边和边长//入边为1                  </span></span><br><span class="line">            seg[cnt ++] = &#123;x1, y1, y2, <span class="number">1</span>&#125;;    <span class="comment">//存下来出边和边长//出边为-1              </span></span><br><span class="line">            seg[cnt ++] = &#123;x2, y1, y2, <span class="number">-1</span>&#125;;   <span class="comment">//存四边形的上下边界              </span></span><br><span class="line">            ys.<span class="built_in">pb</span>(y1); ys.<span class="built_in">pb</span>(y2);                   </span><br><span class="line">        &#125;                   </span><br><span class="line">        <span class="built_in">sort</span>(<span class="built_in">all</span>(ys));                          <span class="comment">//对上下边排序</span></span><br><span class="line">        ys.<span class="built_in">erase</span>(<span class="built_in">unique</span>(<span class="built_in">all</span>(ys)), ys.<span class="built_in">end</span>());    <span class="comment">//去掉重复的边                </span></span><br><span class="line">        <span class="built_in">build</span>(<span class="number">1</span>, <span class="number">0</span>, ys.<span class="built_in">size</span>() - <span class="number">2</span>);             <span class="comment">//建树    </span></span><br><span class="line">        <span class="built_in">sort</span>(seg, seg + (n &lt;&lt; <span class="number">1</span>));              <span class="comment">//按照坐标轴排序    </span></span><br><span class="line">        ff ans = <span class="number">0</span>;                 </span><br><span class="line">        <span class="built_in">rep</span>(i, <span class="number">0</span>, (n &lt;&lt; <span class="number">1</span>) - <span class="number">1</span>) &#123;                   </span><br><span class="line">            <span class="keyword">if</span>(i &gt; <span class="number">0</span>) ans += tr[<span class="number">1</span>].len * (seg[i].x - seg[i - <span class="number">1</span>].x);   <span class="comment">//循环第一次修改边长，然后再求</span></span><br><span class="line">            <span class="built_in">modify</span>(<span class="number">1</span>, <span class="built_in">find</span>(seg[i].y1), <span class="built_in">find</span>(seg[i].y2) - <span class="number">1</span>, seg[i].add);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Total explored area: %.2lf\n\n&quot;</span>, ans);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h3><h4 id="Luogu-P2572-SCOI2010-序列操作"><a href="#Luogu-P2572-SCOI2010-序列操作" class="headerlink" title="Luogu P2572 [SCOI2010] 序列操作"></a>Luogu P2572 [SCOI2010] 序列操作</h4><ul>
<li><code>0 l r</code> 把 [l, r] 区间内的所有数全变成 0</li>
<li><code>1 l r</code> 把 [l, r] 区间内的所有数全变成 1</li>
<li><code>2 l r</code> 把 [l, r] 区间内的所有数全部取反，也就是说把所有的 0 变成 1，把所有的 1 变成 0</li>
<li><code>3 l r</code> 询问 [l, r] 区间内总共有多少个 1</li>
<li><code>4 l r</code> 询问 [l, r] 区间内最多有多少个连续的 1</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*0 1 用一个懒标记 f 维护，区间取反用懒标记 rev 维护，询问有多少个 1 用 cnt1 和 cnt0 维护，有多少个连续的 1 用lcon, rcon 和 mcon维护 0 和 1 ，取反时将所有 0/1 维护的值来交换。*/</span></span><br><span class="line"><span class="comment">/*想倒是不难想，写起来司马。*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> endl <span class="meta-string">&quot;\n&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ff double</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lc i &lt;&lt; 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rc i &lt;&lt; 1 | 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mem(a, b) memset(a, b, sizeof a)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rep(i, a, b) for(int i = (int)a; i &lt;= (int)b; i ++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> per(i, a, b) for(int i = (int)a; i &gt;= (int)b; i --)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IOS ios::sync_with_stdio(0); cin.tie(0); cout.tie(0)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">int</span> n, m;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> l, r, cnt1, cnt0, f, rev;</span><br><span class="line">    <span class="keyword">int</span> lcon1, rcon1, mcon1;</span><br><span class="line">    <span class="keyword">int</span> lcon0, rcon0, mcon0;</span><br><span class="line">&#125;tr[N &lt;&lt; <span class="number">2</span>];</span><br><span class="line"><span class="keyword">int</span> a[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    tr[i].cnt1 = tr[lc].cnt1 + tr[rc].cnt1;</span><br><span class="line">    tr[i].cnt0 = tr[lc].cnt0 + tr[rc].cnt0;</span><br><span class="line">    tr[i].lcon1 = tr[lc].lcon1; tr[i].lcon0 = tr[lc].lcon0; </span><br><span class="line">    tr[i].rcon1 = tr[rc].rcon1; tr[i].rcon0 = tr[rc].rcon0;</span><br><span class="line">    <span class="keyword">if</span>(tr[lc].lcon1 == tr[lc].r - tr[lc].l + <span class="number">1</span>) tr[i].lcon1 += tr[rc].lcon1;</span><br><span class="line">    <span class="keyword">if</span>(tr[rc].rcon1 == tr[rc].r - tr[rc].l + <span class="number">1</span>) tr[i].rcon1 += tr[lc].rcon1;</span><br><span class="line">    <span class="keyword">if</span>(tr[lc].lcon0 == tr[lc].r - tr[lc].l + <span class="number">1</span>) tr[i].lcon0 += tr[rc].lcon0;</span><br><span class="line">    <span class="keyword">if</span>(tr[rc].rcon0 == tr[rc].r - tr[rc].l + <span class="number">1</span>) tr[i].rcon0 += tr[lc].rcon0;</span><br><span class="line">    tr[i].mcon1 = <span class="built_in">max</span>(&#123;tr[lc].mcon1, tr[rc].mcon1, tr[lc].rcon1 + tr[rc].lcon1&#125;);</span><br><span class="line">    tr[i].mcon0 = <span class="built_in">max</span>(&#123;tr[lc].mcon0, tr[rc].mcon0, tr[lc].rcon0 + tr[rc].lcon0&#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(tr[i].f != <span class="number">-1</span>) &#123;</span><br><span class="line">        tr[lc].cnt1 = (tr[lc].r - tr[lc].l + <span class="number">1</span>) * tr[i].f; </span><br><span class="line">        tr[rc].cnt1 = (tr[rc].r - tr[rc].l + <span class="number">1</span>) * tr[i].f; </span><br><span class="line">        tr[lc].cnt0 = (tr[lc].r - tr[lc].l + <span class="number">1</span>) - tr[lc].cnt1; </span><br><span class="line">        tr[rc].cnt0 = (tr[rc].r - tr[rc].l + <span class="number">1</span>) - tr[rc].cnt1; </span><br><span class="line">        tr[lc].lcon1 = tr[lc].rcon1 = tr[lc].mcon1 = tr[lc].cnt1;</span><br><span class="line">        tr[rc].lcon1 = tr[rc].rcon1 = tr[rc].mcon1 = tr[rc].cnt1;</span><br><span class="line">        tr[lc].lcon0 = tr[lc].rcon0 = tr[lc].mcon0 = tr[lc].cnt0;</span><br><span class="line">        tr[rc].lcon0 = tr[rc].rcon0 = tr[rc].mcon0 = tr[rc].cnt0;</span><br><span class="line">        tr[lc].f = tr[rc].f = tr[i].f;</span><br><span class="line">        tr[lc].rev = tr[rc].rev = tr[i].rev = <span class="number">0</span>;</span><br><span class="line">        tr[i].f = <span class="number">-1</span>; </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">if</span>(tr[i].rev) &#123;</span><br><span class="line">        <span class="built_in">swap</span>(tr[lc].cnt0, tr[lc].cnt1); <span class="built_in">swap</span>(tr[rc].cnt0, tr[rc].cnt1); </span><br><span class="line">        <span class="built_in">swap</span>(tr[lc].mcon0, tr[lc].mcon1); <span class="built_in">swap</span>(tr[rc].mcon0, tr[rc].mcon1); </span><br><span class="line">        <span class="built_in">swap</span>(tr[lc].lcon0, tr[lc].lcon1); <span class="built_in">swap</span>(tr[rc].lcon0, tr[rc].lcon1); </span><br><span class="line">        <span class="built_in">swap</span>(tr[lc].rcon0, tr[lc].rcon1); <span class="built_in">swap</span>(tr[rc].rcon0, tr[rc].rcon1); </span><br><span class="line">        <span class="keyword">if</span>(tr[lc].f != <span class="number">-1</span>) tr[lc].f ^= <span class="number">1</span>; <span class="keyword">else</span> tr[lc].rev ^= <span class="number">1</span>; </span><br><span class="line">        <span class="keyword">if</span>(tr[rc].f != <span class="number">-1</span>) tr[rc].f ^= <span class="number">1</span>; <span class="keyword">else</span> tr[rc].rev ^= <span class="number">1</span>; </span><br><span class="line">        tr[i].rev = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">    tr[i].l = l; tr[i].r = r; tr[i].f = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">if</span>(l == r) &#123;</span><br><span class="line">        tr[i].cnt1 = a[l]; </span><br><span class="line">        tr[i].cnt0 = a[l] ^ <span class="number">1</span>;</span><br><span class="line">        tr[i].rcon1 = tr[i].lcon1 = tr[i].mcon1 = tr[i].cnt1;</span><br><span class="line">        tr[i].rcon0 = tr[i].lcon0 = tr[i].mcon0 = tr[i].cnt0;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">build</span>(lc, l, mid); <span class="built_in">build</span>(rc, mid + <span class="number">1</span>, r);</span><br><span class="line">    <span class="built_in">pushup</span>(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">modify</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l &lt;= tr[i].l &amp;&amp; tr[i].r &lt;= r) &#123;</span><br><span class="line">        tr[i].cnt1 = (tr[i].r - tr[i].l + <span class="number">1</span>) * x;</span><br><span class="line">        tr[i].cnt0 = (tr[i].r - tr[i].l + <span class="number">1</span>) - tr[i].cnt1;</span><br><span class="line">        tr[i].lcon0 = tr[i].rcon0 = tr[i].mcon0 = tr[i].cnt0;</span><br><span class="line">        tr[i].lcon1 = tr[i].rcon1 = tr[i].mcon1 = tr[i].cnt1;</span><br><span class="line">        tr[i].f = x; <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">pushdown</span>(i);</span><br><span class="line">    <span class="keyword">int</span> mid = tr[i].l + tr[i].r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(l &lt;= mid) <span class="built_in">modify</span>(lc, l, r, x);</span><br><span class="line">    <span class="keyword">if</span>(mid &lt; r) <span class="built_in">modify</span>(rc, l, r, x);</span><br><span class="line">    <span class="built_in">pushup</span>(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">revers</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">pushdown</span>(i);</span><br><span class="line">    <span class="keyword">if</span>(tr[i].l == l &amp;&amp; tr[i].r == r)&#123;</span><br><span class="line">        <span class="built_in">swap</span>(tr[i].cnt0, tr[i].cnt1);</span><br><span class="line">        <span class="built_in">swap</span>(tr[i].mcon0, tr[i].mcon1);</span><br><span class="line">        <span class="built_in">swap</span>(tr[i].lcon0, tr[i].lcon1);</span><br><span class="line">        <span class="built_in">swap</span>(tr[i].rcon0, tr[i].rcon1);</span><br><span class="line">        tr[i].rev ^= <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> mid = tr[i].l + tr[i].r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(mid &lt; l) <span class="built_in">revers</span>(rc, l, r);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(mid &gt;= r) <span class="built_in">revers</span>(lc, l, r);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">revers</span>(lc, l, mid); <span class="built_in">revers</span>(rc, mid + <span class="number">1</span>, r);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">pushup</span>(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l &lt;= tr[i].l &amp;&amp; tr[i].r &lt;= r) <span class="keyword">return</span> tr[i].cnt1;</span><br><span class="line">    <span class="built_in">pushdown</span>(i);</span><br><span class="line">    <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> mid = tr[i].l + tr[i].r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(l &lt;= mid) ans = <span class="built_in">query</span>(lc, l, r);</span><br><span class="line">    <span class="keyword">if</span>(mid &lt; r) ans += <span class="built_in">query</span>(rc, l, r);</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">node <span class="title">queryCon</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">pushdown</span>(i);</span><br><span class="line">    <span class="keyword">if</span>(tr[i].l == l &amp;&amp; tr[i].r == r) <span class="keyword">return</span> tr[i];</span><br><span class="line">    <span class="keyword">int</span> mid = tr[i].l + tr[i].r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(mid &lt; l) <span class="keyword">return</span> <span class="built_in">queryCon</span>(rc, l, r);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(mid &gt;= r) <span class="keyword">return</span> <span class="built_in">queryCon</span>(lc, l, r);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        node ans, Lc = <span class="built_in">queryCon</span>(lc, l, mid), Rc = <span class="built_in">queryCon</span>(rc, mid + <span class="number">1</span>, r);</span><br><span class="line">        ans.lcon1 = Lc.lcon1; ans.lcon0 = Lc.lcon0;</span><br><span class="line">        ans.rcon1 = Rc.rcon1; ans.rcon0 = Rc.rcon0;</span><br><span class="line">        <span class="keyword">if</span>(Lc.cnt1 == Lc.r - Lc.l + <span class="number">1</span>) ans.lcon1 += Rc.lcon1;</span><br><span class="line">        <span class="keyword">if</span>(Rc.cnt1 == Rc.r - Rc.l + <span class="number">1</span>) ans.rcon1 += Lc.rcon1;</span><br><span class="line">        <span class="keyword">if</span>(Lc.cnt0 == Lc.r - Lc.l + <span class="number">1</span>) ans.lcon0 += Rc.lcon0;</span><br><span class="line">        <span class="keyword">if</span>(Rc.cnt0 == Rc.r - Rc.l + <span class="number">1</span>) ans.rcon0 += Lc.rcon0;</span><br><span class="line">        ans.mcon1 = <span class="built_in">max</span>(&#123;Lc.rcon1 + Rc.lcon1, Lc.mcon1, Rc.mcon1&#125;);</span><br><span class="line">        ans.mcon0 = <span class="built_in">max</span>(&#123;Lc.rcon0 + Rc.lcon0, Lc.mcon0, Rc.mcon0&#125;);</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="built_in">rep</span>(i, <span class="number">1</span>, n) cin &gt;&gt; a[i];</span><br><span class="line">    <span class="built_in">build</span>(<span class="number">1</span>, <span class="number">1</span>, n);</span><br><span class="line">    <span class="keyword">while</span>(m --) &#123;</span><br><span class="line">        <span class="keyword">int</span> op, l, r;</span><br><span class="line">        cin &gt;&gt; op &gt;&gt; l &gt;&gt; r;</span><br><span class="line">        l ++; r ++;</span><br><span class="line">        <span class="keyword">if</span>(op == <span class="number">0</span>) <span class="built_in">modify</span>(<span class="number">1</span>, l, r, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(op == <span class="number">1</span>) <span class="built_in">modify</span>(<span class="number">1</span>, l, r, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(op == <span class="number">2</span>) <span class="built_in">revers</span>(<span class="number">1</span>, l, r);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(op == <span class="number">3</span>) cout &lt;&lt; <span class="built_in">query</span>(<span class="number">1</span>, l, r) &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">else</span> cout &lt;&lt; <span class="built_in">queryCon</span>(<span class="number">1</span>, l, r).mcon1 &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="最大子段和"><a href="#最大子段和" class="headerlink" title="最大子段和"></a>最大子段和</h4><ol>
<li><code>1 x y</code>，查询区间 $[x,y]$中的最大连续子段和。</li>
<li><code>2 x y</code>，把 $A[x]$ 改成 $y$。</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lc i &lt;&lt; 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rc i &lt;&lt; 1 | 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(x) cout &lt;&lt; x &lt;&lt; endl</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mem(a, b) memset(a,b,sizeof(a))</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">5e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> l,r;</span><br><span class="line">    <span class="keyword">int</span> tmax, lmax, rmax, sum;</span><br><span class="line">&#125;e[N &lt;&lt; <span class="number">2</span>];</span><br><span class="line"><span class="keyword">int</span> n, m, w[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(node &amp;i, node &amp;l,node &amp;r)</span></span>&#123;</span><br><span class="line">    i.sum = l.sum + r.sum;</span><br><span class="line">    i.lmax = <span class="built_in">max</span>(l.lmax, l.sum + r.lmax);</span><br><span class="line">    i.rmax = <span class="built_in">max</span>(r.rmax, r.sum + l.rmax);</span><br><span class="line">    i.tmax = <span class="built_in">max</span>(<span class="built_in">max</span>(l.tmax, r.tmax), l.rmax + r.lmax);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> i)</span></span>&#123;</span><br><span class="line">    <span class="built_in">pushup</span>(e[i], e[lc], e[rc]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">    e[i] = &#123;l, r&#125;;</span><br><span class="line">    <span class="keyword">if</span>(l == r)&#123;</span><br><span class="line">        e[i].tmax = e[i].lmax = e[i].rmax = e[i].sum = w[l];</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">build</span>(lc, l, mid); <span class="built_in">build</span>(rc, mid + <span class="number">1</span>, r);</span><br><span class="line">    <span class="built_in">pushup</span>(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">node <span class="title">query</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l &lt;= e[i].l &amp;&amp; e[i].r &lt;= r) <span class="keyword">return</span> e[i];</span><br><span class="line">    <span class="keyword">int</span> mid = e[i].l + e[i].r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(r &lt;= mid) <span class="keyword">return</span> <span class="built_in">query</span>(lc, l, r);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(l &gt; mid) <span class="keyword">return</span> <span class="built_in">query</span>(rc, l, r);</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        node ans;</span><br><span class="line">        node lf = <span class="built_in">query</span>(lc, l, r);</span><br><span class="line">        node rt = <span class="built_in">query</span>(rc, l, r);</span><br><span class="line">        <span class="built_in">pushup</span>(ans, lf, rt);</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">modify</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> x, <span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(e[i].l == e[i].r &amp;&amp; e[i].l == x)&#123;</span><br><span class="line">        e[i] = &#123;x, x, v, v, v, v&#125;;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> mid = e[i].l + e[i].r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(x &lt;= mid) <span class="built_in">modify</span>(lc, x, v);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">modify</span>(rc, x, v);</span><br><span class="line">    <span class="built_in">pushup</span>(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i ++) cin &gt;&gt; w[i];</span><br><span class="line">    <span class="built_in">build</span>(<span class="number">1</span>, <span class="number">1</span>, n);</span><br><span class="line">    <span class="keyword">while</span>(m --)&#123;</span><br><span class="line">        <span class="keyword">int</span> op, x, y;</span><br><span class="line">        cin &gt;&gt; op &gt;&gt; x &gt;&gt; y;</span><br><span class="line">        <span class="keyword">if</span>(op == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(x &gt; y) <span class="built_in">swap</span>(x, y);</span><br><span class="line">            cout &lt;&lt; <span class="built_in">query</span>(<span class="number">1</span>, x, y).tmax &lt;&lt; endl;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">modify</span>(<span class="number">1</span>, x, y);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="线段树上差分"><a href="#线段树上差分" class="headerlink" title="线段树上差分"></a>线段树上差分</h4><ul>
<li><p>若 $q=1$，则表示 SCV 在 $[l, r]$ 这段区间布上一种地雷；</p>
</li>
<li><p>若 $q=2$，则表示小 FF 询问当前 $[l, r]$ 区间总共有多少种地雷。</p>
<p>  差分查询起点终点。</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> endl <span class="meta-string">&quot;\n&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ff double</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lc i &lt;&lt; 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rc i &lt;&lt; 1 | 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> all(x) x.begin(), x.end()</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mem(a, b) memset(a, b, sizeof a)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rep(i, a, b) for(int i = (int)a; i &lt;= (int)b; i ++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> per(i, a, b) for(int i = (int)a; i &gt;= (int)b; i --)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IOS ios::sync_with_stdio(0); cin.tie(0); cout.tie(0)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">int</span> n, m;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> l, r;</span><br><span class="line">    <span class="keyword">int</span> suml, sumr;</span><br><span class="line">&#125;tr[N &lt;&lt; <span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    tr[i].suml = tr[lc].suml + tr[rc].suml;</span><br><span class="line">    tr[i].sumr = tr[lc].sumr + tr[rc].sumr;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">    tr[i] = &#123;l, r&#125;;</span><br><span class="line">    <span class="keyword">if</span>(l == r) &#123;</span><br><span class="line">        tr[i].suml = tr[i].sumr = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">build</span>(lc, l, mid); <span class="built_in">build</span>(rc, mid + <span class="number">1</span>, r);</span><br><span class="line">    <span class="built_in">pushup</span>(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">modify1</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(tr[i].l == tr[i].r) &#123;</span><br><span class="line">        tr[i].suml ++; <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> mid = tr[i].l + tr[i].r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(x &lt;= mid) <span class="built_in">modify1</span>(lc, x);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">modify1</span>(rc, x);</span><br><span class="line">    <span class="built_in">pushup</span>(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">modify2</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(tr[i].l == tr[i].r) &#123;</span><br><span class="line">        tr[i].sumr ++; <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> mid = tr[i].l + tr[i].r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(x &lt;= mid) <span class="built_in">modify2</span>(lc, x);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">modify2</span>(rc, x);</span><br><span class="line">    <span class="built_in">pushup</span>(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query1</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l &lt;= tr[i].l &amp;&amp; tr[i].r &lt;= r) <span class="keyword">return</span> tr[i].suml;</span><br><span class="line">    <span class="keyword">int</span> mid = tr[i].l + tr[i].r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(l &lt;= mid) ans = <span class="built_in">query1</span>(lc, l, r);</span><br><span class="line">    <span class="keyword">if</span>(mid &lt; r) ans += <span class="built_in">query1</span>(rc, l, r);</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query2</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l &lt;= tr[i].l &amp;&amp; tr[i].r &lt;= r) <span class="keyword">return</span> tr[i].sumr;</span><br><span class="line">    <span class="keyword">int</span> mid = tr[i].l + tr[i].r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(l &lt;= mid) ans = <span class="built_in">query2</span>(lc, l, r);</span><br><span class="line">    <span class="keyword">if</span>(mid &lt; r) ans += <span class="built_in">query2</span>(rc, l, r);</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="built_in">build</span>(<span class="number">1</span>, <span class="number">1</span>, n);    </span><br><span class="line">    <span class="keyword">while</span>(m --) &#123;</span><br><span class="line">        <span class="keyword">int</span> op, l, r;</span><br><span class="line">        cin &gt;&gt; op &gt;&gt; l &gt;&gt; r;</span><br><span class="line">        <span class="keyword">if</span>(op == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="built_in">modify1</span>(<span class="number">1</span>, l); </span><br><span class="line">            <span class="built_in">modify2</span>(<span class="number">1</span>, r);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> u, v;</span><br><span class="line">            u = <span class="number">1</span>, v = r;</span><br><span class="line">            <span class="keyword">int</span> ans = <span class="built_in">query1</span>(<span class="number">1</span>, u, v);</span><br><span class="line">            u = <span class="number">1</span>, v = l - <span class="number">1</span>;</span><br><span class="line">            ans -= <span class="built_in">query2</span>(<span class="number">1</span>, u, v);</span><br><span class="line">            cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="RMQ-区间最值查询"><a href="#RMQ-区间最值查询" class="headerlink" title="RMQ 区间最值查询"></a>RMQ 区间最值查询</h2><h3 id="预处理-O-nlogn"><a href="#预处理-O-nlogn" class="headerlink" title="预处理         $O(nlogn)$"></a>预处理         $O(nlogn)$</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e4</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">int</span> a[N], dp[N][N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">rmq_init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= N;i ++) dp[i][<span class="number">0</span>]=a[i];<span class="comment">//初始化</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>;(<span class="number">1</span> &lt;&lt; j) &lt;= N;j ++)</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i + (<span class="number">1</span> &lt;&lt; j) - <span class="number">1</span> &lt;= N;i ++)</span><br><span class="line">            dp[i][j] = <span class="built_in">min</span>(dp[i][j - <span class="number">1</span>], dp[i + (<span class="number">1</span> &lt;&lt; j - <span class="number">1</span>)][j - <span class="number">1</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="查询-O-1"><a href="#查询-O-1" class="headerlink" title="查询        $O(1)$"></a>查询        $O(1)$</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">rmq</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> k = <span class="built_in">log2</span>(r-l+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">min</span>(dp[l][k], dp[r - (<span class="number">1</span> &lt;&lt; k) + <span class="number">1</span>][k]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="主席树-区间第K小数"><a href="#主席树-区间第K小数" class="headerlink" title="主席树 - 区间第K小数"></a>主席树 - 区间第K小数</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> all(x) x.begin(), x.end()</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mem(a, b) memset(a, b, sizeof a)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IOS ios::sync_with_stdio(0);cin.tie(0); cout.tie(0)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> l, r;</span><br><span class="line">    <span class="keyword">int</span> cnt;</span><br><span class="line">&#125;e[N * <span class="number">32</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m;</span><br><span class="line"><span class="keyword">int</span> a[N];</span><br><span class="line"><span class="keyword">int</span> root[N], idx;</span><br><span class="line"></span><br><span class="line">vector&lt;<span class="keyword">int</span>&gt; v;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">lower_bound</span>(<span class="built_in">all</span>(v), x) - v.<span class="built_in">begin</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = ++ idx;</span><br><span class="line">    <span class="keyword">if</span>(l == r) </span><br><span class="line">        <span class="keyword">return</span> i;</span><br><span class="line">    <span class="keyword">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    e[i].l = <span class="built_in">build</span>(l, mid);</span><br><span class="line">    e[i].r = <span class="built_in">build</span>(mid + <span class="number">1</span>, r);</span><br><span class="line">    <span class="keyword">return</span> i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> x)</span></span>&#123;     <span class="comment">//p 代表上一版本的线段树， x 代表插入的值</span></span><br><span class="line">    <span class="keyword">int</span> q = ++ idx;</span><br><span class="line">    e[q] = e[p];</span><br><span class="line">    <span class="keyword">if</span>(l == r)&#123;</span><br><span class="line">        e[q].cnt ++;</span><br><span class="line">        <span class="keyword">return</span> q;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(x &lt;= mid) </span><br><span class="line">        e[q].l = <span class="built_in">insert</span>(e[p].l, l, mid, x);</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">        e[q].r = <span class="built_in">insert</span>(e[p].r, mid + <span class="number">1</span>, r, x);</span><br><span class="line">    e[q].cnt = e[e[q].l].cnt + e[e[q].r].cnt;</span><br><span class="line">    <span class="keyword">return</span> q;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> q, <span class="keyword">int</span> p, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> k)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l == r)</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    <span class="keyword">int</span> cnt = e[e[q].l].cnt - e[e[p].l].cnt;</span><br><span class="line">    <span class="keyword">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(k &lt;= cnt) </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">query</span>(e[q].l, e[p].l, l, mid, k);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">query</span>(e[q].r, e[p].r, mid + <span class="number">1</span>, r, k - cnt);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    IOS;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i ++)&#123;</span><br><span class="line">        cin &gt;&gt; a[i];</span><br><span class="line">        v.<span class="built_in">pb</span>(a[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sort</span>(<span class="built_in">all</span>(v));   <span class="comment">//离散化</span></span><br><span class="line">    v.<span class="built_in">erase</span>(<span class="built_in">unique</span>(<span class="built_in">all</span>(v)), v.<span class="built_in">end</span>());</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i ++)</span><br><span class="line">        a[i] = <span class="built_in">find</span>(a[i]);</span><br><span class="line">    root[<span class="number">0</span>] = <span class="built_in">build</span>(<span class="number">0</span>, v.<span class="built_in">size</span>() - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i ++) </span><br><span class="line">        root[i] = <span class="built_in">insert</span>(root[i - <span class="number">1</span>], <span class="number">0</span>, v.<span class="built_in">size</span>() - <span class="number">1</span>, a[i]);</span><br><span class="line">    <span class="keyword">while</span>(m --)&#123;</span><br><span class="line">        <span class="keyword">int</span> l, r, k;</span><br><span class="line">        cin &gt;&gt; l &gt;&gt; r &gt;&gt; k;</span><br><span class="line">        cout &lt;&lt; v[<span class="built_in">query</span>(root[r], root[l - <span class="number">1</span>], <span class="number">0</span>, v.<span class="built_in">size</span>() - <span class="number">1</span>, k)] &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Splay"><a href="#Splay" class="headerlink" title="Splay"></a>Splay</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ff double</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mem(a, b) memset(a, b, sizeof a)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rep(i, a, b) for(int i = (int)a; i &lt;= (int)b; i ++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> per(i, a, b) for(int i = (int)a; i &gt;= (int)b; i --)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IOS ios::sync_with_stdio(0); cin.tie(0); cout.tie(0)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> val, fa;</span><br><span class="line">    <span class="keyword">int</span> son[<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">int</span> size, f;</span><br><span class="line">    <span class="built_in">node</span>() &#123;&#125;</span><br><span class="line">    <span class="built_in">node</span>(<span class="keyword">int</span> v, <span class="keyword">int</span> fat) &#123;</span><br><span class="line">        val = v; fa = fat;</span><br><span class="line">        son[<span class="number">0</span>] = son[<span class="number">1</span>] = f = <span class="number">0</span>; size = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;tr[N];</span><br><span class="line"><span class="keyword">int</span> n, m;</span><br><span class="line"><span class="keyword">int</span> root, idx;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    tr[i].size = tr[tr[i].son[<span class="number">0</span>]].size + tr[tr[i].son[<span class="number">1</span>]].size + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(tr[i].f) &#123;</span><br><span class="line">        <span class="built_in">swap</span>(tr[i].son[<span class="number">0</span>], tr[i].son[<span class="number">1</span>]);</span><br><span class="line">        tr[tr[i].son[<span class="number">0</span>]].f ^= <span class="number">1</span>;</span><br><span class="line">        tr[tr[i].son[<span class="number">1</span>]].f ^= <span class="number">1</span>;</span><br><span class="line">        tr[i].f = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;   </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getK</span><span class="params">(<span class="keyword">int</span> k)</span> </span>&#123;       <span class="comment">//找到序列里第 k 大数</span></span><br><span class="line">    <span class="keyword">int</span> i = root;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">pushdown</span>(i);</span><br><span class="line">        <span class="keyword">if</span>(tr[tr[i].son[<span class="number">0</span>]].size &gt;= k) i = tr[i].son[<span class="number">0</span>]; </span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(tr[tr[i].son[<span class="number">0</span>]].size + <span class="number">1</span> == k) <span class="keyword">return</span> i;</span><br><span class="line">        <span class="keyword">else</span> k -= (tr[tr[i].son[<span class="number">0</span>]].size + <span class="number">1</span>), i = tr[i].son[<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">rotate</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> y = tr[x].fa, z = tr[y].fa;</span><br><span class="line">    <span class="keyword">int</span> k = tr[y].son[<span class="number">1</span>] == x;      <span class="comment">//是左儿子还是右儿子</span></span><br><span class="line">    tr[z].son[tr[z].son[<span class="number">1</span>] == y] = x, tr[x].fa = z;     <span class="comment">//旋转 x</span></span><br><span class="line">    tr[y].son[k] = tr[x].son[k ^ <span class="number">1</span>], tr[tr[x].son[k ^ <span class="number">1</span>]].fa = y;   <span class="comment">//旋转 x 的儿子</span></span><br><span class="line">    tr[x].son[k ^ <span class="number">1</span>] = y, tr[y].fa = x;</span><br><span class="line">    <span class="built_in">pushup</span>(y); <span class="built_in">pushup</span>(x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">splay</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(tr[x].fa != k) &#123;</span><br><span class="line">        <span class="keyword">int</span> y = tr[x].fa, z = tr[y].fa;</span><br><span class="line">        <span class="keyword">if</span>(z != k) &#123;</span><br><span class="line">            <span class="keyword">if</span>((tr[y].son[<span class="number">1</span>] == x) ^ (tr[z].son[<span class="number">1</span>] == y)) <span class="built_in">rotate</span>(x);</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">rotate</span>(y);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">rotate</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!k) root = x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> u = root, fa = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(u) &#123;</span><br><span class="line">        fa = u; u = tr[u].son[x &gt; tr[u].val];</span><br><span class="line">    &#125;</span><br><span class="line">    u = ++ idx;</span><br><span class="line">    <span class="keyword">if</span>(fa) &#123;</span><br><span class="line">        tr[fa].son[x &gt; tr[fa].val] = u;</span><br><span class="line">    &#125;</span><br><span class="line">    tr[u] = <span class="built_in">node</span>(x, fa);</span><br><span class="line">    <span class="built_in">splay</span>(u, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">output</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">pushdown</span>(i);</span><br><span class="line">    <span class="keyword">if</span>(tr[i].son[<span class="number">0</span>]) <span class="built_in">output</span>(tr[i].son[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">if</span>(<span class="number">1</span> &lt;= tr[i].val &amp;&amp; tr[i].val &lt;= n) cout &lt;&lt; tr[i].val &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(tr[i].son[<span class="number">1</span>]) <span class="built_in">output</span>(tr[i].son[<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    IOS; cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="built_in">rep</span>(i, <span class="number">0</span>, n + <span class="number">1</span>) <span class="built_in">insert</span>(i);     <span class="comment">//多俩哨兵</span></span><br><span class="line">    <span class="keyword">while</span>(m --) &#123;</span><br><span class="line">        <span class="keyword">int</span> l, r;</span><br><span class="line">        cin &gt;&gt; l &gt;&gt; r;</span><br><span class="line">        l = <span class="built_in">getK</span>(l), r = <span class="built_in">getK</span>(r + <span class="number">2</span>);       <span class="comment">//第l - 1个数 和第r + 1个数</span></span><br><span class="line">        <span class="built_in">splay</span>(l, <span class="number">0</span>); <span class="built_in">splay</span>(r, l);</span><br><span class="line">        tr[tr[r].son[<span class="number">0</span>]].f ^= <span class="number">1</span>; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">output</span>(root);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="例题：郁闷的出纳员"><a href="#例题：郁闷的出纳员" class="headerlink" title="例题：郁闷的出纳员"></a>例题：郁闷的出纳员</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ff double</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mem(a, b) memset(a, b, sizeof a)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rep(i, a, b) for(int i = (int)a; i &lt;= (int)b; i ++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> per(i, a, b) for(int i = (int)a; i &gt;= (int)b; i --)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IOS ios::sync_with_stdio(0); cin.tie(0); cout.tie(0)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">int</span> n, m;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> son[<span class="number">2</span>], fa, siz, val, cnt, add;</span><br><span class="line">&#125;tr[N];</span><br><span class="line"><span class="keyword">int</span> root, idx;</span><br><span class="line"><span class="keyword">int</span> ans;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!i) <span class="keyword">return</span> ;</span><br><span class="line">	tr[i].siz = tr[tr[i].son[<span class="number">0</span>]].siz + tr[tr[i].son[<span class="number">1</span>]].siz + tr[i].cnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">get</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> tr[tr[x].fa].son[<span class="number">1</span>] == x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(tr[i].add) &#123;</span><br><span class="line">		<span class="keyword">if</span>(tr[i].son[<span class="number">0</span>]) &#123;</span><br><span class="line">			tr[tr[i].son[<span class="number">0</span>]].val += tr[i].add;</span><br><span class="line">			tr[tr[i].son[<span class="number">0</span>]].add += tr[i].add;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(tr[i].son[<span class="number">1</span>]) &#123;</span><br><span class="line">			tr[tr[i].son[<span class="number">1</span>]].val += tr[i].add;</span><br><span class="line">			tr[tr[i].son[<span class="number">1</span>]].add += tr[i].add;</span><br><span class="line">		&#125;</span><br><span class="line">		tr[i].add = <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">rotate</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!tr[x].fa) <span class="keyword">return</span> ;</span><br><span class="line">	<span class="keyword">int</span> y = tr[x].fa, z = tr[y].fa;</span><br><span class="line">	<span class="keyword">int</span> k = <span class="built_in">get</span>(x);</span><br><span class="line">	<span class="built_in">pushdown</span>(y); <span class="built_in">pushdown</span>(x);</span><br><span class="line">	tr[z].son[tr[z].son[<span class="number">1</span>] == y] = x; tr[x].fa = z;</span><br><span class="line">	tr[y].son[k] = tr[x].son[k ^ <span class="number">1</span>]; tr[tr[x].son[k ^ <span class="number">1</span>]].fa = y;</span><br><span class="line">	tr[x].son[k ^ <span class="number">1</span>] = y; tr[y].fa = x;</span><br><span class="line">	<span class="built_in">pushup</span>(y); <span class="built_in">pushup</span>(x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">splay</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> fa; (fa = tr[x].fa) &amp;&amp; tr[x].fa != k; <span class="built_in">rotate</span>(x))</span><br><span class="line">        <span class="keyword">if</span>(tr[fa].fa != k)</span><br><span class="line">            <span class="built_in">rotate</span>((<span class="built_in">get</span>(x) == <span class="built_in">get</span>(fa)) ? fa : x);</span><br><span class="line">	<span class="keyword">if</span>(!k) root = x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!root) &#123;</span><br><span class="line">		tr[++ idx].val = x;</span><br><span class="line">		tr[idx].cnt = tr[idx].siz = <span class="number">1</span>;</span><br><span class="line">		tr[idx].fa = tr[idx].add = tr[idx].son[<span class="number">0</span>] = tr[idx].son[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">		root = idx; <span class="keyword">return</span> ;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">int</span> cur = root, fa = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(cur) &#123;</span><br><span class="line">		<span class="built_in">pushdown</span>(cur);</span><br><span class="line">		<span class="keyword">if</span>(tr[cur].val == x) &#123;</span><br><span class="line">			tr[cur].cnt ++;</span><br><span class="line">			<span class="built_in">pushup</span>(cur); <span class="built_in">pushup</span>(fa);</span><br><span class="line">			<span class="built_in">splay</span>(cur, <span class="number">0</span>); <span class="keyword">return</span> ;</span><br><span class="line">		&#125;</span><br><span class="line">		fa = cur;</span><br><span class="line">		cur = tr[cur].son[x &lt; tr[cur].val];</span><br><span class="line">	&#125;</span><br><span class="line">	tr[++ idx].val = x;</span><br><span class="line">	tr[idx].cnt = tr[idx].siz = <span class="number">1</span>;</span><br><span class="line">	tr[idx].add = tr[idx].son[<span class="number">0</span>] = tr[idx].son[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">	tr[idx].fa = fa;</span><br><span class="line">    tr[fa].son[x &lt; tr[fa].val] = idx;</span><br><span class="line">	<span class="built_in">pushup</span>(idx); <span class="built_in">pushup</span>(fa);</span><br><span class="line">	<span class="built_in">splay</span>(idx, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fix</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">insert</span>(m);</span><br><span class="line">	ans += tr[tr[root].son[<span class="number">1</span>]].siz;</span><br><span class="line">	tr[root].son[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span>(tr[root].cnt &gt; <span class="number">1</span>) &#123;</span><br><span class="line">		tr[root].cnt --;</span><br><span class="line">		<span class="built_in">pushup</span>(root);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		root = tr[root].son[<span class="number">0</span>];</span><br><span class="line">		tr[root].fa = <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">	tr[root].add += x;</span><br><span class="line">	tr[root].val += x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sub</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">	tr[root].add -= x;</span><br><span class="line">	tr[root].val -= x;</span><br><span class="line">	<span class="built_in">fix</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getKTH</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> cur = root;</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">		<span class="built_in">pushdown</span>(cur);</span><br><span class="line">		<span class="keyword">if</span>(tr[cur].son[<span class="number">0</span>] &amp;&amp; x &lt;= tr[tr[cur].son[<span class="number">0</span>]].siz) cur = tr[cur].son[<span class="number">0</span>];</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">int</span> tmp = tr[tr[cur].son[<span class="number">0</span>]].siz + tr[cur].cnt;</span><br><span class="line">			<span class="keyword">if</span>(x &lt;= tmp) <span class="keyword">return</span> tr[cur].val;</span><br><span class="line">			x -= tmp; </span><br><span class="line">			cur = tr[cur].son[<span class="number">1</span>];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">	root = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(n --) &#123;</span><br><span class="line">		<span class="keyword">char</span> op[<span class="number">2</span>]; <span class="keyword">int</span> k; </span><br><span class="line">		cin &gt;&gt; op &gt;&gt; k;</span><br><span class="line">		<span class="keyword">if</span>(*op == <span class="string">&#x27;I&#x27;</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span>(k &gt;= m) <span class="built_in">insert</span>(k);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(*op == <span class="string">&#x27;A&#x27;</span>) <span class="built_in">add</span>(k);</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(*op == <span class="string">&#x27;S&#x27;</span>) <span class="built_in">sub</span>(k);</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(*op == <span class="string">&#x27;F&#x27;</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span>(k &gt; tr[root].siz) cout &lt;&lt; <span class="number">-1</span> &lt;&lt; endl;</span><br><span class="line">			<span class="keyword">else</span> cout &lt;&lt; <span class="built_in">getKTH</span>(k) &lt;&lt; endl;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Splay树上合并"><a href="#Splay树上合并" class="headerlink" title="Splay树上合并"></a>Splay树上合并</h3><p>两棵树合并，合并时size小的合并到size大的上，通过并查集维护根节点，每次后序遍历小树将所有的点insert到大树上</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> root[N], p[N];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> val, siz, son[<span class="number">2</span>], fa, id;</span><br><span class="line">	<span class="built_in">node</span>()&#123;&#125;</span><br><span class="line">	<span class="built_in">node</span>(<span class="keyword">int</span> val, <span class="keyword">int</span> id, <span class="keyword">int</span> fa):<span class="built_in">val</span>(val), <span class="built_in">id</span>(id), <span class="built_in">fa</span>(fa)&#123;</span><br><span class="line">		siz = <span class="number">1</span>; son[<span class="number">0</span>] = son[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;tr[N];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123; <span class="keyword">return</span> p[x] == x ? x : p[x] = <span class="built_in">find</span>(p[x]); &#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">get</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123; <span class="keyword">return</span> tr[tr[x].fa].son[<span class="number">1</span>] == x; &#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123; tr[i].siz = tr[tr[i].son[<span class="number">0</span>]].siz + tr[tr[i].son[<span class="number">1</span>]].siz + <span class="number">1</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">rotate</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!tr[x].fa) <span class="keyword">return</span> ;</span><br><span class="line">	<span class="keyword">int</span> y = tr[x].fa, z = tr[y].fa;</span><br><span class="line">	<span class="keyword">int</span> k = <span class="built_in">get</span>(x);</span><br><span class="line">	tr[z].son[<span class="built_in">get</span>(y)] = x; tr[x].fa = z;</span><br><span class="line">	tr[y].son[k] = tr[x].son[k ^ <span class="number">1</span>]; tr[tr[x].son[k ^ <span class="number">1</span>]].fa = y;</span><br><span class="line">	tr[x].son[k ^ <span class="number">1</span>] = y; tr[y].fa = x;</span><br><span class="line">	<span class="built_in">pushup</span>(y); <span class="built_in">pushup</span>(x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">splay</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> k, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> fa; (fa = tr[x].fa) &amp;&amp; tr[x].fa != k; <span class="built_in">rotate</span>(x)) </span><br><span class="line">		<span class="keyword">if</span>(tr[fa].fa != k) <span class="built_in">rotate</span>((<span class="built_in">get</span>(x) == <span class="built_in">get</span>(fa)) ? fa : x); </span><br><span class="line">	<span class="keyword">if</span>(!k) root[b] = x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> val, <span class="keyword">int</span> id, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> cur = root[b], fa = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(cur) &#123;</span><br><span class="line">		fa = cur;</span><br><span class="line">		cur = tr[cur].son[val &gt; tr[cur].val];</span><br><span class="line">	&#125;</span><br><span class="line">	cur = ++ idx;</span><br><span class="line">	<span class="keyword">if</span>(fa) tr[fa].son[val &gt; tr[fa].val] = cur;</span><br><span class="line">	tr[cur] = <span class="built_in">node</span>(val, id, fa);</span><br><span class="line">	<span class="built_in">splay</span>(cur, <span class="number">0</span>, b);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">merge</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(tr[a].son[<span class="number">0</span>]) <span class="built_in">merge</span>(tr[a].son[<span class="number">0</span>], b);</span><br><span class="line">	<span class="keyword">if</span>(tr[a].son[<span class="number">1</span>]) <span class="built_in">merge</span>(tr[a].son[<span class="number">1</span>], b);</span><br><span class="line">	<span class="built_in">insert</span>(tr[a].val, tr[a].id, b);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	IOS;</span><br><span class="line">	cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">	<span class="built_in">rep</span>(i, <span class="number">1</span>, n) &#123;</span><br><span class="line">		p[i] = root[i] = i;</span><br><span class="line">		<span class="keyword">int</span> v; cin &gt;&gt; v;</span><br><span class="line">		tr[i] = <span class="built_in">node</span>(v, i, <span class="number">0</span>);</span><br><span class="line">	&#125; idx = n;</span><br><span class="line">	<span class="keyword">while</span>(m --) &#123;</span><br><span class="line">		<span class="keyword">int</span> u, v; cin &gt;&gt; u &gt;&gt; v;</span><br><span class="line">		<span class="keyword">int</span> a = <span class="built_in">find</span>(u), b = <span class="built_in">find</span>(v);</span><br><span class="line">		<span class="keyword">if</span>(a != b) &#123;</span><br><span class="line">			<span class="keyword">if</span>(tr[root[a]].siz &gt; tr[root[b]].siz) <span class="built_in">swap</span>(a, b);			</span><br><span class="line">			<span class="built_in">merge</span>(root[a], b);</span><br><span class="line">			p[a] = b;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">int</span> q; cin &gt;&gt; q;</span><br><span class="line">	<span class="keyword">while</span>(q --) &#123;</span><br><span class="line">		<span class="keyword">char</span> op[<span class="number">2</span>]; <span class="keyword">int</span> u, v;</span><br><span class="line">		cin &gt;&gt; op &gt;&gt; u &gt;&gt; v;</span><br><span class="line">		<span class="keyword">if</span>(*op == <span class="string">&#x27;Q&#x27;</span>) &#123;</span><br><span class="line">			u = <span class="built_in">find</span>(u);</span><br><span class="line">			<span class="keyword">if</span>(tr[root[u]].siz &lt; v) cout &lt;&lt; <span class="number">-1</span> &lt;&lt; endl;</span><br><span class="line">			<span class="keyword">else</span> cout &lt;&lt; <span class="built_in">getKTH</span>(u, v) &lt;&lt; endl;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">int</span> a = <span class="built_in">find</span>(u), b = <span class="built_in">find</span>(v);</span><br><span class="line">			<span class="keyword">if</span>(a != b) &#123;</span><br><span class="line">				<span class="keyword">if</span>(tr[root[a]].siz &gt; tr[root[b]].siz) <span class="built_in">swap</span>(a, b);			</span><br><span class="line">				<span class="built_in">merge</span>(root[a], b);</span><br><span class="line">				p[a] = b;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h1><h2 id="KMP"><a href="#KMP" class="headerlink" title="KMP"></a>KMP</h2><h3 id="下标从-1-开始"><a href="#下标从-1-开始" class="headerlink" title="下标从 1 开始"></a>下标从 1 开始</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// s[]是长文本，p[]是模式串，n是s的长度，m是p的长度</span></span><br><span class="line">string s, t;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getNext</span><span class="params">()</span></span>&#123;         <span class="comment">// 1 开头</span></span><br><span class="line">    <span class="keyword">int</span> m = t.<span class="built_in">size</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>, j = <span class="number">0</span>; i &lt;= m; i ++)&#123;</span><br><span class="line">        <span class="keyword">while</span>(j &amp;&amp; t[i] != t[j + <span class="number">1</span>]) j = ne[j];</span><br><span class="line">        <span class="keyword">if</span>(t[j + <span class="number">1</span>] == t[i]) j ++;</span><br><span class="line">        ne[i] = j;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 匹配</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">kmp</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>, j = <span class="number">0</span>; i &lt;= n; i ++)&#123;</span><br><span class="line">        <span class="keyword">while</span>(j &amp;&amp; s[i] != s[j + <span class="number">1</span>]) j = ne[j];</span><br><span class="line">        <span class="keyword">if</span>(s[i] == p[j + <span class="number">1</span>]) j ++;</span><br><span class="line">        <span class="keyword">if</span>(j == m)&#123;</span><br><span class="line">            <span class="comment">// j = ne[j];</span></span><br><span class="line">            <span class="keyword">return</span> i - j + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="下标从-0-开始"><a href="#下标从-0-开始" class="headerlink" title="下标从 0 开始"></a>下标从 0 开始</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">string s,p;</span><br><span class="line">int ne[N];</span><br><span class="line">void get_next()&#123;      //最开始学的板子，下标从 0 开始</span><br><span class="line">  ne[0] = -1;</span><br><span class="line">   for (int i = 1, j = -1; i &lt; m; i ++ )&#123;</span><br><span class="line">     while (j &gt;= 0 &amp;&amp; p[j + 1] != p[i]) j = ne[j];</span><br><span class="line">     if (p[j + 1] == p[i]) j ++ ;</span><br><span class="line">     ne[i] = j;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">int kmp(string s, string p)&#123;</span><br><span class="line">     for (int i = 0, j = -1; i &lt; n; i ++ )&#123;</span><br><span class="line">     while (j != -1 &amp;&amp; s[i] != p[j + 1]) j = ne[j];</span><br><span class="line">     if (s[i] == p[j + 1]) j ++ ;</span><br><span class="line">     if (j == m - 1)&#123;</span><br><span class="line">       return i - j + 1;</span><br><span class="line">     &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="Trie"><a href="#Trie" class="headerlink" title="Trie"></a>Trie</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> son[N][<span class="number">26</span>], cnt[N], idx;</span><br><span class="line"><span class="comment">// 0号点既是根节点，又是空节点</span></span><br><span class="line"><span class="comment">// son[][]存储树中每个节点的子节点</span></span><br><span class="line"><span class="comment">// cnt[]存储以每个节点结尾的单词数量</span></span><br><span class="line"><span class="comment">// 插入一个字符串</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">char</span> *str)</span></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> p = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; str[i]; i ++ )&#123;</span><br><span class="line">     <span class="keyword">int</span> u = str[i] - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">     <span class="keyword">if</span> (!son[p][u]) son[p][u] = ++ idx;</span><br><span class="line">     p = son[p][u];</span><br><span class="line">  &#125;</span><br><span class="line">  cnt[p] ++ ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询字符串出现的次数</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">char</span> *str)</span></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> p = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; str[i]; i ++ )&#123;</span><br><span class="line">     <span class="keyword">int</span> u = str[i] - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">     <span class="keyword">if</span> (!son[p][u]) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">     p = son[p][u];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> cnt[p];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="字符串哈希"><a href="#字符串哈希" class="headerlink" title="字符串哈希"></a>字符串哈希</h2><p>核心思想：将字符串看成P进制数，P的经验值是131或13331，取这两个值的冲突概率低</p>
<p>小技巧：取模的数用2^64，这样直接用unsigned long long存储，溢出的结果就是取模的结果</p>
<p><strong>upd on 2022.5</strong>：这个trick作废，卡这个是经常有的事情，模数还是得自己弄个。</p>
 <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rep(i, a, b) for(int i = (int)a; i &lt;= (int)b; i ++)</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span> + <span class="number">5</span>, mod = <span class="number">1e9</span> + <span class="number">7</span>, P = <span class="number">13331</span>;</span><br><span class="line"><span class="keyword">int</span> n, q;</span><br><span class="line"><span class="keyword">int</span> h[N], p[N];</span><br><span class="line">string s;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">get</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ((h[r] - (h[l - <span class="number">1</span>] * p[r - l + <span class="number">1</span>]) % mod) + mod) % mod;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; q &gt;&gt; s;</span><br><span class="line">    s = <span class="string">&quot; &quot;</span> + s;</span><br><span class="line">    p[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">rep</span>(i, <span class="number">1</span>, n) &#123;</span><br><span class="line">        h[i] = ((h[i - <span class="number">1</span>] * P) % mod + s[i]) % mod;</span><br><span class="line">        p[i] = (p[i - <span class="number">1</span>] * P) % mod;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(q --) &#123;</span><br><span class="line">        <span class="keyword">int</span> l1, r1, l2, r2;</span><br><span class="line">        cin &gt;&gt; l1 &gt;&gt; r1 &gt;&gt; l2 &gt;&gt; r2;</span><br><span class="line">        cout &lt;&lt; ((<span class="built_in">get</span>(l1, r1) == <span class="built_in">get</span>(l2, r2)) ? <span class="string">&quot;Yes&quot;</span> : <span class="string">&quot;No&quot;</span>) &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Ex-KMP"><a href="#Ex-KMP" class="headerlink" title="Ex - KMP"></a>Ex - KMP</h2><p>/?我几乎没做过Ex-KMP的题目或者碰到的都有更容易的解法？</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span> + <span class="number">5</span>;             <span class="comment">//字符串长度最大值</span></span><br><span class="line"><span class="keyword">int</span> pre[N],ext[N];               <span class="comment">// ext 指 s 与 p 的最长公共前缀</span></span><br><span class="line">string s,t;                  <span class="comment">//pre 是 x 的最长公共前后缀</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getpre</span><span class="params">(string s)</span></span>&#123;             <span class="comment">// 求 pre 数组</span></span><br><span class="line">  <span class="keyword">int</span> i = <span class="number">0</span>,j,pos, m = s.<span class="built_in">size</span>();</span><br><span class="line">  pre[<span class="number">0</span>] = m;                <span class="comment">//用自己来做后缀与自己匹配</span></span><br><span class="line">  <span class="keyword">while</span>(s[i] == s[i+<span class="number">1</span>] &amp;&amp; i + <span class="number">1</span> &lt; m) i ++;  <span class="comment">//求pre[1]</span></span><br><span class="line">  pre[<span class="number">1</span>] = i; pos = <span class="number">1</span>;            <span class="comment">//从此点出发 pre 延伸最远</span></span><br><span class="line">  <span class="keyword">for</span>(i = <span class="number">2</span>;i &lt; m;i ++)&#123;</span><br><span class="line">     <span class="keyword">if</span>(pre[i - pos] &lt; pre[pos] + pos - i)</span><br><span class="line">		pre[i] = pre[i - pos]; <span class="comment">//第一种情况，可以直接得pre[i]</span></span><br><span class="line">    <span class="keyword">else</span> &#123;                 <span class="comment">//第二种情况，继续匹配才能得到pre[i]</span></span><br><span class="line">      j = pre[pos] + pos - i;         </span><br><span class="line">      j = <span class="built_in">max</span>(j,<span class="number">0</span>);     <span class="comment">//小于0 时没有已知相同部分，重新开始匹配</span></span><br><span class="line">      <span class="keyword">while</span>(i + j &lt; m &amp;&amp; s[j] == s[j + <span class="number">1</span>]) j ++;</span><br><span class="line">      pre[i] = j; pos = i;              <span class="comment">//更新pos</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">exkmp</span><span class="params">(string s,string t)</span></span>&#123;        <span class="comment">//求 next 数组</span></span><br><span class="line">  <span class="keyword">int</span> i = <span class="number">0</span>, j, pos, l = s.<span class="built_in">size</span>(), q = t.<span class="built_in">size</span>();</span><br><span class="line">  <span class="built_in">getpre</span>(t);</span><br><span class="line">  <span class="keyword">while</span>(s[i] == t[i] &amp;&amp; i &lt; q &amp;&amp; i &lt; l) i++;</span><br><span class="line">  ext[<span class="number">0</span>] = i; pos = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>(i = <span class="number">1</span>;i &lt; l; i ++)&#123;</span><br><span class="line">    <span class="keyword">if</span>(pre[i - pos] + i &lt; ext[pos] + pos) ext[i] = pre[i - pos];</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">      j = ext[pos] + pos - i;</span><br><span class="line">      j = <span class="built_in">max</span>(j,<span class="number">0</span>);</span><br><span class="line">      <span class="keyword">while</span>(i + j &lt; l &amp;&amp; j &lt; q &amp;&amp; s[j + <span class="number">1</span>] == t[j]) j++;</span><br><span class="line">      ext[i] = j; pos = i;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">子串匹配</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i ++)&#123;</span><br><span class="line">  <span class="keyword">int</span> flag = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>;j &lt;= m;j ++)</span><br><span class="line">    <span class="keyword">if</span>(s[i + j - <span class="number">1</span>] != p[j])&#123;</span><br><span class="line">      flag = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*后缀和前缀相等的长度 --- Next数组</span></span><br><span class="line"><span class="comment">Next[i] = j;  --p[1 --&gt; j] = p[i - j + 1 ---&gt; i]*/</span></span><br></pre></td></tr></table></figure>
<h2 id="Manacher"><a href="#Manacher" class="headerlink" title="Manacher"></a>Manacher</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line">string s,t;</span><br><span class="line"><span class="keyword">int</span> len[N &lt;&lt; <span class="number">1</span>];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Manacher</span><span class="params">(string s)</span></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> l = s.<span class="built_in">size</span>();</span><br><span class="line">  t[<span class="number">0</span>] = <span class="string">&#x27;@&#x27;</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; <span class="number">2</span> * l; i += <span class="number">2</span>)&#123;</span><br><span class="line">     t[i] = <span class="string">&#x27;#&#x27;</span>; t[i + <span class="number">1</span>] = s[i &gt;&gt; <span class="number">1</span>];</span><br><span class="line">  &#125;</span><br><span class="line">  t += <span class="string">&quot;#$&quot;</span>; t += <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">int</span> maxx = <span class="number">0</span>, pos = <span class="number">0</span>,ans = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ;t[i]; i ++)&#123;</span><br><span class="line">     len[i] = (maxx &gt; i ? <span class="built_in">min</span>(maxx - i,len[(pos &lt;&lt; <span class="number">1</span>) - i]) : <span class="number">1</span>);</span><br><span class="line">     <span class="keyword">while</span>(s[i - len[i]] == s[i + len[i]]) len[i] ++ ;</span><br><span class="line">     <span class="keyword">if</span>(len[i] + i &gt; maxx) maxx = len[i] + i, pos = i;</span><br><span class="line">     ans = <span class="built_in">max</span>(ans, len[i]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="后缀数组"><a href="#后缀数组" class="headerlink" title="后缀数组"></a>后缀数组</h2><p>注意易卡ll</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> endl <span class="meta-string">&quot;\n&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ff double</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></span><br><span class="line"><span class="comment">// #define int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> all(x) x.begin(), x.end()</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mem(a, b) memset(a, b, sizeof a)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rep(i, a, b) for (int i = (int)a; i &lt;= (int)b; i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> per(i, a, b) for (int i = (int)a; i &gt;= (int)b; i--)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IOS ios::sync_with_stdio(0); cin.tie(0); cout.tie(0)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e6</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">int</span> n, m;</span><br><span class="line"><span class="keyword">char</span> s[N];</span><br><span class="line"><span class="keyword">int</span> sa[N], rk[N], height[N], x[N], id[N], cnt[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getSA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; i ++) cnt[i] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i ++) ++ cnt[x[i] = s[i]];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; i ++) cnt[i] += cnt[i - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = n; i; i --) sa[cnt[x[i]] --] = i;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> k = <span class="number">1</span>; k &lt;= n; k &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">int</span> num = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = n - k + <span class="number">1</span>; i &lt;= n; i ++) id[++ num] = i;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i ++) </span><br><span class="line">            <span class="keyword">if</span>(sa[i] &gt; k) id[++ num] = sa[i] - k;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; i ++) cnt[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i ++) cnt[x[i]] ++;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; i ++) cnt[i] += cnt[i - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = n; i; i --) sa[cnt[x[id[i]]] --] = id[i];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i ++) <span class="built_in">swap</span>(x[i], id[i]);</span><br><span class="line">        x[sa[<span class="number">1</span>]] = <span class="number">1</span>; num = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; i ++) </span><br><span class="line">            x[sa[i]] = (id[sa[i]] == id[sa[i - <span class="number">1</span>]] &amp;&amp; id[sa[i] + k] == id[sa[i - <span class="number">1</span>] + k]) ? num : ++ num;</span><br><span class="line">        <span class="keyword">if</span>(n == num) <span class="keyword">break</span>;</span><br><span class="line">        m = num;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getHeight</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i ++) rk[sa[i]] = i;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>, k = <span class="number">0</span>; i &lt;= n; i ++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(rk[i] == <span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span>(k) k --;</span><br><span class="line">        <span class="keyword">int</span> j = sa[rk[i] - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">while</span>(i + k &lt;= n &amp;&amp; j + k &lt;= n &amp;&amp; s[i + k] == s[j + k]) k ++;</span><br><span class="line">        height[rk[i]] = k;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    IOS;</span><br><span class="line">    cin &gt;&gt; s + <span class="number">1</span>;</span><br><span class="line">    n = <span class="built_in">strlen</span>(s + <span class="number">1</span>); m = <span class="number">122</span>;</span><br><span class="line">    <span class="built_in">getSA</span>();        <span class="comment">//  求sa</span></span><br><span class="line">    <span class="built_in">getHeight</span>();    <span class="comment">//  求height</span></span><br><span class="line">    <span class="comment">// for(int i = 1; i &lt;= n; i ++) cout &lt;&lt; sa[i] &lt;&lt; &quot; &quot;; cout &lt;&lt; endl;</span></span><br><span class="line">    <span class="comment">// for(int i = 1; i &lt;= n; i ++) cout &lt;&lt; height[i] &lt;&lt; &quot; &quot;; cout &lt;&lt; endl;</span></span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i ++) &#123;   <span class="comment">//求不同子串数目  这里卡ll</span></span><br><span class="line">        ans += n - sa[i] + <span class="number">1</span> - height[i];</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="后缀数组应用场景"><a href="#后缀数组应用场景" class="headerlink" title="后缀数组应用场景"></a>后缀数组应用场景</h3><p><strong>2.2、单个字符串的相关问题</strong></p>
<p>　　这类问题的一个常用做法是先求后缀数组和 height数组，然后利用 height数组进行求解。</p>
<p><strong>2.2.1、重复子串</strong></p>
<p>　　重复子串：字符串R在字符串L中至少出现两次，则称R是L的重复子串。</p>
<p>　　<strong>例2：可重叠最长重复子串</strong></p>
<p>　　给定一个字符串，求最长重复子串，这两个子串可以重叠。</p>
<p>　　算法分析：</p>
<p>　　这道题是后缀数组的一个简单应用。做法比较简单，只需要求height数组里的最大值即可。首先求最长重复子串，等价于求两个后缀的最长公共前缀的最大值。因为任意两个后缀的最长公共前缀都是height数组里某一段的最小值，那么这个值一定不大于height数组里的最大值。所以最长重复子串的长度就是height数组里的最大值。这个做法的时间复杂度为O(n)。</p>
<p>　　<strong>例3：不可重叠最长重复子串（<a target="_blank" rel="noopener" href="https://vjudge.net/problem/POJ-1743">POJ - 1743</a>）</strong></p>
<p>　　给定一个字符串，求最长重复子串，这两个子串不能重叠。</p>
<p>　　算法分析：</p>
<p>　　这题比上一题稍复杂一点。先二分答案，把题目变成判定性问题：判断是否存在两个长度为k的子串是相同的，且不重叠。解决这个问题的关键还是利用height数组。把排序后的后缀分成若干组，其中每组的后缀之间的height值都不小于k。例如，字符串为“aabaaaab”，当 k=2时，后缀分成了 4组，如图5所示。</p>
<p><img src="https://img-blog.csdnimg.cn/74206d05451840c5a0a8d30e29841a87.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5by65bC85Y2h5LuA,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt=""></p>
<p>　　容易看出，有希望成为最长公共前缀不小于k的两个后缀一定在同一组。然后对于每组后缀，只须判断每个后缀的sa值的最大值和最小值之差是否不小于k。如果有一组满足，则说明存在，否则不存在。整个做法的时间复杂度为$O(nlogn)$。本题中利用 height值对后缀进行分组的方法很常用，请读者认真体会。</p>
<p>　　<strong>例4：可重叠的 k次最长重复子串（pku3261）</strong></p>
<p>　　给定一个字符串，求至少出现k次的最长重复子串，这k个子串可以重叠。</p>
<p>　　算法分析：</p>
<p>　　这题的做法和上一题差不多，也是先二分答案，然后将后缀分成若干组。不同的是，这里要判断的是有没有一个组的后缀个数不小于k。如果有，那么存在k个相同的子串满足条件，否则不存在。这个做法的时间复杂度为 O(nlogn)。</p>
<p><strong>2.2.2、子串的个数</strong></p>
<p>　　<strong>例5：不相同的子串的个数（spoj694，spoj705）</strong></p>
<p>　　给定一个字符串，求不相同的子串的个数。</p>
<p>　　算法分析：</p>
<p>　　每个子串一定是某个后缀的前缀，那么原问题<strong>等价于求所有后缀之间的不相同的前缀的个数</strong>。如果所有的后缀按照suffix(sa[1])，suffix(sa[2])，suffix(sa[3])，……，suffix(sa[n])的顺序计算，不难发现，对于每一次新加进来的后缀$suffix(sa[k])$，它将产生$n-sa[k]+1$个新的前缀。但是其中有height[k]个是和前面的字符串的前缀是相同的。所以$suffix(sa[k])$将“贡献”出$n-sa[k]+1-height[k]$个不同的子串。累加后便是原问题的答案。这个做法的时间复杂度为$O(n)$，答案为$∑n-sa[i]+1-height[i]$。</p>
<p><strong>2.2.3、回文子串</strong></p>
<p>　　回文子串：如果将字符串L的某个子字符串R反过来写后和原来的字符串R一样，则称字符串R是字符串L的回文子串。</p>
<p>　　<strong>例6：最长回文子串（ural1297）</strong></p>
<p>　　给定一个字符串，求最长回文子串。</p>
<p>　　算法分析：</p>
<p>　　穷举每一位，然后计算以这个字符为中心的最长回文子串。注意这里要分两种情况，一是回文子串的长度为奇数，二是长度为偶数。两种情况都可以转化为求一个后缀和一个反过来写的后缀的最长公共前缀。具体的做法是：将整个字符串反过来写在原字符串后面，中间用一个特殊的字符隔开。这样就把问题变为了求这个新的字符串的某两个后缀的最长公共前缀。如图6所示。</p>
<p><img src="https://img-blog.csdnimg.cn/0184dafc677c40eeb7e2381fe3d42da9.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5by65bC85Y2h5LuA,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt=""></p>
<p>　　这个做法的时间复杂度为O(nlogn)。如果RMQ问题用时间为O(n)的方法预处理，那么本题的时间复杂度可以降为O(n)。</p>
<p><strong>2.2.4、连续重复子串</strong></p>
<p>　　连续重复串：如果一个字符串L是由某个字符串S重复R次而得到的，则称L是一个连续重复串。R是这个字符串的重复次数。</p>
<p>　　<strong>例7：连续重复子串（pku2406）</strong></p>
<p>　　给定一个字符串L，已知这个字符串是由某个字符串S重复R次而得到的，求R的最大值。</p>
<p>　　算法分析：</p>
<p>　　做法比较简单，穷举字符串S的长 k，然后判断是否满足。判断的时候，先看字符串L的长度能否被k整除，再看suffix(1)和suffix(k+1)的最长公共前缀是否等于n-k。在询问最长公共前缀的时候，suffix(1)是固定的，所以RMQ问题没有必要做所有的预处理，只需求出height数组中的每一个数到height[rank[1]]之间的最小值即可。整个做法的时间复杂度为O(n)。</p>
<p>　　<strong>例8：重复次数最多的连续重复子串（spoj687，pku3693）</strong></p>
<p>　　给定一个字符串，求重复次数最多的连续重复子串。</p>
<p>　　算法分析：</p>
<p>　　先穷举长度L，然后求长度为L的子串最多能连续出现几次。首先连续出现1次是肯定可以的，所以这里只考虑至少2次的情况。假设在原字符串中连续出现2次，记这个子字符串为S，那么S肯定包括了字符r[0]，r[L]，r[L<em>2]，r[L</em>3]，……中的某相邻的两个。所以只须看字符r[L<em>i]和r[L</em>(i+1)]往前和往后各能匹配到多远，记这个总长度为K，那么这里连续出现了K/L+1次。最后看最大值是多少。如图7所示。</p>
<p><img src="https://img-blog.csdnimg.cn/365e574f969b44cdaeb3178d16b8aef2.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5by65bC85Y2h5LuA,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt=""></p>
<p>　　穷举长度L的时间是n，每次计算的时间是n/L。所以整个做法的时间复杂度是$O(n/1+n/2+n/3+……+n/n)=O(nlogn)$。</p>
<p><strong>2.3、两个字符串的相关问题</strong></p>
<p>　　这类问题的一个常用做法是，先连接这两个字符串，然后求后缀数组和height数组，再利用height数组进行求解。</p>
<p><strong>2.3.1、公共子串</strong></p>
<p>　　公共子串：如果字符串L同时出现在字符串A和字符串B中，则称字符串L是字符串A和字符串B的公共子串。</p>
<p>　　<strong>例9：最长公共子串（pku2774，ural1517）</strong></p>
<p>　　给定两个字符串A和B，求最长公共子串。</p>
<p>　　算法分析:</p>
<p>　　字符串的任何一个子串都是这个字符串的某个后缀的前缀。<strong>求A和B的最长公共子串等价于求A的后缀和B的后缀的最长公共前缀的最大值</strong>。如果枚举A和B的所有的后缀，那么这样做显然效率低下。由于要计算A的后缀和B的后缀的最长公共前缀，所以先将第二个字符串写在第一个字符串后面，中间用一个没有出现过的字符隔开，再求这个新的字符串的后缀数组。观察一下，看看能不能从这个新的字符串的后缀数组中找到一些规律。以A=“aaaba”，B=“abaa”为例，如图8所示。</p>
<p><img src="https://img-blog.csdnimg.cn/2448af2c68224956b114971c02f61f59.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5by65bC85Y2h5LuA,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt=""></p>
<p>　　那么是不是所有的height值中的最大值就是答案呢？不一定！有可能这两个后缀是在同一个字符串中的，所以实际上只有当$suffix(sa[i-1])$和$suffix(sa[i])$<strong>不是同一个字符串中的两个后缀时，$height[i]$才是满足条件的</strong>。而这其中的最大值就是答案。记字符串A和字符串B的长度分别为$|A|$和$|B|$。求新的字符串的后缀数组和$height$数组的时间是$O(|A|+|B|)$，然后求排名相邻但原来不在同一个字符串中的两个后缀的$height$值的最大值，时间也是$O(|A|+|B|)$，所以整个做法的时间复杂度为$O(|A|+|B|)$。时间复杂度已经取到下限，由此看出，这是一个非常优秀的算法。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s%s&quot;</span>,s + <span class="number">1</span>,t + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">int</span> n1 = <span class="built_in">strlen</span>(s + <span class="number">1</span>), n2 = <span class="built_in">strlen</span>(t + <span class="number">1</span>);</span><br><span class="line">    n = n1;</span><br><span class="line">    m = <span class="number">122</span>;</span><br><span class="line">    s[++ n] = <span class="string">&#x27;#&#x27;</span>;</span><br><span class="line">    <span class="built_in">rep</span>(i, <span class="number">1</span>, n2) s[++ n] = t[i];</span><br><span class="line">    <span class="built_in">getSA</span>();        <span class="comment">//  求sa</span></span><br><span class="line">    <span class="built_in">getHeight</span>();    <span class="comment">//  求height</span></span><br><span class="line">    <span class="keyword">int</span> maxx = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">rep</span>(i, <span class="number">1</span>, n) &#123;</span><br><span class="line">        <span class="keyword">if</span>((sa[i] &gt; n1 &amp;&amp; sa[i - <span class="number">1</span>] &lt;= n1) || (sa[i] &lt;= n1 &amp;&amp; sa[i - <span class="number">1</span>] &gt; n1)) &#123;</span><br><span class="line">            maxx = <span class="built_in">max</span>(height[i], maxx);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; maxx &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>2.3.2、子串的个数</strong></p>
<p>　　<strong>例10：长度不小于k的公共子串的个数（pku3415）</strong></p>
<p>　　给定两个字符串A和B，求长度不小于k的公共子串的个数（可以相同）。</p>
<p>　　样例1：</p>
<p>　　A=“xx”，B=“xx”，k=1，长度不小于k的公共子串的个数是5。</p>
<p>　　样例2：</p>
<p>　　A =“aababaa”，B =“abaabaa”，k=2，长度不小于k的公共子串的个数是22。</p>
<p>　　算法分析：</p>
<p>　　基本思路是计算A的所有后缀和B的所有后缀之间的最长公共前缀的长度，把最长公共前缀长度不小于k的部分全部加起来。<strong>先将两个字符串连起来，中间用一个没有出现过的字符隔开。按$height$值分组后，接下来的工作便是快速的统计每组中后缀之间的最长公共前缀之和。</strong>扫描一遍，每遇到一个B的后缀就统计与前面的A的后缀能产生多少个长度不小于k的公共子串，这里A的后缀需要用一个单调的栈来高效的维护。然后对A也这样做一次。具体的细节留给读者思考。</p>
<p><strong>2.4、多个字符串的相关问题</strong></p>
<p>　　这类问题的一个常用做法是，先将所有的字符串连接起来，然后求后缀数组和height数组，再利用height数组进行求解。这中间可能需要二分答案。</p>
<p>　　<strong>例11：不小于k个字符串中的最长子串（pku3294）</strong></p>
<p>　　给定n个字符串，求出现在不小于k个字符串中的最长子串。</p>
<p>　　算法分析：</p>
<p>　　将n个字符串连起来，中间用不相同的且没有出现在字符串中的字符隔开，求后缀数组。然后二分答案，用和例3同样的方法将后缀分成若干组，判断每组的后缀是否出现在不小于k个的原串中。这个做法的时间复杂度为O(nlogn)。</p>
<p>　　<strong>例12：每个字符串至少出现两次且不重叠的最长子串（spoj220）</strong></p>
<p>　　给定n个字符串，求在每个字符串中至少出现两次且不重叠的最长子串。</p>
<p>　　算法分析：</p>
<p>　　做法和上题大同小异，也是先将n个字符串连起来，中间用不相同的且没有出现在字符串中的字符隔开，求后缀数组。然后二分答案，再将后缀分组。判断的时候，要看是否有一组后缀在每个原来的字符串中至少出现两次，并且在每个原来的字符串中，后缀的起始位置的最大值与最小值之差是否不小于当前答案（判断能否做到不重叠，如果题目中没有不重叠的要求，那么不用做此判断）。这个做法的时间复杂度为 O(nlogn)。</p>
<p>　　<strong>例13：出现或反转后出现在每个字符串中的最长子串（PKU3294）</strong></p>
<p>　　给定n个字符串，求出现或反转后出现在每个字符串中的最长子串。</p>
<p>　　算法分析：</p>
<p>　　这题不同的地方在于要判断是否在反转后的字符串中出现。其实这并没有加大题目的难度。只需要先将每个字符串都反过来写一遍，中间用一个互不相同的且没有出现在字符串中的字符隔开，再将n个字符串全部连起来，中间也是用一个互不相同的且没有出现在字符串中的字符隔开，求后缀数组。然后二分答案，再将后缀分组。判断的时候，要看是否有一组后缀在每个原来的字符串或反转后的字符串中出现。这个做法的时间复杂度为O(nlogn)。</p>
<h2 id="后缀自动机"><a href="#后缀自动机" class="headerlink" title="后缀自动机"></a>后缀自动机</h2><p>一、SAM的性质:</p>
<p>SAM是个状态机。一个起点，若干终点。原串的所有子串和从SAM起点开始的所有路径一一对应，不重不漏。所以终点就是包含后缀的点。<br>每个点包含若干子串，每个子串都一一对应一条从起点到该点的路径。且这些子串一定是里面最长子串的连续后缀。<br>SAM问题中经常考虑两种边：<br>(1) 普通边，类似于Trie。表示在某个状态所表示的所有子串的后面添加一个字符。<br>(2) Link、Father。表示将某个状态所表示的最短子串的首字母删除。这类边构成一棵树。<br>二、SAM的构造思路</p>
<p>$endpos(s)$：子串 $s$ 所有出现的位置（尾字母下标）集合。SAM中的每个状态都一一对应一个$endpos$ 的等价类。<br>$endpos$ 的性质：<br>(1) 令 $s_1,s_2$ 为 $s$ 的两个子串 ，不妨设 $|s1|≤|s2|$ （我们用 $|s|$ 表示 $s$ 的长度 ，此处等价于 $s_1$ 不长于 $s_2$ ）。则 $s_1$ 是 $s_2$ 的后缀当且仅当 $endpos(s1)⊇endpos(s2)$ ，$s_1$ 不是 $s_2$ 的后缀当且仅当 $endpos(s1)∩endpos(s2)=∅$　。<br>(2) 两个不同子串的 $endpos$，要么有包含关系，要么没有交集。<br>(3) 两个子串的 $endpos$ 相同，那么短串为长串的后缀。<br>(4) 对于一个状态 $st$ ，以及任意的 $longest(st)$ 的后缀 $s$ ，如果 $s$ 的长度满足：$|shortest(st)|≤|s|≤|longsest(st)|$ ，那么 $s∈substrings(st) $。</p>
<p>对于一个长度为 $n$ 的字符串构造后缀自动机，其中至多有 $2n−1$ 个节点与 $3n−4$ 条转移边。</p>
<h3 id="板"><a href="#板" class="headerlink" title="板"></a>板</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sam</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> len, fa;</span><br><span class="line">	<span class="keyword">int</span> ch[<span class="number">27</span>];</span><br><span class="line">&#125;sam[N];</span><br><span class="line"><span class="keyword">char</span> s[N];</span><br><span class="line"><span class="keyword">int</span> tot = <span class="number">1</span>, last = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">extend</span><span class="params">(<span class="keyword">int</span> c)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> p = last, np = last = ++ tot;</span><br><span class="line">	sam[np].len = sam[p].len + <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(; p &amp;&amp; !sam[p].ch[c]; p = sam[p].fa) sam[p].ch[c] = np;</span><br><span class="line">	<span class="keyword">if</span>(!p) sam[np].fa = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">int</span> q = sam[p].ch[c];</span><br><span class="line">		<span class="keyword">if</span>(sam[q].len == sam[p].len + <span class="number">1</span>) sam[np].fa = q;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">int</span> nq = ++ tot;</span><br><span class="line">			sam[nq] = sam[q], sam[nq].len = sam[p].len + <span class="number">1</span>;</span><br><span class="line">			sam[q].fa = sam[np].fa = nq;</span><br><span class="line">			<span class="keyword">for</span>(; p &amp;&amp; sam[p].ch[c] == q; p = sam[p].fa) sam[p].ch[c] = nq;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	cin &gt;&gt; s;</span><br><span class="line">	<span class="keyword">int</span> n = <span class="built_in">strlen</span>(s);</span><br><span class="line">	<span class="built_in">rep</span>(i, <span class="number">0</span>, n - <span class="number">1</span>) <span class="built_in">extend</span>(s[i] - <span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">    <span class="comment">/*code*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="例题-1"><a href="#例题-1" class="headerlink" title="例题"></a>例题</h3><h4 id="最长公共前缀"><a href="#最长公共前缀" class="headerlink" title="最长公共前缀"></a>最长公共前缀</h4><p>给一个长度为 $n$ 的串，仅包含$’W’, ‘E’, ‘N’, ‘S’$， $m$ 次查询，问每个串的最长公共前缀，长度1e7</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> endl <span class="meta-string">&quot;\n&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ff double</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></span><br><span class="line"><span class="comment">// #define int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> all(x) x.begin(), x.end()</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mem(a, b) memset(a, b, sizeof a)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rep(i, a, b) for(int i = (int)a; i &lt;= (int)b; i ++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> per(i, a, b) for(int i = (int)a; i &gt;= (int)b; i --)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IOS ios::sync_with_stdio(0); cin.tie(0); cout.tie(0)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e7</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">int</span> n, m;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sam</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> len, fa;</span><br><span class="line">	<span class="keyword">int</span> ch[<span class="number">4</span>];		</span><br><span class="line">&#125;sam[N &lt;&lt; <span class="number">1</span>];</span><br><span class="line"><span class="keyword">int</span> tot = <span class="number">1</span>, last = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">char</span> s[N];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">get</span><span class="params">(<span class="keyword">char</span> c)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(c == <span class="string">&#x27;W&#x27;</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span>(c == <span class="string">&#x27;E&#x27;</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span>(c == <span class="string">&#x27;N&#x27;</span>) <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">extend</span><span class="params">(<span class="keyword">int</span> c)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> p = last, np = last = ++ tot;</span><br><span class="line">	sam[np].len = sam[p].len + <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(; p &amp;&amp; !sam[p].ch[c]; p = sam[p].fa) sam[p].ch[c] = np;</span><br><span class="line">	<span class="keyword">if</span>(!p) sam[np].fa = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">int</span> q = sam[p].ch[c];</span><br><span class="line">		<span class="keyword">if</span>(sam[q].len == sam[p].len + <span class="number">1</span>) sam[np].fa = q;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">int</span> nq = ++ tot;</span><br><span class="line">			sam[nq] = sam[q], sam[nq].len = sam[p].len + <span class="number">1</span>;</span><br><span class="line">			sam[q].fa = sam[np].fa = nq;</span><br><span class="line">			<span class="keyword">for</span>(; p &amp;&amp; sam[p].ch[c] == q; p = sam[p].fa) sam[p].ch[c] = nq;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, s);</span><br><span class="line">	<span class="built_in">rep</span>(i, <span class="number">0</span>, n - <span class="number">1</span>) <span class="built_in">extend</span>(<span class="built_in">get</span>(s[i]));</span><br><span class="line">	<span class="keyword">while</span>(m --) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, s);</span><br><span class="line">		<span class="keyword">int</span> pos = <span class="number">1</span>, ans = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">int</span> len = <span class="built_in">strlen</span>(s);</span><br><span class="line">		<span class="built_in">rep</span>(i, <span class="number">0</span>, len - <span class="number">1</span>) &#123;</span><br><span class="line">			<span class="keyword">int</span> c = <span class="built_in">get</span>(s[i]);</span><br><span class="line">			<span class="keyword">if</span>(sam[pos].ch[c]) pos = sam[pos].ch[c], ans ++;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="最长公共子串"><a href="#最长公共子串" class="headerlink" title="最长公共子串"></a>最长公共子串</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> endl <span class="meta-string">&quot;\n&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ff double</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> all(x) x.begin(), x.end()</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mem(a, b) memset(a, b, sizeof a)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rep(i, a, b) for(int i = (int)a; i &lt;= (int)b; i ++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> per(i, a, b) for(int i = (int)a; i &gt;= (int)b; i --)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IOS ios::sync_with_stdio(0); cin.tie(0); cout.tie(0)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">2e4</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = N &lt;&lt; <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sam</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> len, fa;</span><br><span class="line">	<span class="keyword">int</span> ch[<span class="number">26</span>];</span><br><span class="line">&#125;sam[N];</span><br><span class="line"><span class="keyword">int</span> n, q, h[N], e[M], ne[M], idx;</span><br><span class="line"><span class="keyword">char</span> s[N];</span><br><span class="line"><span class="keyword">int</span> ans[N], now[N];</span><br><span class="line"><span class="keyword">int</span> tot = <span class="number">1</span>, last = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">extend</span><span class="params">(<span class="keyword">int</span> c)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> p = last, np = last = ++ tot;</span><br><span class="line">	sam[np].len = sam[p].len + <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(; p &amp;&amp; !sam[p].ch[c]; p = sam[p].fa) sam[p].ch[c] = np;</span><br><span class="line">	<span class="keyword">if</span>(!p) sam[np].fa = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">int</span> q = sam[p].ch[c];</span><br><span class="line">		<span class="keyword">if</span>(sam[q].len == sam[p].len + <span class="number">1</span>) sam[np].fa = q;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">int</span> nq = ++ tot;</span><br><span class="line">			sam[nq] = sam[q], sam[nq].len = sam[p].len + <span class="number">1</span>;</span><br><span class="line">			sam[q].fa = sam[np].fa = nq;</span><br><span class="line">			<span class="keyword">for</span>(; p &amp;&amp; sam[p].ch[c] == q; p = sam[p].fa) sam[p].ch[c] = nq;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">	e[idx] = b; ne[idx] = h[a]; h[a] = idx ++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> pos)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = h[pos]; ~i; i = ne[i]) &#123;</span><br><span class="line">		<span class="keyword">int</span> j = e[i];</span><br><span class="line">		<span class="built_in">dfs</span>(j);</span><br><span class="line">		now[pos] = <span class="built_in">max</span>(now[pos], now[j]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">mem</span>(h, <span class="number">-1</span>); idx = <span class="number">0</span>;</span><br><span class="line">	cin &gt;&gt; q;</span><br><span class="line">	cin &gt;&gt; s;</span><br><span class="line">	n = <span class="built_in">strlen</span>(s);</span><br><span class="line">	<span class="built_in">rep</span>(i, <span class="number">0</span>, n - <span class="number">1</span>) <span class="built_in">extend</span>(s[i] - <span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">	<span class="built_in">rep</span>(i, <span class="number">1</span>, tot) ans[i] = sam[i].len;</span><br><span class="line">	<span class="built_in">rep</span>(i, <span class="number">2</span>, tot) <span class="built_in">add</span>(sam[i].fa, i);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span>(q --) &#123;</span><br><span class="line">		cin &gt;&gt; s;</span><br><span class="line">		<span class="built_in">mem</span>(now, <span class="number">0</span>); </span><br><span class="line">		<span class="keyword">int</span> pos = <span class="number">1</span>, t = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">int</span> len = <span class="built_in">strlen</span>(s);</span><br><span class="line">		<span class="built_in">rep</span>(j, <span class="number">0</span>, len - <span class="number">1</span>) &#123;</span><br><span class="line">			<span class="keyword">int</span> c = s[j] - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">			<span class="keyword">while</span>(pos &gt; <span class="number">1</span> &amp;&amp; !sam[pos].ch[c]) pos = sam[pos].fa, t = sam[pos].len;</span><br><span class="line">			<span class="keyword">if</span>(sam[pos].ch[c]) pos = sam[pos].ch[c], t ++;</span><br><span class="line">			now[pos] = <span class="built_in">max</span>(now[pos], t);  </span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">dfs</span>(<span class="number">1</span>);</span><br><span class="line">		<span class="built_in">rep</span>(j, <span class="number">1</span>, tot) ans[j] = <span class="built_in">min</span>(ans[j], now[j]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line">	<span class="built_in">rep</span>(i, <span class="number">1</span>, tot) res = <span class="built_in">max</span>(res, ans[i]);</span><br><span class="line">	cout &lt;&lt; res &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2022牛客3-H-Hacker"><a href="#2022牛客3-H-Hacker" class="headerlink" title="2022牛客3 H - Hacker"></a><a target="_blank" rel="noopener" href="https://ac.nowcoder.com/acm/contest/33188/H">2022牛客3 H - Hacker</a></h4><p>给一个母串和串相对位置的值，每次询问给一个串，求该串与母串的子串中子串对应位置的最大子段和。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> endl <span class="meta-string">&quot;\n&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ff double</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> all(x) x.begin(), x.end()</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mem(a, b) memset(a, b, sizeof a)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rep(i, a, b) for(int i = (int)a; i &lt;= (int)b; i ++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> per(i, a, b) for(int i = (int)a; i &gt;= (int)b; i --)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IOS ios::sync_with_stdio(0); cin.tie(0); cout.tie(0)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">int</span> n, m, k;</span><br><span class="line"><span class="keyword">int</span> tot = <span class="number">1</span>, last = <span class="number">1</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sam</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> len, fa;</span><br><span class="line">	<span class="keyword">int</span> ch[<span class="number">26</span>];</span><br><span class="line">&#125;sam[N &lt;&lt; <span class="number">1</span>];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> l, r, lmax, rmax, tmax, sum;</span><br><span class="line">	<span class="meta">#<span class="meta-keyword">define</span> lc i &lt;&lt; 1</span></span><br><span class="line">	<span class="meta">#<span class="meta-keyword">define</span> rc i &lt;&lt; 1 | 1</span></span><br><span class="line">&#125;tr[N &lt;&lt; <span class="number">2</span>];</span><br><span class="line">string s, t;</span><br><span class="line"><span class="keyword">int</span> v[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">extend</span><span class="params">(<span class="keyword">int</span> c)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> p = last, np = last = ++ tot;</span><br><span class="line">    sam[np].len = sam[p].len + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(; p &amp;&amp; !sam[p].ch[c]; p = sam[p].fa) sam[p].ch[c] = np;</span><br><span class="line">    <span class="keyword">if</span>(!p) sam[np].fa = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">int</span> q = sam[p].ch[c];</span><br><span class="line">        <span class="keyword">if</span>(sam[q].len == sam[p].len + <span class="number">1</span>) sam[np].fa = q;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> nq = ++tot;</span><br><span class="line">            sam[nq] = sam[q], sam[nq].len = sam[p].len + <span class="number">1</span>;</span><br><span class="line">            sam[q].fa = sam[np].fa = nq;</span><br><span class="line">            <span class="keyword">for</span>(; p &amp;&amp; sam[p].ch[c] == q; p = sam[p].fa) sam[p].ch[c] = nq;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(node &amp;i, node &amp;l, node &amp;r)</span> </span>&#123;</span><br><span class="line">	i.sum = l.sum + r.sum;</span><br><span class="line">    i.lmax = <span class="built_in">max</span>(l.lmax, l.sum + r.lmax);</span><br><span class="line">    i.rmax = <span class="built_in">max</span>(r.rmax, r.sum + l.rmax);</span><br><span class="line">    i.tmax = <span class="built_in">max</span>(<span class="built_in">max</span>(l.tmax, r.tmax), l.rmax + r.lmax);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">	<span class="built_in">pushup</span>(tr[i], tr[lc], tr[rc]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">	tr[i] = &#123;l, r&#125;;</span><br><span class="line">	<span class="keyword">if</span>(l == r) &#123;</span><br><span class="line">		tr[i].lmax = tr[i].rmax = tr[i].tmax = tr[i].sum = v[l];</span><br><span class="line">		<span class="keyword">return</span> ;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">int</span> mid = tr[i].l + tr[i].r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">	<span class="built_in">build</span>(lc, l, mid); <span class="built_in">build</span>(rc, mid + <span class="number">1</span>, r);</span><br><span class="line">	<span class="built_in">pushup</span>(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">node <span class="title">query</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(l &lt;= tr[i].l &amp;&amp; tr[i].r &lt;= r) <span class="keyword">return</span> tr[i];</span><br><span class="line">	<span class="keyword">int</span> mid = tr[i].l + tr[i].r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span>(r &lt;= mid) <span class="keyword">return</span> <span class="built_in">query</span>(lc, l, r);</span><br><span class="line">	<span class="keyword">if</span>(l &gt; mid) <span class="keyword">return</span> <span class="built_in">query</span>(rc, l, r);</span><br><span class="line">	node ans ;</span><br><span class="line">	node lf = <span class="built_in">query</span>(lc, l, r);</span><br><span class="line">	node rf = <span class="built_in">query</span>(rc, l, r);</span><br><span class="line">	<span class="built_in">pushup</span>(ans, lf, rf);</span><br><span class="line">	<span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">solve</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> p = <span class="number">1</span>, t = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">	<span class="built_in">rep</span>(i, <span class="number">0</span>, s.<span class="built_in">size</span>() - <span class="number">1</span>) &#123;</span><br><span class="line">		<span class="keyword">int</span> c = s[i] - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">		<span class="keyword">while</span>(p &gt; <span class="number">1</span> &amp;&amp; !sam[p].ch[c]) p = sam[p].fa, t = sam[p].len; </span><br><span class="line">		<span class="keyword">if</span>(sam[p].ch[c]) p = sam[p].ch[c], t ++;</span><br><span class="line">		<span class="keyword">if</span>(!t) <span class="keyword">continue</span>;</span><br><span class="line">		ans = <span class="built_in">max</span>(ans, <span class="built_in">query</span>(<span class="number">1</span>, i + <span class="number">1</span> - t + <span class="number">1</span>, i + <span class="number">1</span>).tmax);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	IOS; cin &gt;&gt; n &gt;&gt; m &gt;&gt; k;</span><br><span class="line">	cin &gt;&gt; s;</span><br><span class="line">	<span class="built_in">rep</span>(i, <span class="number">0</span>, s.<span class="built_in">size</span>() - <span class="number">1</span>) <span class="built_in">extend</span>(s[i] - <span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">	<span class="built_in">rep</span>(i, <span class="number">1</span>, m) cin &gt;&gt; v[i];</span><br><span class="line">	<span class="built_in">build</span>(<span class="number">1</span>, <span class="number">1</span>, m);</span><br><span class="line">	<span class="keyword">while</span>(k --) &#123;</span><br><span class="line">		cin &gt;&gt; t;	</span><br><span class="line">		cout &lt;&lt; <span class="built_in">solve</span>(t) &lt;&lt; endl;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="计算几何"><a href="#计算几何" class="headerlink" title="计算几何"></a>计算几何</h1><h2 id="点、线、凸包、圆、三维点、三维线、三维平面"><a href="#点、线、凸包、圆、三维点、三维线、三维平面" class="headerlink" title="点、线、凸包、圆、三维点、三维线、三维平面"></a>点、线、凸包、圆、三维点、三维线、三维平面</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ff eps = <span class="number">1e-8</span>;</span><br><span class="line"><span class="keyword">const</span> ff inf = <span class="number">1e20</span>;</span><br><span class="line"><span class="keyword">const</span> ff pi = <span class="built_in">acos</span>(<span class="number">-1.0</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxp = <span class="number">1010</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sgn</span><span class="params">(ff x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">fabs</span>(x) &lt; eps) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span> (x &lt; <span class="number">0</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ff <span class="title">sqr</span><span class="params">(ff x)</span> </span>&#123; <span class="keyword">return</span> x * x; &#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Compare</span><span class="params">(Point p, Point q, Point y)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">abs</span>((q - p) ^ (y - q)); &#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span> &#123;</span></span><br><span class="line">	ff x,y;</span><br><span class="line">	<span class="built_in">Point</span>()&#123;&#125;</span><br><span class="line">	<span class="built_in">Point</span>(ff x, ff y): <span class="built_in">x</span>(x), <span class="built_in">y</span>(y)&#123;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">input</span><span class="params">()</span> </span>&#123; <span class="built_in">scanf</span>(<span class="string">&quot;%lf%lf&quot;</span>,&amp;x,&amp;y); &#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">output</span><span class="params">(<span class="keyword">int</span> k)</span> </span>&#123; cout &lt;&lt; fixed &lt;&lt; <span class="built_in">setprecision</span>(k) &lt;&lt; x &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; y &lt;&lt; endl; &#125;</span><br><span class="line">	<span class="keyword">bool</span> <span class="keyword">operator</span> == (<span class="keyword">const</span> Point &amp;b) <span class="keyword">const</span> &#123; </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sgn</span>(x - b.x) == <span class="number">0</span> &amp;&amp; <span class="built_in">sgn</span>(y - b.y) == <span class="number">0</span>; </span><br><span class="line">    &#125;</span><br><span class="line">	<span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Point &amp;b) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sgn</span>(x - b.x) == <span class="number">0</span> ? <span class="built_in">sgn</span>(y - b.y) &lt; <span class="number">0</span> : x &lt; b.x; </span><br><span class="line">    &#125;</span><br><span class="line">	Point <span class="keyword">operator</span> + (<span class="keyword">const</span> Point &amp;b) <span class="keyword">const</span> &#123; <span class="keyword">return</span> <span class="built_in">Point</span>(x + b.x, y + b.y); &#125;</span><br><span class="line">	Point <span class="keyword">operator</span> - (<span class="keyword">const</span> Point &amp;b) <span class="keyword">const</span> &#123; <span class="keyword">return</span> <span class="built_in">Point</span>(x - b.x, y - b.y); &#125;</span><br><span class="line">	Point <span class="keyword">operator</span> * (<span class="keyword">const</span> ff &amp;k) <span class="keyword">const</span> &#123; <span class="keyword">return</span> <span class="built_in">Point</span>(x * k, y * k); &#125;</span><br><span class="line">	Point <span class="keyword">operator</span> / (<span class="keyword">const</span> ff &amp;k) <span class="keyword">const</span> &#123; <span class="keyword">return</span> <span class="built_in">Point</span>(x / k, y / k); &#125;</span><br><span class="line">	ff <span class="keyword">operator</span> ^ (<span class="keyword">const</span> Point &amp;b) <span class="keyword">const</span> &#123; <span class="keyword">return</span> x * b.y - y * b.x; &#125;	<span class="comment">//叉积</span></span><br><span class="line">	ff <span class="keyword">operator</span> * (<span class="keyword">const</span> Point &amp;b) <span class="keyword">const</span> &#123; <span class="keyword">return</span> x * b.x + y * b.y; &#125;	<span class="comment">//点积</span></span><br><span class="line">	<span class="function">ff <span class="title">len</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">hypot</span>(x, y); &#125;	<span class="comment">//返回长度</span></span><br><span class="line">	<span class="function">ff <span class="title">len2</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> x * x + y * y; &#125;	<span class="comment">//返回长度的平方</span></span><br><span class="line">	<span class="function">ff <span class="title">distance</span><span class="params">(Point p)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">hypot</span>(x - p.x, y - p.y); &#125;	<span class="comment">//返回两点的距离</span></span><br><span class="line">	<span class="comment">//计算 pa 和 pb 的夹角</span></span><br><span class="line">	<span class="comment">//就是求这个点看 a,b 所成的夹角</span></span><br><span class="line">	<span class="function">ff <span class="title">rad</span><span class="params">(Point a, Point b)</span> </span>&#123;</span><br><span class="line">		Point p = *<span class="keyword">this</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">fabs</span>(<span class="built_in">atan2</span>(<span class="built_in">fabs</span>((a - p) ^ (b - p)), (a - p) * (b - p)));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">Point <span class="title">trunc</span><span class="params">(ff r)</span> </span>&#123;     <span class="comment">//化为长度为 r 的向量</span></span><br><span class="line">		ff l = <span class="built_in">len</span>();</span><br><span class="line">		<span class="keyword">if</span>(!<span class="built_in">sgn</span>(l)) <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">		r /= l;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">Point</span>(x * r, y * r);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">Point <span class="title">rotleft</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">Point</span>(-y, x); &#125;	<span class="comment">//逆时针旋转 90 度</span></span><br><span class="line">	<span class="function">Point <span class="title">rotright</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">Point</span>(y, -x); &#125;	<span class="comment">//顺时针旋转 90 度</span></span><br><span class="line">	<span class="function">Point <span class="title">rotate</span><span class="params">(Point p,ff angle)</span> </span>&#123;    <span class="comment">//绕着 p 点逆时针旋转 angle</span></span><br><span class="line">		Point v = (*<span class="keyword">this</span>) - p;</span><br><span class="line">		ff c = <span class="built_in">cos</span>(angle), s = <span class="built_in">sin</span>(angle);</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">Point</span>(p.x + v.x * c - v.y * s, p.y + v.x * s + v.y * c);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Line</span>&#123;</span></span><br><span class="line">    Point s, e;</span><br><span class="line">    <span class="built_in">Line</span>() &#123;&#125;</span><br><span class="line">    <span class="built_in">Line</span>(Point s, Point e):<span class="built_in">s</span>(s), <span class="built_in">e</span>(e)&#123;&#125;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> == (<span class="keyword">const</span> Line &amp;v)&#123; <span class="built_in"><span class="keyword">return</span></span> (s == v.s) &amp;&amp; (e == v.e); &#125;</span><br><span class="line">    <span class="comment">//根据一个点和倾斜角 angle 确定直线,0&lt;=angle&lt;pi</span></span><br><span class="line">    <span class="built_in">Line</span>(Point p, ff angle)&#123;</span><br><span class="line">        s = p;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">sgn</span>(angle - pi / <span class="number">2</span>) == <span class="number">0</span>)</span><br><span class="line">            e = (s + <span class="built_in">Point</span>(<span class="number">0</span>, <span class="number">1</span>));</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            e = (s + <span class="built_in">Point</span>(<span class="number">1</span>, <span class="built_in">tan</span>(angle)));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ax + by + c = 0</span></span><br><span class="line">    <span class="built_in">Line</span>(ff a, ff b, ff c)&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">sgn</span>(a) == <span class="number">0</span>)&#123;</span><br><span class="line">            s = <span class="built_in">Point</span>(<span class="number">0</span>, -c / b);</span><br><span class="line">            e = <span class="built_in">Point</span>(<span class="number">1</span>, -c / b);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">sgn</span>(b) == <span class="number">0</span>)&#123;</span><br><span class="line">            s = <span class="built_in">Point</span>(-c / a, <span class="number">0</span>);</span><br><span class="line">            e = <span class="built_in">Point</span>(-c / a, <span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            s = <span class="built_in">Point</span>(<span class="number">0</span>, -c / b);</span><br><span class="line">            e = <span class="built_in">Point</span>(<span class="number">1</span>, (-c - a) / b);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">input</span><span class="params">()</span> </span>&#123; s.<span class="built_in">input</span>(); e.<span class="built_in">input</span>(); &#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">adjust</span><span class="params">()</span></span>&#123; <span class="keyword">if</span> (e &lt; s) <span class="built_in">swap</span>(s, e); &#125;</span><br><span class="line">    <span class="function">ff <span class="title">length</span><span class="params">()</span></span>&#123; <span class="keyword">return</span> s.<span class="built_in">distance</span>(e); &#125;    <span class="comment">//求线段长度</span></span><br><span class="line">	<span class="function">ff <span class="title">angle</span><span class="params">()</span></span>&#123;         <span class="comment">//返回直线倾斜角 0&lt;=angle&lt;pi</span></span><br><span class="line">		ff k = <span class="built_in">atan2</span>(e.y - s.y, e.x - s.x);</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">sgn</span>(k) &lt; <span class="number">0</span>) k += pi;</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">sgn</span>(k - pi) == <span class="number">0</span>) k  -= pi;</span><br><span class="line">		<span class="keyword">return</span> k;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//点和直线关系</span></span><br><span class="line">	<span class="comment">// 1 在左侧</span></span><br><span class="line">	<span class="comment">// 2 在右侧</span></span><br><span class="line">	<span class="comment">// 3 在直线上</span></span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">relation</span><span class="params">(Point p)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> c = <span class="built_in">sgn</span>((p - s) ^ (e - s));</span><br><span class="line">		<span class="keyword">if</span> (c &lt; <span class="number">0</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (c &gt; <span class="number">0</span>) <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">pointOnSeg</span><span class="params">(Point p)</span></span>&#123;	<span class="comment">// 点在线段上的判断</span></span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">sgn</span>((p - s) ^ (e - s)) == <span class="number">0</span> &amp;&amp; <span class="built_in">sgn</span>((p - s) * (p - e)) &lt;= <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//两向量平行 (对应直线平行或重合)</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">parallel</span><span class="params">(Line v)</span></span>&#123; <span class="keyword">return</span> <span class="built_in">sgn</span>((e - s) ^ (v.e - v.s)) == <span class="number">0</span>; &#125;</span><br><span class="line">	<span class="comment">//两线段相交判断</span></span><br><span class="line">	<span class="comment">// 2 规范相交</span></span><br><span class="line">	<span class="comment">// 1 非规范相交</span></span><br><span class="line">	<span class="comment">// 0 不相交</span></span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">segCrossSeg</span><span class="params">(Line v)</span></span>&#123;</span><br><span class="line">		<span class="keyword">int</span> d1 = <span class="built_in">sgn</span>((e - s) ^ (v.s - s));</span><br><span class="line">		<span class="keyword">int</span> d2 = <span class="built_in">sgn</span>((e - s) ^ (v.e - s));</span><br><span class="line">		<span class="keyword">int</span> d3 = <span class="built_in">sgn</span>((v.e - v.s) ^ (s - v.s));</span><br><span class="line">		<span class="keyword">int</span> d4 = <span class="built_in">sgn</span>((v.e - v.s) ^ (e - v.s));</span><br><span class="line">		<span class="keyword">if</span> ((d1 ^ d2) == - <span class="number">2</span> &amp;&amp; (d3 ^ d4) == - <span class="number">2</span>) <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">		<span class="keyword">return</span> (d1 == <span class="number">0</span> &amp;&amp; <span class="built_in">sgn</span>((v.s - s) * (v.s - e)) &lt;= <span class="number">0</span>) ||</span><br><span class="line">			(d2 == <span class="number">0</span> &amp;&amp; <span class="built_in">sgn</span>((v.e - s) * (v.e - e)) &lt;= <span class="number">0</span>) ||</span><br><span class="line">			(d3 == <span class="number">0</span> &amp;&amp; <span class="built_in">sgn</span>((s - v.s) * (s - v.e)) &lt;= <span class="number">0</span>) ||</span><br><span class="line">			(d4 == <span class="number">0</span> &amp;&amp; <span class="built_in">sgn</span>((e - v.s) * (e - v.e)) &lt;= <span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//直线和线段相交判断</span></span><br><span class="line">	<span class="comment">//-*this line -v seg</span></span><br><span class="line">	<span class="comment">// 2 规范相交</span></span><br><span class="line">	<span class="comment">// 1 非规范相交</span></span><br><span class="line">	<span class="comment">// 0 不相交</span></span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">lineCrossSeg</span><span class="params">(Line v)</span></span>&#123;</span><br><span class="line">		<span class="keyword">int</span> d1 = <span class="built_in">sgn</span>((e - s) ^ (v.s - s));</span><br><span class="line">		<span class="keyword">int</span> d2 = <span class="built_in">sgn</span>((e - s) ^ (v.e - s));</span><br><span class="line">		<span class="keyword">if</span> ((d1 ^ d2) == <span class="number">-2</span>)</span><br><span class="line">			<span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">		<span class="keyword">return</span> (d1 == <span class="number">0</span> || d2 == <span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//两直线关系</span></span><br><span class="line">	<span class="comment">// 0 平行</span></span><br><span class="line">	<span class="comment">// 1 重合</span></span><br><span class="line">	<span class="comment">// 2 相交</span></span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">lineCrossLine</span><span class="params">(Line v)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span> ((*<span class="keyword">this</span>).<span class="built_in">parallel</span>(v))</span><br><span class="line">			<span class="keyword">return</span> v.<span class="built_in">relation</span>(s) == <span class="number">3</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//求两直线的交点</span></span><br><span class="line">	<span class="comment">//要保证两直线不平行或重合</span></span><br><span class="line">	<span class="function">Point <span class="title">crossPoint</span><span class="params">(Line v)</span></span>&#123;</span><br><span class="line">		<span class="keyword">double</span> a1 = (v.e - v.s) ^ (s - v.s);</span><br><span class="line">		<span class="keyword">double</span> a2 = (v.e - v.s) ^ (e - v.s);</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">Point</span>((s.x*a2 - e.x*a1)/(a2 - a1),(s.y*a2 - e.y*a1)/(a2 - a1));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//点到直线的距离</span></span><br><span class="line">	<span class="function"><span class="keyword">double</span> <span class="title">disPointToLine</span><span class="params">(Point p)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">fabs</span>((p - s) ^ (e - s)) / <span class="built_in">length</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//点到线段的距离</span></span><br><span class="line">	<span class="function"><span class="keyword">double</span> <span class="title">disPointToSeg</span><span class="params">(Point p)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">sgn</span>((p - s) * (e - s)) &lt; <span class="number">0</span> || <span class="built_in">sgn</span>((p - e) * (s - e)) &lt; <span class="number">0</span>)</span><br><span class="line">			<span class="keyword">return</span> <span class="built_in">min</span>(p.<span class="built_in">distance</span>(s), p.<span class="built_in">distance</span>(e));</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">disPointToLine</span>(p);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//返回线段到线段的距离</span></span><br><span class="line">	<span class="comment">//前提是两线段不相交，相交距离就是 0 了</span></span><br><span class="line">	<span class="function"><span class="keyword">double</span> <span class="title">disSegToSeg</span><span class="params">(Line v)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">min</span>(<span class="built_in">min</span>(<span class="built_in">disPointToSeg</span>(v.s), <span class="built_in">disPointToSeg</span>(v.e)), <span class="built_in">min</span>(v.<span class="built_in">disPointToSeg</span>(s), v.<span class="built_in">disPointToSeg</span>(e)));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//返回点 p 在直线上的投影</span></span><br><span class="line">	<span class="function">Point <span class="title">lineprog</span><span class="params">(Point p)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> s + (((e - s) * ((e - s) * (p - s))) / ((e - s).<span class="built_in">len2</span>()));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//返回点 p 关于直线的对称点</span></span><br><span class="line">	<span class="function">Point <span class="title">symmetryPoint</span><span class="params">(Point p)</span></span>&#123;</span><br><span class="line">		Point q = <span class="built_in">lineprog</span>(p);</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">Point</span>(<span class="number">2</span> * q.x - p.x, <span class="number">2</span> * q.y - p.y);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Polygon</span> &#123;</span>		<span class="comment">//凸包</span></span><br><span class="line">    <span class="keyword">int</span> n; </span><br><span class="line">    Point p[N];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">input</span><span class="params">(<span class="keyword">int</span> _n)</span> </span>&#123;</span><br><span class="line">        n = _n;</span><br><span class="line">        <span class="built_in">rep</span>(i, <span class="number">0</span>, n - <span class="number">1</span>) p[i].<span class="built_in">input</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">cmp</span> &#123;</span>		<span class="comment">//比较机制</span></span><br><span class="line">        <span class="function"><span class="keyword">bool</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">const</span> Point&amp; a, <span class="keyword">const</span> Point&amp; b)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">			<span class="keyword">const</span> <span class="keyword">auto</span> quad = [](<span class="keyword">const</span> Point&amp; a) &#123;</span><br><span class="line">				<span class="keyword">if</span> (a.y &lt; -eps) <span class="keyword">return</span> <span class="number">1</span>;<span class="comment">//下半平面</span></span><br><span class="line">				<span class="keyword">if</span> (a.y &gt; eps) <span class="keyword">return</span> <span class="number">4</span>;<span class="comment">//上半平面</span></span><br><span class="line">				<span class="keyword">if</span> (a.x &lt; -eps) <span class="keyword">return</span> <span class="number">5</span>;<span class="comment">//x负半轴</span></span><br><span class="line">				<span class="keyword">if</span> (a.x &gt; eps) <span class="keyword">return</span> <span class="number">3</span>;<span class="comment">//x正半轴</span></span><br><span class="line">				<span class="keyword">return</span> <span class="number">2</span>;<span class="comment">//原点</span></span><br><span class="line">			&#125;;</span><br><span class="line">			<span class="keyword">const</span> <span class="keyword">int</span> qa = <span class="built_in">quad</span>(a), qb = <span class="built_in">quad</span>(b);</span><br><span class="line">			<span class="keyword">if</span> (qa != qb) <span class="keyword">return</span> qa &lt; qb;</span><br><span class="line">			<span class="keyword">const</span> <span class="keyword">auto</span> t = a ^ b;</span><br><span class="line">			<span class="comment">// if (abs(t)&lt;=eps) return a*a&lt;b*b-eps;  // 不同长度的向量需要分开</span></span><br><span class="line">			<span class="keyword">return</span> t &gt; eps;</span><br><span class="line">		&#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">norm</span><span class="params">()</span> </span>&#123;		<span class="comment">//极角排序</span></span><br><span class="line">        <span class="built_in">sort</span>(p, p + n, <span class="built_in">cmp</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Graham</span><span class="params">()</span> </span>&#123;		<span class="comment">//求凸包</span></span><br><span class="line">        <span class="built_in">norm</span>();</span><br><span class="line">        <span class="keyword">if</span>(n == <span class="number">1</span>) &#123;</span><br><span class="line">            tt = <span class="number">1</span>; sta[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(n == <span class="number">2</span>) &#123;</span><br><span class="line">            tt = <span class="number">2</span>; sta[<span class="number">0</span>] = <span class="number">0</span>; sta[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">return</span> ; </span><br><span class="line">        &#125;</span><br><span class="line">        sta[<span class="number">0</span>] = <span class="number">0</span>; sta[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">        tt = <span class="number">2</span>;</span><br><span class="line">        <span class="built_in">rep</span>(i, <span class="number">2</span>, n - <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">while</span>(tt &gt; <span class="number">1</span> &amp;&amp; <span class="built_in">sgn</span>((p[sta[tt - <span class="number">1</span>]] - p[sta[tt - <span class="number">2</span>]]) ^ (p[i] - p[sta[tt - <span class="number">2</span>]])) &lt;= <span class="number">0</span>) tt --;</span><br><span class="line">            sta[tt ++] = i;</span><br><span class="line">        &#125;</span><br><span class="line">        n = tt;</span><br><span class="line">        <span class="built_in">rep</span>(i, <span class="number">0</span>, tt - <span class="number">1</span>) p[i] = p[sta[i]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">ff <span class="title">rotateCaliperGetWidth</span><span class="params">()</span> </span>&#123;		<span class="comment">//旋转卡壳求宽度</span></span><br><span class="line">        ff ans = <span class="number">4e8</span>;</span><br><span class="line">        Point v;</span><br><span class="line">        <span class="keyword">int</span> cur = <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">rep</span>(i, <span class="number">0</span>, n - <span class="number">1</span>) &#123;</span><br><span class="line">            v = p[i] - p[(i + <span class="number">1</span>) % n];</span><br><span class="line">            <span class="keyword">while</span>(<span class="built_in">sgn</span>(v ^ (p[(cur + <span class="number">1</span>) % n] - p[cur])) &lt; <span class="number">0</span>) cur = (cur + <span class="number">1</span>) % n;</span><br><span class="line">            ans = <span class="built_in">min</span>(ans, (p[cur] - p[(i + <span class="number">1</span>) % n] ^ (p[i] - p[(i + <span class="number">1</span>) % n])) / <span class="built_in">Line</span>(p[i], p[(i + <span class="number">1</span>) % n]).<span class="built_in">length</span>());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">ff <span class="title">rotateCaliperGetLength</span><span class="params">()</span> </span>&#123;		<span class="comment">//旋转卡壳求直径</span></span><br><span class="line">        <span class="keyword">int</span> j = <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">if</span>(n == <span class="number">2</span>) <span class="keyword">return</span> p[<span class="number">0</span>].<span class="built_in">distance</span>(p[<span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">if</span>(n == <span class="number">3</span>) <span class="keyword">return</span> <span class="built_in">max</span>(&#123;p[<span class="number">0</span>].<span class="built_in">distance</span>(p[<span class="number">1</span>]), p[<span class="number">1</span>].<span class="built_in">distance</span>(p[<span class="number">2</span>]), p[<span class="number">2</span>].<span class="built_in">distance</span>(p[<span class="number">0</span>])&#125;);</span><br><span class="line">        ff maxx = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">rep</span>(i, <span class="number">0</span>, n - <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">while</span>(<span class="built_in">Compare</span>(p[i], p[i + <span class="number">1</span>], p[j]) &lt; <span class="built_in">Compare</span>(p[i], p[i + <span class="number">1</span>], p[j + <span class="number">1</span>])) j = (j + <span class="number">1</span>) % n;</span><br><span class="line">            maxx = <span class="built_in">max</span>(&#123;maxx, p[j].<span class="built_in">distance</span>(p[i]), p[j].<span class="built_in">distance</span>(p[i + <span class="number">1</span>])&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> maxx;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        cout &lt;&lt; n &lt;&lt; endl;</span><br><span class="line">        <span class="built_in">rep</span>(i, <span class="number">0</span>, n - <span class="number">1</span>) p[i].<span class="built_in">print</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point3</span> &#123;</span>		<span class="comment">//三维点</span></span><br><span class="line">    ff x, y, z;</span><br><span class="line">    <span class="built_in">Point3</span>() &#123;&#125;</span><br><span class="line">    <span class="built_in">Point3</span>(ff x, ff y, ff z):<span class="built_in">x</span>(x), <span class="built_in">y</span>(y), <span class="built_in">z</span>(z) &#123;&#125;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> == (<span class="keyword">const</span> Point3 &amp;a) <span class="keyword">const</span> &#123; <span class="keyword">return</span> <span class="built_in">sgn</span>(x - a.x) == <span class="number">0</span> &amp;&amp; <span class="built_in">sgn</span>(y - a.y) == <span class="number">0</span> &amp;&amp; <span class="built_in">sgn</span>(z - a.z) == <span class="number">0</span>; &#125;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Point3 &amp;a) <span class="keyword">const</span> &#123; </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sgn</span>(x - a.x) == <span class="number">0</span> ? (<span class="built_in">sgn</span>(y - a.y) == <span class="number">0</span> ? <span class="built_in">sgn</span>(z - a.z) &lt; <span class="number">0</span> : y &lt; a.y) : x &lt; a.x; </span><br><span class="line">    &#125;</span><br><span class="line">    Point3 <span class="keyword">operator</span> + (<span class="keyword">const</span> Point3 &amp;a) &#123; <span class="keyword">return</span> <span class="built_in">Point3</span>(x + a.x, y + a.y, z + a.z); &#125;</span><br><span class="line">    Point3 <span class="keyword">operator</span> - (<span class="keyword">const</span> Point3 &amp;a) &#123; <span class="keyword">return</span> <span class="built_in">Point3</span>(x - a.x, y - a.y, z - a.z); &#125;</span><br><span class="line">    Point3 <span class="keyword">operator</span> * (<span class="keyword">const</span> ff &amp;k) &#123; <span class="keyword">return</span> <span class="built_in">Point3</span>(x * k, y * k); &#125;</span><br><span class="line">    Point3 <span class="keyword">operator</span> / (<span class="keyword">const</span> ff &amp;k) &#123; <span class="keyword">return</span> <span class="built_in">Point3</span>(x / k, y / k); &#125;</span><br><span class="line">    ff <span class="keyword">operator</span> * (<span class="keyword">const</span> Point3 &amp;a) &#123; <span class="keyword">return</span> x * a.x + y * a.y + z * a.z; &#125;</span><br><span class="line">    Point3 <span class="keyword">operator</span> ^ (<span class="keyword">const</span> Point3 &amp;a) &#123; </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Point</span>(y * a.z - z * a.y, z * a.x - x * a.z, x * a.y - y * a.x); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">ff <span class="title">len2</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> x * x + y * y + z * z; &#125;</span><br><span class="line">    <span class="function">ff <span class="title">len</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">sqrt</span>(<span class="built_in">len2</span>()); &#125;</span><br><span class="line">    <span class="function">ff <span class="title">distance</span><span class="params">(Point a)</span> </span>&#123;		<span class="comment">//两点距离</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sqrt</span>((x - a.x) * (x - a.x) + (y - a.y) * (y - a.y) + (z - a.z) * (z - a.z));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">ff <span class="title">rad</span><span class="params">(Point3 a, Point3 b)</span> </span>&#123;		<span class="comment">//∠APB</span></span><br><span class="line">        Point3 p = (*<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">acos</span>(((a - p) * (b - p)) / (a.<span class="built_in">distance</span>(p) * b.<span class="built_in">distance</span>(p)));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Point3 <span class="title">trunc</span><span class="params">(ff r)</span> </span>&#123;		<span class="comment">//更改长度</span></span><br><span class="line">        ff l = <span class="built_in">len</span>();</span><br><span class="line">        r /= l;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Point3</span>(x * r, y * r, z * r);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Line3</span> &#123;</span></span><br><span class="line">    Point3 s, e;</span><br><span class="line">    <span class="built_in">Line3</span>() &#123;&#125;</span><br><span class="line">    <span class="built_in">Line3</span>(Point3 s, Point3 e):<span class="built_in">s</span>(s), <span class="built_in">e</span>(e)&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">input</span><span class="params">()</span> </span>&#123; s.<span class="built_in">input</span>(); e.<span class="built_in">input</span>(); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123; s.<span class="built_in">print</span>(); e.<span class="built_in">print</span>(); &#125;</span><br><span class="line">    <span class="function">ff <span class="title">length</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> s.<span class="built_in">distance</span>(e); &#125;</span><br><span class="line">    <span class="function">ff <span class="title">dispointToLine</span><span class="params">(Point3 p)</span> </span>&#123;		<span class="comment">//直线与点距离</span></span><br><span class="line">        <span class="keyword">return</span> ((e - s) ^ (p - s)).<span class="built_in">len</span>() / s.<span class="built_in">distance</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">ff <span class="title">dispointToSeg</span><span class="params">(Point3 p)</span> </span>&#123;		<span class="comment">//线段与点距离</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">sgn</span>((p - s) * (e - s)) &lt; <span class="number">0</span> || <span class="built_in">sgn</span>((p - e) * (s - e)) &lt; <span class="number">0</span>) <span class="keyword">return</span> <span class="built_in">min</span>(p.<span class="built_in">distance</span>(s), e.<span class="built_in">distance</span>(p));</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">dispointToLine</span>(p);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Point3 <span class="title">lineProg</span><span class="params">(Point3 p)</span> </span>&#123;     	<span class="comment">//p在直线上的投影（垂足）</span></span><br><span class="line">        <span class="keyword">return</span> s + (((e - s) * ((e - s) * (p - s))) / ((e - s).<span class="built_in">len2</span>()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Point3 <span class="title">rotate</span><span class="params">(Point3 p, ff ang)</span> </span>&#123;	<span class="comment">//直线绕p逆时针旋转ang	ang单位以pi计</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">sgn</span>(((s - p) ^ (e - p)).<span class="built_in">len</span>()) == <span class="number">0</span>) <span class="keyword">return</span> p;</span><br><span class="line">        Point3 f1 = (e - s) ^ (p - s);</span><br><span class="line">        Point3 f2 = (e - s) ^ f1;</span><br><span class="line">        ff len = ((s - p) ^ (e - p)).<span class="built_in">len</span>() / <span class="built_in">length</span>();</span><br><span class="line">        f1 = f1.<span class="built_in">trunc</span>(len); f2 = f2.<span class="built_in">trunc</span>(len);</span><br><span class="line">        Point3 h = p + f2;</span><br><span class="line">        Point3 pp = h + f1;</span><br><span class="line">        <span class="keyword">return</span> h + ((p - h) * <span class="built_in">cos</span>(ang)) + ((pp - h) * <span class="built_in">sin</span>(ang));</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">pointOnSeg</span><span class="params">(Point3 p)</span> </span>&#123;		<span class="comment">//判断点在直线上</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sgn</span>(((s - p) ^ (e - p)).<span class="built_in">len</span>()) == <span class="number">0</span> &amp;&amp; <span class="built_in">sgn</span>((s - p) * (e - p)) == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Plane</span> &#123;</span>		<span class="comment">//三维平面</span></span><br><span class="line">    Point3 a, o;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">pointOnPlane</span><span class="params">(Point3 p)</span> </span>&#123;   <span class="comment">//判断点在平面上</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sgn</span>((p - a) * o) == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">ff <span class="title">anglePlane</span><span class="params">(Plane f)</span> </span>&#123;    <span class="comment">//求OF两平面夹角</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">acos</span>(o * f.o) / (o.<span class="built_in">len</span>() * f.o.<span class="built_in">len</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">crossLine</span><span class="params">(Line3 u, Point3 &amp;p)</span> </span>&#123; <span class="comment">//求平民啊直线交点，返回交点个数</span></span><br><span class="line">        ff x = o * (u.e - a);</span><br><span class="line">        ff y = o * (u.s - a);</span><br><span class="line">        ff d = x - y;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">sgn</span>(d) == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        p = ((u.s * x) - (u.e * y)) / d;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Point3 <span class="title">pointToPlane</span><span class="params">(Point3 p)</span> </span>&#123;     <span class="comment">//求点到平面投影（最近点）</span></span><br><span class="line">        Line3 u = <span class="built_in">Line3</span>(p, p + o);</span><br><span class="line">        <span class="built_in">crossLine</span>(u, p); <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">crossPlane</span><span class="params">(Plane f, Line3 &amp;u)</span> </span>&#123; <span class="comment">//求平面和平面交线</span></span><br><span class="line">        Point3 oo = o ^ f.o;</span><br><span class="line">        Point3 v = o ^ oo;</span><br><span class="line">        ff d = <span class="built_in">fabs</span>(f.o * v);</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">sgn</span>(d) == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        Point3 q = a + (v * (f.o * (f.a - a)) / d);</span><br><span class="line">        u = <span class="built_in">Line3</span>(q, q + oo);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="凸包旋转卡壳求宽度用法"><a href="#凸包旋转卡壳求宽度用法" class="headerlink" title="凸包旋转卡壳求宽度用法"></a>凸包旋转卡壳求宽度用法</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> sta[N], tt;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Polygon</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> n; </span><br><span class="line">    Point p[N];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">input</span><span class="params">(<span class="keyword">int</span> _n)</span> </span>&#123;</span><br><span class="line">        n = _n;</span><br><span class="line">        <span class="built_in">rep</span>(i, <span class="number">0</span>, n - <span class="number">1</span>) p[i].<span class="built_in">input</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">cmp</span> &#123;</span></span><br><span class="line">        Point p;</span><br><span class="line">        <span class="built_in">cmp</span>(<span class="keyword">const</span> Point &amp;p):<span class="built_in">p</span>(p) &#123;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">bool</span> <span class="title">operator</span> <span class="params">()</span> <span class="params">(<span class="keyword">const</span> Point &amp;aa, <span class="keyword">const</span> Point &amp;bb)</span> </span>&#123;</span><br><span class="line">            Point a = aa, b = bb;</span><br><span class="line">            ff d = ((a - p) ^ (b - p));</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">sgn</span>(d) == <span class="number">0</span>) <span class="keyword">return</span> <span class="built_in">sgn</span>(a.<span class="built_in">distance</span>(p) - b.<span class="built_in">distance</span>(p)) &lt; <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">sgn</span>(d) &gt; <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">norm</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Point minn = p[<span class="number">0</span>];</span><br><span class="line">        <span class="built_in">rep</span>(i, <span class="number">1</span>, n - <span class="number">1</span>) minn = <span class="built_in">min</span>(minn, p[i]);</span><br><span class="line">        <span class="built_in">sort</span>(p, p + n, <span class="built_in">cmp</span>(minn));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Graham</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">norm</span>();</span><br><span class="line">        <span class="keyword">if</span>(n == <span class="number">1</span>) &#123; tt = <span class="number">1</span>; sta[<span class="number">0</span>] = <span class="number">0</span>; <span class="keyword">return</span> ; &#125;</span><br><span class="line">        <span class="keyword">if</span>(n == <span class="number">2</span>) &#123; tt = <span class="number">2</span>; sta[<span class="number">0</span>] = <span class="number">0</span>; sta[<span class="number">1</span>] = <span class="number">1</span>; <span class="keyword">return</span> ; &#125;</span><br><span class="line">        sta[<span class="number">0</span>] = <span class="number">0</span>; sta[<span class="number">1</span>] = <span class="number">1</span>; tt = <span class="number">2</span>;</span><br><span class="line">        <span class="built_in">rep</span>(i, <span class="number">2</span>, n - <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">while</span>(tt &gt; <span class="number">1</span> &amp;&amp; <span class="built_in">sgn</span>((p[sta[tt - <span class="number">1</span>]] - p[sta[tt - <span class="number">2</span>]]) ^ (p[i] - p[sta[tt - <span class="number">2</span>]])) &lt;= <span class="number">0</span>) tt --;</span><br><span class="line">            sta[tt ++] = i;</span><br><span class="line">        &#125;</span><br><span class="line">        n = tt;</span><br><span class="line">        <span class="built_in">rep</span>(i, <span class="number">0</span>, tt - <span class="number">1</span>) p[i] = p[sta[i]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">ff <span class="title">rotateCaliper</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ff ans = <span class="number">4e8</span>;</span><br><span class="line">        Point v;</span><br><span class="line">        <span class="keyword">int</span> cur = <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">rep</span>(i, <span class="number">0</span>, n - <span class="number">1</span>) &#123;</span><br><span class="line">            v = p[i] - p[(i + <span class="number">1</span>) % n];</span><br><span class="line">            <span class="keyword">while</span>(<span class="built_in">sgn</span>(v ^ (p[(cur + <span class="number">1</span>) % n] - p[cur])) &lt; <span class="number">0</span>) cur = (cur + <span class="number">1</span>) % n;</span><br><span class="line">            ans = <span class="built_in">min</span>(ans, (p[cur] - p[(i + <span class="number">1</span>) % n] ^ (p[i] - p[(i + <span class="number">1</span>) % n])) / <span class="built_in">Line</span>(p[i], p[(i + <span class="number">1</span>) % n]).<span class="built_in">length</span>());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; r;</span><br><span class="line">    Polygon poly;</span><br><span class="line">    poly.<span class="built_in">input</span>(n);</span><br><span class="line">    poly.<span class="built_in">Graham</span>();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%.16Lf\n&quot;</span>, poly.<span class="built_in">rotateCaliper</span>());</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="扫描线"><a href="#扫描线" class="headerlink" title="扫描线"></a>扫描线</h2><h3 id="暴力"><a href="#暴力" class="headerlink" title="暴力"></a>暴力</h3><p>特别不建议暴力</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> x first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> y second</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> endl <span class="meta-string">&quot;\n&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ff double</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PII pair<span class="meta-string">&lt;int, int&gt;</span> </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> all(x) x.begin(), x.end()</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mem(a, b) memset(a, b, sizeof a)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rep(i, a, b) for(int i = (int)a; i &lt;= (int)b; i ++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> per(i, a, b) for(int i = (int)a; i &gt;= (int)b; i --)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IOS ios::sync_with_stdio(0); cin.tie(0); cout.tie(0)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e3</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line">PII l[N], r[N];</span><br><span class="line">PII p[N];</span><br><span class="line">vector&lt;<span class="keyword">int</span>&gt; x;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">cal</span><span class="params">(<span class="keyword">int</span> x1, <span class="keyword">int</span> x2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">rep</span>(i, <span class="number">1</span>, n) </span><br><span class="line">        <span class="keyword">if</span> (l[i].x &lt;= x1 &amp;&amp; r[i].x &gt;= x2) </span><br><span class="line">            p[cnt ++] = &#123;l[i].y, r[i].y&#125;;</span><br><span class="line">    <span class="keyword">if</span> (!cnt) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">sort</span>(p, p + cnt);</span><br><span class="line">    <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> s = p[<span class="number">0</span>].x, t = p[<span class="number">0</span>].y;</span><br><span class="line">    <span class="built_in">rep</span>(i, <span class="number">1</span>, cnt - <span class="number">1</span>) </span><br><span class="line">        <span class="keyword">if</span>(p[i].x &lt;= t) t = <span class="built_in">max</span>(t, p[i].y);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            ans += t - s;</span><br><span class="line">            s = p[i].x, t = p[i].y;</span><br><span class="line">        &#125;</span><br><span class="line">    ans += t - s;</span><br><span class="line">    <span class="keyword">return</span> ans * (x2 - x1);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="built_in">rep</span>(i, <span class="number">1</span>, n) &#123;</span><br><span class="line">        cin &gt;&gt; l[i].x &gt;&gt; l[i].y &gt;&gt; r[i].x &gt;&gt; r[i].y;</span><br><span class="line">        x.<span class="built_in">pb</span>(l[i].x); x.<span class="built_in">pb</span>(r[i].x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sort</span>(<span class="built_in">all</span>(x));</span><br><span class="line">    x.<span class="built_in">erase</span>(<span class="built_in">unique</span>(<span class="built_in">all</span>(x)), x.<span class="built_in">end</span>());</span><br><span class="line">    <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">rep</span>(i, <span class="number">0</span>, x.<span class="built_in">size</span>() - <span class="number">2</span>) </span><br><span class="line">        <span class="keyword">if</span>(x[i] != x[i + <span class="number">1</span>]) ans += <span class="built_in">cal</span>(x[i], x[i + <span class="number">1</span>]);</span><br><span class="line">    cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="线段树扫描线"><a href="#线段树扫描线" class="headerlink" title="线段树扫描线"></a>线段树扫描线</h3><p>详见数据结构 - 线段树 - 扫描线类</p>
<h1 id="图论"><a href="#图论" class="headerlink" title="图论"></a>图论</h1><h2 id="拓扑排序"><a href="#拓扑排序" class="headerlink" title="拓扑排序"></a>拓扑排序</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">topsort</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> hh = <span class="number">0</span>, tt = <span class="number">-1</span>;</span><br><span class="line">  <span class="comment">// d[i] 存储点i的入度</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i ++ )</span><br><span class="line">     <span class="keyword">if</span> (!d[i])</span><br><span class="line">     q[ ++ tt] = i;</span><br><span class="line">  <span class="keyword">while</span> (hh &lt;=  tt)&#123;</span><br><span class="line">     <span class="keyword">int</span> t = q[hh ++ ];</span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">int</span> i = h[t]; i !=  <span class="number">-1</span>; i = ne[i])&#123;</span><br><span class="line">       <span class="keyword">int</span> j = e[i];</span><br><span class="line">       <span class="keyword">if</span> (-- d[j] == <span class="number">0</span>)</span><br><span class="line">         q[ ++ tt] = j;</span><br><span class="line">     &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 如果所有点都入队了，说明存在拓扑序列；否则不存在拓扑序列。</span></span><br><span class="line">  <span class="keyword">return</span> tt ==  n - <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="堆优化Dijkstra"><a href="#堆优化Dijkstra" class="headerlink" title="堆优化Dijkstra"></a>堆优化Dijkstra</h2><p>时间复杂度 $O(mlogn)$, $n$ 表示点数，$m$ 表示边数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; PII;</span><br><span class="line"><span class="keyword">int</span> n;   <span class="comment">// 点的数量</span></span><br><span class="line"><span class="keyword">int</span> h[N], w[N], e[N], ne[N], idx;    <span class="comment">// 邻接表存储所有边</span></span><br><span class="line"><span class="keyword">int</span> dis[N];    <span class="comment">// 存储所有点到1号点的距离</span></span><br><span class="line"><span class="keyword">bool</span> st[N];   <span class="comment">// 存储每个点的最短距离是否已确定</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 求1号点到n号点的最短距离，如果不存在，则返回-1</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dijkstra</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="built_in">memset</span>(dis, <span class="number">0x3f</span>, <span class="keyword">sizeof</span> dis);</span><br><span class="line">  dis[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">  priority_queue&lt;PII, vector&lt;PII&gt;, greater&lt;PII&gt;&gt; heap;</span><br><span class="line">  heap.<span class="built_in">push</span>(&#123;<span class="number">0</span>, <span class="number">1</span>&#125;);   <span class="comment">// first存储距离，second存储节点编号</span></span><br><span class="line">  <span class="keyword">while</span> (heap.<span class="built_in">size</span>())&#123;</span><br><span class="line">     <span class="keyword">auto</span> t = heap.<span class="built_in">top</span>(); heap.<span class="built_in">pop</span>();</span><br><span class="line">     <span class="keyword">int</span> ver = t.second, disance = t.first;</span><br><span class="line">     <span class="keyword">if</span> (st[ver]) <span class="keyword">continue</span>;</span><br><span class="line">     st[ver] = <span class="literal">true</span>;</span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">int</span> i = h[ver]; i != <span class="number">-1</span>; i = ne[i])&#123;</span><br><span class="line">       <span class="keyword">int</span> j = e[i];</span><br><span class="line">       <span class="keyword">if</span> (dis[j] &gt; disance + w[i])&#123;</span><br><span class="line">         dis[j] = disance + w[i];</span><br><span class="line">         heap.<span class="built_in">push</span>(&#123;dis[j], j&#125;);</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (dis[n] == <span class="number">0x3f3f3f3f</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  <span class="keyword">return</span> dis[n];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="分层图"><a href="#分层图" class="headerlink" title="分层图"></a>分层图</h3><p>适用于图中建图中边的性质不同的题。</p>
<p>先将图复制成 k+1 份 （0 ~ k），然后连不同性质的边（$u_i$ $-&gt;$ $v_i<script type="math/tex">_+</script>_1$，其中 $i$ $∈$(0 ~ k)）。</p>
<p>k 代表进行操作的次数，每层之间的关系代表何时进行操作。</p>
<p>板题：<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4568">P4568 [JLOI2011] 飞行路线</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> endl <span class="meta-string">&quot;\n&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ff double</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PII pair<span class="meta-string">&lt;int, int&gt;</span> </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mem(a, b) memset(a, b, sizeof a)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rep(i, a, b) for(int i = (int)a; i &lt;= (int)b; i ++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> per(i, a, b) for(int i = (int)a; i &gt;= (int)b; i --)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IOS ios::sync_with_stdio(0); cin.tie(0); cout.tie(0)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">11e4</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">4e6</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, k;</span><br><span class="line"><span class="keyword">int</span> s, t;</span><br><span class="line"><span class="keyword">int</span> vis[N], dis[N];</span><br><span class="line"><span class="keyword">int</span> h[N], e[M], ne[M], w[M], idx;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b, <span class="keyword">int</span> c)</span> </span>&#123;</span><br><span class="line">    e[idx] = b; w[idx] = c; ne[idx] = h[a]; h[a] = idx ++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dijkstra</span><span class="params">(<span class="keyword">int</span> s)</span> </span>&#123;</span><br><span class="line">    priority_queue&lt;PII, vector&lt;PII&gt;, greater&lt;PII&gt;&gt; q;</span><br><span class="line">    <span class="built_in">rep</span>(i, <span class="number">1</span>, n * (k + <span class="number">1</span>)) dis[i] = <span class="number">1e18</span>, vis[i] = <span class="number">0</span>;</span><br><span class="line">    q.<span class="built_in">push</span>(&#123;<span class="number">0</span>, s&#125;); dis[s] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(q.<span class="built_in">size</span>()) &#123;</span><br><span class="line">        <span class="keyword">auto</span> it = q.<span class="built_in">top</span>(); q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">int</span> pos = it.se, d = it.fi;</span><br><span class="line">        <span class="keyword">if</span>(vis[pos]) <span class="keyword">continue</span>;</span><br><span class="line">        vis[pos] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = h[pos]; ~i; i = ne[i]) &#123;</span><br><span class="line">            <span class="keyword">int</span> j = e[i];</span><br><span class="line">            <span class="keyword">if</span>(dis[j] &gt; dis[pos] + w[i]) &#123;</span><br><span class="line">                dis[j] = dis[pos] + w[i];</span><br><span class="line">                <span class="keyword">if</span>(!vis[j]) q.<span class="built_in">push</span>(&#123;dis[j], j&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">mem</span>(h, <span class="number">-1</span>); idx = <span class="number">0</span>;    </span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m &gt;&gt; k;</span><br><span class="line">    cin &gt;&gt; s &gt;&gt; t; s ++; t ++;</span><br><span class="line">    <span class="keyword">while</span>(m --) &#123;</span><br><span class="line">        <span class="keyword">int</span> u, v, x;</span><br><span class="line">        cin &gt;&gt; u &gt;&gt; v &gt;&gt; x;</span><br><span class="line">        u ++; v ++;</span><br><span class="line">        <span class="built_in">add</span>(u, v, x); <span class="built_in">add</span>(v, u, x);</span><br><span class="line">        <span class="built_in">rep</span>(j, <span class="number">1</span>, k) &#123;  </span><br><span class="line">            <span class="built_in">add</span>(u + j * n, v + j * n, x);</span><br><span class="line">            <span class="built_in">add</span>(v + j * n, u + j * n, x);</span><br><span class="line">            <span class="built_in">add</span>(u + (j - <span class="number">1</span>) * n, v + j * n, <span class="number">0</span>);</span><br><span class="line">            <span class="built_in">add</span>(v + (j - <span class="number">1</span>) * n, u + j * n, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">dijkstra</span>(s);</span><br><span class="line">    <span class="keyword">int</span> ans = <span class="number">1e18</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = t; i &lt;= (k + <span class="number">1</span>) * n; i += n) ans = <span class="built_in">min</span>(ans, dis[i]);</span><br><span class="line">    cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="SPFA"><a href="#SPFA" class="headerlink" title="SPFA"></a>SPFA</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> n;   <span class="comment">// 总点数</span></span><br><span class="line"><span class="keyword">int</span> h[N], w[N], e[N], ne[N], idx;    <span class="comment">// 邻接表存储所有边</span></span><br><span class="line"><span class="keyword">int</span> dis[N];    <span class="comment">// 存储每个点到1号点的最短距离</span></span><br><span class="line"><span class="keyword">bool</span> st[N];   <span class="comment">// 存储每个点是否在队列中</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 求1号点到n号点的最短路距离，如果从1号点无法走到n号点则返回-1</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">spfa</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">memset</span>(dis, <span class="number">0x3f</span>, <span class="keyword">sizeof</span> dis); dis[<span class="number">1</span>] = <span class="number">0</span>; <span class="built_in">memset</span>(st, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(st);</span><br><span class="line">queue&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line">  q.<span class="built_in">push</span>(<span class="number">1</span>); st[<span class="number">1</span>] = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">while</span> (q.<span class="built_in">size</span>()) &#123;</span><br><span class="line">     <span class="keyword">auto</span> t = q.<span class="built_in">front</span>();</span><br><span class="line">     q.<span class="built_in">pop</span>();</span><br><span class="line">     st[t] = <span class="literal">false</span>;</span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">int</span> i = h[t]; i != <span class="number">-1</span>; i = ne[i])&#123;</span><br><span class="line">       <span class="keyword">int</span> j = e[i];</span><br><span class="line">       <span class="keyword">if</span> (dis[j] &gt; dis[t] + w[i])&#123;</span><br><span class="line">         dis[j] = dis[t] + w[i];</span><br><span class="line">         <span class="keyword">if</span> (!st[j])   <span class="comment">// 如果队列中已存在j，则不需要将j重复插入 &#123;</span></span><br><span class="line">           q.<span class="built_in">push</span>(j);</span><br><span class="line">           st[j] = <span class="literal">true</span>;</span><br><span class="line">         &#125;</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (dis[n] == <span class="number">0x3f3f3f3f</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  <span class="keyword">return</span> dis[n];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="判负环"><a href="#判负环" class="headerlink" title="判负环"></a>判负环</h3><p>时间复杂度是 $O(nm)$, $n$ 表示点数，$m$ 表示边数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> n;   <span class="comment">// 总点数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> h[N], w[N], e[N], ne[N], idx;    <span class="comment">// 邻接表存储所有边</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> dis[N], cnt[N];    <span class="comment">// dis[x]存储1号点到x的最短距离，cnt[x]存储1到x的最短路中经过的点数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> st[N];   <span class="comment">// 存储每个点是否在队列中</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果存在负环，则返回true，否则返回false。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">spfa</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="comment">// 不需要初始化dis数组</span></span><br><span class="line">  <span class="comment">// 原理：如果某条最短路径上有n个点（除了自己），那么加上自己之后一共有n+1个点，由抽屉原理一定有两个点相同，所以存在环。</span></span><br><span class="line">  queue&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i ++ ) &#123;</span><br><span class="line">     q.<span class="built_in">push</span>(i);</span><br><span class="line">     st[i] = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> (q.<span class="built_in">size</span>())&#123;</span><br><span class="line">     <span class="keyword">auto</span> t = q.<span class="built_in">front</span>();</span><br><span class="line">     q.<span class="built_in">pop</span>();</span><br><span class="line">     st[t] = <span class="literal">false</span>;</span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">int</span> i = h[t]; i != <span class="number">-1</span>; i = ne[i])&#123;</span><br><span class="line">       <span class="keyword">int</span> j = e[i];</span><br><span class="line">       <span class="keyword">if</span> (dis[j] &gt; dis[t] + w[i])&#123;</span><br><span class="line">         dis[j] = dis[t] + w[i];</span><br><span class="line">         cnt[j] = cnt[t] + <span class="number">1</span>;</span><br><span class="line">         <span class="keyword">if</span> (cnt[j] &gt;=  n) <span class="keyword">return</span> <span class="literal">true</span>;    <span class="comment">// 如果从1号点到x的最短路中包含至少n个点（不包括自己），则说明存在环</span></span><br><span class="line">         <span class="keyword">if</span> (!st[j])&#123;</span><br><span class="line">           q.<span class="built_in">push</span>(j);</span><br><span class="line">           st[j] = <span class="literal">true</span>;</span><br><span class="line">         &#125;</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="最小生成树"><a href="#最小生成树" class="headerlink" title="最小生成树"></a>最小生成树</h2><h3 id="Kruskal"><a href="#Kruskal" class="headerlink" title="Kruskal"></a>Kruskal</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> n, m;    <span class="comment">// n是点数，m是边数</span></span><br><span class="line"><span class="keyword">int</span> p[N];    <span class="comment">// 并查集的父节点数组</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span>   // 存储边&#123;</span></span><br><span class="line">  <span class="keyword">int</span> a, b, w;</span><br><span class="line">  <span class="keyword">bool</span> <span class="keyword">operator</span>&lt; (<span class="keyword">const</span> Edge &amp;W)<span class="keyword">const</span> &#123;</span><br><span class="line">     <span class="keyword">return</span> w &lt; W.w;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;edges[M];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;  <span class="comment">// 并查集核心操作</span></span><br><span class="line"> 	<span class="keyword">return</span> p[x] == x ? x : p[x] = <span class="built_in">find</span>(p[x]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">kruskal</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="built_in">sort</span>(edges, edges + m);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;=  n; i ++ ) p[i] = i;  <span class="comment">// 初始化并查集</span></span><br><span class="line">  <span class="keyword">int</span> res = <span class="number">0</span>, cnt = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i ++ )&#123;</span><br><span class="line">     <span class="keyword">int</span> a = edges[i].a, b = edges[i].b, w = edges[i].w;</span><br><span class="line">     a = <span class="built_in">find</span>(a), b = <span class="built_in">find</span>(b);</span><br><span class="line">     <span class="keyword">if</span> (a != b) &#123;   <span class="comment">// 如果两个连通块不连通，则将这两个连通块合并</span></span><br><span class="line">       p[a] = b;</span><br><span class="line">       res +=  w;</span><br><span class="line">       cnt ++ ;</span><br><span class="line">     &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (cnt &lt; n - <span class="number">1</span>) <span class="keyword">return</span> INF;</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Prim"><a href="#Prim" class="headerlink" title="Prim"></a>Prim</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">505</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">int</span> n, m, g[N][N], dis[N], vis[N];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">prim</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="built_in">mem</span>(dis,INF);</span><br><span class="line">  <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i ++)&#123;</span><br><span class="line">     <span class="keyword">int</span> t = <span class="number">-1</span>;</span><br><span class="line">     <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>;j &lt;= n;j ++)</span><br><span class="line">       <span class="keyword">if</span>(!vis[j] &amp;&amp; (t == <span class="number">-1</span> || dis[t] &gt; dis[j])) </span><br><span class="line">         t = j;</span><br><span class="line">     <span class="keyword">if</span>(i &amp;&amp; dis[t] == INF) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">     <span class="keyword">if</span>(i) ans += dis[t];</span><br><span class="line">     vis[t] = <span class="number">1</span>;</span><br><span class="line">     <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n;j ++) dis[j] = <span class="built_in">min</span>(dis[j], g[t][j]); </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ans;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="二分图"><a href="#二分图" class="headerlink" title="二分图"></a>二分图</h2><h3 id="染色"><a href="#染色" class="headerlink" title="染色"></a>染色</h3><p>时间复杂度是 $O(n+m)$, $n$ 表示点数，$m$ 表示边数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> n;   <span class="comment">// n表示点数</span></span><br><span class="line"><span class="keyword">int</span> h[N], e[M], ne[M], idx;   <span class="comment">// 邻接表存储图</span></span><br><span class="line"><span class="keyword">int</span> color[N];    <span class="comment">// 表示每个点的颜色，-1表示未染色，0表示白色，1表示黑色</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 参数：u表示当前节点，c表示当前点的颜色</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> c)</span></span>&#123;</span><br><span class="line">  color[u] = c;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = h[u]; i != <span class="number">-1</span>; i = ne[i])&#123;</span><br><span class="line">     <span class="keyword">int</span> j = e[i];</span><br><span class="line">     <span class="keyword">if</span> (color[j] == <span class="number">-1</span>)&#123;</span><br><span class="line">       <span class="keyword">if</span> (!<span class="built_in">dfs</span>(j, !c)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">else</span> <span class="keyword">if</span> (color[j] == c) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="built_in">memset</span>(color, <span class="number">-1</span>, <span class="keyword">sizeof</span> color);</span><br><span class="line">  <span class="keyword">bool</span> flag = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i ++ )</span><br><span class="line">     <span class="keyword">if</span> (color[i] == <span class="number">-1</span>)</span><br><span class="line">       <span class="keyword">if</span> (!<span class="built_in">dfs</span>(i, <span class="number">0</span>))&#123;</span><br><span class="line">         flag = <span class="literal">false</span>;</span><br><span class="line">         <span class="keyword">break</span>;</span><br><span class="line">       &#125;</span><br><span class="line">  <span class="keyword">return</span> flag;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="匈牙利算法"><a href="#匈牙利算法" class="headerlink" title="匈牙利算法"></a>匈牙利算法</h3><p>时间复杂度是 $O(nm)$, $n$ 表示点数，$m$ 表示边数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> n1, n2;   <span class="comment">// n1表示第一个集合中的点数，n2表示第二个集合中的点数</span></span><br><span class="line"><span class="keyword">int</span> h[N], e[M], ne[M], idx;</span><br><span class="line"><span class="keyword">int</span> match[N];    <span class="comment">// 存储第二个集合中的每个点当前匹配的第一个集合中的点是哪个</span></span><br><span class="line"><span class="keyword">bool</span> st[N];   <span class="comment">// 表示第二个集合中的每个点是否已经被遍历过</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = h[x]; i != <span class="number">-1</span>; i = ne[i])&#123;</span><br><span class="line">     <span class="keyword">int</span> j = e[i];</span><br><span class="line">     <span class="keyword">if</span> (!st[j])&#123;</span><br><span class="line">       st[j] = <span class="literal">true</span>;</span><br><span class="line">       <span class="keyword">if</span> (match[j] == <span class="number">0</span> || <span class="built_in">find</span>(match[j]))&#123;</span><br><span class="line">         match[j] = x;</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 求最大匹配数，依次枚举第一个集合中的每个点能否匹配第二个集合中的点</span></span><br><span class="line"><span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n1; i ++ )&#123;</span><br><span class="line">  <span class="built_in">memset</span>(st, <span class="literal">false</span>, <span class="keyword">sizeof</span> st);</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">find</span>(i)) res ++ ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="LCA"><a href="#LCA" class="headerlink" title="LCA"></a>LCA</h2><h3 id="Tarjan-离线"><a href="#Tarjan-离线" class="headerlink" title="Tarjan 离线"></a>Tarjan 离线</h3><p>$O(n + q)$</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PII pair<span class="meta-string">&lt;int, int&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mem(a, b) memset(a, b, sizeof(a))</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e4</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = N &lt;&lt; <span class="number">1</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m;</span><br><span class="line"><span class="keyword">int</span> h[N], ne[M], e[M], w[M], idx;</span><br><span class="line"><span class="keyword">int</span> dis[N], p[N], res[M], vis[N];</span><br><span class="line">vector&lt;PII&gt; query[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (p[x] != x) p[x] = <span class="built_in">find</span>(p[x]);</span><br><span class="line">    <span class="keyword">return</span> p[x];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b, <span class="keyword">int</span> c)</span></span>&#123; e[idx] = b; w[idx] = c; ne[idx] = h[a]; h[a] = idx ++; &#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = h[u]; ~i; i = ne[i])&#123;</span><br><span class="line">        <span class="keyword">int</span> j = e[i];</span><br><span class="line">        <span class="keyword">if</span>(j == v) <span class="keyword">continue</span>;</span><br><span class="line">        dis[j] = dis[u] + w[i];</span><br><span class="line">        <span class="built_in">dfs</span>(j, u);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">tarjan</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;</span><br><span class="line">    vis[u] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = h[u]; ~i; i = ne[i])&#123;</span><br><span class="line">        <span class="keyword">int</span> j = e[i];</span><br><span class="line">        <span class="keyword">if</span>(!vis[j])&#123;</span><br><span class="line">            <span class="built_in">tarjan</span>(j);</span><br><span class="line">            p[j] = u;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> i : query[u])&#123;</span><br><span class="line">        <span class="keyword">int</span> t = i.fi, idx = i.se;</span><br><span class="line">        <span class="keyword">if</span>(vis[t] == <span class="number">2</span>)&#123;</span><br><span class="line">            <span class="keyword">int</span> anc = <span class="built_in">find</span>(t);</span><br><span class="line">            res[idx] = dis[u] + dis[t] - (dis[anc] * <span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    vis[u] = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="built_in">mem</span>(h, <span class="number">-1</span>); idx = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n - <span class="number">1</span>; i ++)&#123;</span><br><span class="line">        <span class="keyword">int</span> u, v, x;</span><br><span class="line">        cin &gt;&gt; u &gt;&gt; v &gt;&gt; x;</span><br><span class="line">        <span class="built_in">add</span>(u, v, x); <span class="built_in">add</span>(v, u, x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i ++)&#123;</span><br><span class="line">        <span class="keyword">int</span> u, v;</span><br><span class="line">        cin &gt;&gt; u &gt;&gt; v;</span><br><span class="line">        <span class="keyword">if</span>(u != v)&#123;</span><br><span class="line">            query[u].<span class="built_in">push_back</span>(&#123;v, i&#125;); query[v].<span class="built_in">push_back</span>(&#123;u, i&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i ++) p[i] = i;</span><br><span class="line">    <span class="built_in">dfs</span>(<span class="number">1</span>, <span class="number">-1</span>);</span><br><span class="line">    <span class="built_in">tarjan</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; m;i ++) cout &lt;&lt; res[i] &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="倍增"><a href="#倍增" class="headerlink" title="倍增"></a>倍增</h3><p>$O(nlogn)$</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;bits/stdc++.h&gt;</span><br><span class="line">using namespace std;</span><br><span class="line">#define endl &quot;\n&quot;</span><br><span class="line">#define ff double</span><br><span class="line">#define pb push_back</span><br><span class="line">#define int long long</span><br><span class="line">#define mem(a, b) memset(a, b, sizeof a)</span><br><span class="line">#define rep(i, a, b) for(int i = (int)a; i &lt;= (int)b; i ++)</span><br><span class="line">#define per(i, a, b) for(int i = (int)a; i &gt;= (int)b; i --)</span><br><span class="line">#define IOS ios::sync_with_stdio(0); cin.tie(0); cout.tie(0)</span><br><span class="line"></span><br><span class="line">const int N = 1e4 + 5;</span><br><span class="line">const int M = N &lt;&lt; 2;</span><br><span class="line">int n, m;</span><br><span class="line">int fa[N][20], dep[N], dis[N];</span><br><span class="line">int h[N], e[M], ne[M], w[M], idx;</span><br><span class="line">void add(int a, int b, int c) &#123;</span><br><span class="line">    e[idx] = b; w[idx] = c; ne[idx] = h[a]; h[a] = idx ++;</span><br><span class="line">&#125;</span><br><span class="line">int t;</span><br><span class="line">void bfs()&#123;</span><br><span class="line">    queue&lt;int&gt; q;</span><br><span class="line">    q.push(1); dep[1] = 1;</span><br><span class="line">    while(q.size())&#123;</span><br><span class="line">        int x = q.front(); q.pop();</span><br><span class="line">        for(int i = h[x]; ~i; i = ne[i])&#123;</span><br><span class="line">            int y = e[i];</span><br><span class="line">            if(dep[y]) continue;</span><br><span class="line">            dep[y] = dep[x] + 1;</span><br><span class="line">            dis[y] = dis[x] + w[i];</span><br><span class="line">            fa[y][0] = x;</span><br><span class="line">            rep(j, 1, t) fa[y][j] = fa[fa[y][j - 1]][j - 1];</span><br><span class="line">            q.push(y);  </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">int lca(int x, int y)&#123;</span><br><span class="line">    if(dep[x] &gt; dep[y]) swap(x, y);</span><br><span class="line">    per(i, t, 0)</span><br><span class="line">        if(dep[fa[y][i]] &gt;= dep[x]) y = fa[y][i];</span><br><span class="line">    if(x == y) return x;</span><br><span class="line">    per(i, t, 0)</span><br><span class="line">        if(fa[x][i] != fa[y][i]) x = fa[x][i], y = fa[y][i]; </span><br><span class="line">    return fa[x][0];</span><br><span class="line">&#125;</span><br><span class="line">signed main()&#123;</span><br><span class="line">    mem(h, -1); idx = 0;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    t = (int)(log(n) / log(2)) + 1;</span><br><span class="line">    rep(i, 1, n - 1) &#123;</span><br><span class="line">        int u, v, x; cin &gt;&gt; u &gt;&gt; v &gt;&gt; x;</span><br><span class="line">        add(u, v, x); add(v, u, x);</span><br><span class="line">    &#125;</span><br><span class="line">    bfs();</span><br><span class="line">    for(int i = 1; i &lt;= m; i ++) &#123;</span><br><span class="line">        int u, v; cin &gt;&gt; u &gt;&gt; v;</span><br><span class="line">        cout &lt;&lt; dis[u] + dis[v] - 2 * dis[lca(u, v)] &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="树剖"><a href="#树剖" class="headerlink" title="树剖"></a>树剖</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> endl <span class="meta-string">&quot;\n&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ff double</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lc i &lt;&lt; 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rc i &lt;&lt; 1 | 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mem(a, b) memset(a, b, sizeof a)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rep(i, a, b) for(int i = (int)a; i &lt;= (int)b; i ++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> per(i, a, b) for(int i = (int)a; i &gt;= (int)b; i --)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IOS ios::sync_with_stdio(0); cin.tie(0); cout.tie(0)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = N &lt;&lt; <span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> n, m;</span><br><span class="line"><span class="keyword">int</span> h[N], e[M], ne[M], w[M], idx;</span><br><span class="line"><span class="keyword">int</span> dfn[N], dep[N], ord[N], top[N];</span><br><span class="line"><span class="keyword">int</span> son[N], fa[N], siz[N], cnt, dis[N];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> l, r, w, f;</span><br><span class="line">&#125;tr[N &lt;&lt; <span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b, <span class="keyword">int</span> c)</span> </span>&#123;</span><br><span class="line">    e[idx] = b; w[idx] = c; ne[idx] = h[a]; h[a] = idx ++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs1</span><span class="params">(<span class="keyword">int</span> pos, <span class="keyword">int</span> father, <span class="keyword">int</span> depth, <span class="keyword">int</span> distance)</span> </span>&#123;</span><br><span class="line">    dep[pos] = depth; fa[pos] = father; son[pos] = <span class="number">-1</span>; siz[pos] = <span class="number">1</span>; dis[pos] = distance;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = h[pos]; ~i; i = ne[i]) &#123;</span><br><span class="line">        <span class="keyword">int</span> j = e[i];</span><br><span class="line">        <span class="keyword">if</span>(j == father) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfs1</span>(j, pos, depth + <span class="number">1</span>, distance + w[i]);</span><br><span class="line">        siz[pos] += siz[j];</span><br><span class="line">        <span class="keyword">if</span>(son[pos] == <span class="number">-1</span> || siz[son[pos]] &lt; siz[j]) son[pos] = j;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> pos, <span class="keyword">int</span> tp)</span> </span>&#123;</span><br><span class="line">    dfn[pos] = ++ cnt; ord[cnt] = pos; top[pos] = tp;</span><br><span class="line">    <span class="keyword">if</span>(son[pos] == <span class="number">-1</span>) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="built_in">dfs2</span>(son[pos], tp);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = h[pos]; ~i; i = ne[i]) &#123;</span><br><span class="line">        <span class="keyword">int</span> j = e[i];</span><br><span class="line">        <span class="keyword">if</span>(j == fa[pos] || j == son[pos]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfs2</span>(j, j);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lca</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(; top[u] != top[v]; dep[top[u]] &gt; dep[top[v]] ? u = fa[top[u]] : v = fa[top[v]]);</span><br><span class="line">    <span class="keyword">return</span> dep[u] &lt; dep[v] ? u : v;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    IOS;</span><br><span class="line">    <span class="built_in">mem</span>(h, <span class="number">-1</span>); idx = <span class="number">0</span>;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="built_in">rep</span>(i, <span class="number">2</span>, n) &#123;</span><br><span class="line">        <span class="keyword">int</span> u, v, x; cin &gt;&gt; u &gt;&gt; v &gt;&gt; x;</span><br><span class="line">        <span class="built_in">add</span>(u, v, x); <span class="built_in">add</span>(v, u, x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">dfs1</span>(<span class="number">1</span>, <span class="number">-1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">dfs2</span>(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">while</span>(m --) &#123;</span><br><span class="line">        <span class="keyword">int</span> u, v; cin &gt;&gt; u &gt;&gt; v;</span><br><span class="line">        cout &lt;&lt; dis[u] + dis[v] - <span class="number">2</span> * dis[<span class="built_in">lca</span>(u, v)] &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Tarjan-求强连通分量"><a href="#Tarjan-求强连通分量" class="headerlink" title="Tarjan 求强连通分量"></a>Tarjan 求强连通分量</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e4</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">5e4</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">int</span> n, m;</span><br><span class="line"><span class="keyword">int</span> dfn[N], low[N], scc, siz[N], stk[N], timest, id[N];</span><br><span class="line"><span class="keyword">int</span> h[N], ne[M], e[M], idx;</span><br><span class="line"><span class="keyword">int</span> dout[N];</span><br><span class="line">stack&lt;<span class="keyword">int</span>&gt; sta;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>&#123;e[idx] = b; ne[idx] = h[a]; h[a] = idx ++;&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">tarjan</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;</span><br><span class="line">    dfn[u] = low[u] = ++ timest;            <span class="comment">//标记点时间戳  从 1 开始</span></span><br><span class="line">    sta.<span class="built_in">push</span>(u); stk[u] = <span class="number">1</span>;                <span class="comment">//入栈并标记下</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = h[u]; ~i; i = ne[i])&#123;       <span class="comment">//遍历所有邻点</span></span><br><span class="line">        <span class="keyword">int</span> j = e[i];</span><br><span class="line">        <span class="keyword">if</span>(!dfn[j])&#123;                        <span class="comment">//j 未被遍历过            </span></span><br><span class="line">            <span class="built_in">tarjan</span>(j);                      <span class="comment">//跑一遍tarjan</span></span><br><span class="line">            low[u] = <span class="built_in">min</span>(low[u], low[j]);   <span class="comment">//low[j]维护最小值</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(stk[j]) low[u] = <span class="built_in">min</span>(low[u], dfn[j]);   <span class="comment">//否则dfn[j]维护最小值</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(dfn[u] == low[u])&#123;                   <span class="comment">//找到最高点</span></span><br><span class="line">        scc ++;                             </span><br><span class="line">        <span class="keyword">int</span> t;</span><br><span class="line">        <span class="keyword">do</span>&#123;</span><br><span class="line">            t = sta.<span class="built_in">top</span>(); sta.<span class="built_in">pop</span>();       <span class="comment">//取出所有sta</span></span><br><span class="line">            stk[t] = <span class="number">0</span>;</span><br><span class="line">            id[t] = scc;                    <span class="comment">//标记属于哪个</span></span><br><span class="line">            siz[scc] ++;                    <span class="comment">//scc.size() ++;</span></span><br><span class="line">        &#125;<span class="keyword">while</span>(t != u);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">for(int i = 1;i &lt;= n;i ++)</span></span><br><span class="line"><span class="comment">        if(!dfn[i])</span></span><br><span class="line"><span class="comment">            tarjan(i);</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h2 id="网络流"><a href="#网络流" class="headerlink" title="网络流"></a>网络流</h2><h3 id="EK求最大流"><a href="#EK求最大流" class="headerlink" title="EK求最大流"></a>EK求最大流</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="comment">// #define int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mem(a, b) memset(a, b, sizeof a)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e3</span> + <span class="number">5</span>, M = <span class="number">2e4</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">int</span> n, m, s, t;      <span class="comment">//容量</span></span><br><span class="line"><span class="keyword">int</span> h[N], ne[M], e[M], f[M], idx;</span><br><span class="line"><span class="keyword">int</span> d[N];   <span class="comment">//当前所有边的最小容量</span></span><br><span class="line"><span class="keyword">int</span> pre[N];     <span class="comment">//前驱点</span></span><br><span class="line"><span class="keyword">bool</span> vis[N];</span><br><span class="line">queue&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b, <span class="keyword">int</span> c)</span></span>&#123;</span><br><span class="line">    e[idx] = b; f[idx] = c; ne[idx] = h[a]; h[a] = idx ++;</span><br><span class="line">    e[idx] = a; f[idx] = <span class="number">0</span>; ne[idx] = h[b]; h[b] = idx ++;      <span class="comment">//反向边</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">bfs</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">mem</span>(vis, <span class="number">0</span>); q.<span class="built_in">clear</span>();</span><br><span class="line">    q.<span class="built_in">push</span>(s); vis[s] = <span class="number">1</span>; d[s] = INF;</span><br><span class="line">    <span class="keyword">while</span>(q.<span class="built_in">size</span>())&#123;</span><br><span class="line">        <span class="keyword">int</span> tmp = q.<span class="built_in">front</span>(); q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = h[tmp]; ~i; i = ne[i])&#123;</span><br><span class="line">            <span class="keyword">int</span> j = e[i];</span><br><span class="line">            <span class="keyword">if</span>(!vis[j] &amp;&amp; f[i])&#123; <span class="comment">//如果没遍历过且这条边有容量</span></span><br><span class="line">                vis[j] = <span class="number">1</span>;</span><br><span class="line">                d[j] = <span class="built_in">min</span>(d[tmp], f[i]);</span><br><span class="line">                pre[j] = i;     <span class="comment">//记录前驱边    </span></span><br><span class="line">                <span class="keyword">if</span>(j == t) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">                q.<span class="built_in">push</span>(j);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ek</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">bfs</span>())&#123;</span><br><span class="line">        ans += d[t];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = t; i != s; i = e[pre[i] ^ <span class="number">1</span>])&#123;</span><br><span class="line">            f[pre[i]] -= d[t];</span><br><span class="line">            f[pre[i] ^ <span class="number">1</span>] += d[t];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">mem</span>(h, <span class="number">-1</span>); idx = <span class="number">0</span>;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m &gt;&gt; s &gt;&gt; t;</span><br><span class="line">    <span class="keyword">while</span>(m --)&#123;</span><br><span class="line">        <span class="keyword">int</span> u, v, x;</span><br><span class="line">        cin &gt;&gt; u &gt;&gt; v &gt;&gt; x;</span><br><span class="line">        <span class="built_in">add</span>(u, v, x);</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; <span class="built_in">ek</span>() &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="dinic求最大流"><a href="#dinic求最大流" class="headerlink" title="dinic求最大流"></a>dinic求最大流</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mem(a, b) memset(a, b, sizeof a)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e4</span> + <span class="number">5</span>, M = <span class="number">2e5</span> + <span class="number">5</span>, INF = <span class="number">1e8</span>;</span><br><span class="line"><span class="keyword">int</span> n, m, s, t;</span><br><span class="line"><span class="keyword">int</span> h[N], e[M], ne[M], f[M], idx;</span><br><span class="line"><span class="keyword">int</span> d[N], cur[N];</span><br><span class="line">    <span class="comment">//层数  优化</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b, <span class="keyword">int</span> c)</span></span>&#123;</span><br><span class="line">    e[idx] = b; f[idx] = c; ne[idx] = h[a]; h[a] = idx ++;</span><br><span class="line">    e[idx] = a; f[idx] = <span class="number">0</span>; ne[idx] = h[b]; h[b] = idx ++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">bfs</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    queue&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line">    <span class="built_in">mem</span>(d, <span class="number">-1</span>); </span><br><span class="line">    q.<span class="built_in">push</span>(s); d[s] = <span class="number">0</span>;</span><br><span class="line">    cur[s] = h[s];</span><br><span class="line">    <span class="keyword">while</span>(q.<span class="built_in">size</span>()) &#123;</span><br><span class="line">        <span class="keyword">int</span> pos = q.<span class="built_in">front</span>(); q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = h[pos]; ~i; i = ne[i]) &#123;</span><br><span class="line">            <span class="keyword">int</span> j = e[i];</span><br><span class="line">            <span class="keyword">if</span>(d[j] == <span class="number">-1</span> &amp;&amp; f[i]) &#123;</span><br><span class="line">                d[j] = d[pos] + <span class="number">1</span>;</span><br><span class="line">                cur[j] = h[j];     <span class="comment">//这个点的当前弧现在是第一条边</span></span><br><span class="line">                <span class="keyword">if</span>(j == t) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">                q.<span class="built_in">push</span>(j);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> pos, <span class="keyword">int</span> limit)</span></span>&#123;  <span class="comment">//当前点最大流量</span></span><br><span class="line">    <span class="keyword">if</span>(pos == t) <span class="keyword">return</span> limit;</span><br><span class="line">    <span class="keyword">int</span> flow = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = cur[pos]; ~i &amp;&amp; flow &lt; limit; i = ne[i])&#123;</span><br><span class="line">        cur[pos] = i;</span><br><span class="line">        <span class="keyword">int</span> j = e[i];</span><br><span class="line">        <span class="keyword">if</span>(d[j] == d[pos] + <span class="number">1</span> &amp;&amp; f[i])&#123;</span><br><span class="line">            <span class="keyword">int</span> tmp = <span class="built_in">find</span>(j, <span class="built_in">min</span>(f[i], limit - flow)); <span class="comment">//从u的当前点出发能找到的最大流量</span></span><br><span class="line">            <span class="keyword">if</span>(!tmp) d[j] = <span class="number">-1</span>; <span class="comment">//删掉点</span></span><br><span class="line">            f[i] -= tmp; f[i ^ <span class="number">1</span>] += tmp; flow += tmp;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> flow;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dinic</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> r = <span class="number">0</span>, flow;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">bfs</span>())    <span class="comment">//建立分层图 找增广路</span></span><br><span class="line">        <span class="keyword">while</span>(flow = <span class="built_in">find</span>(s, INF)) <span class="comment">//寻找所有增广路</span></span><br><span class="line">            r += flow;</span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">mem</span>(h, <span class="number">-1</span>); idx = <span class="number">0</span>;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m &gt;&gt; s &gt;&gt; t;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>, u, v, x; i &lt;= m; i ++)&#123;</span><br><span class="line">        cin &gt;&gt; u &gt;&gt; v &gt;&gt; x;</span><br><span class="line">        <span class="built_in">add</span>(u, v, x);</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; <span class="built_in">dinic</span>() &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="虚树"><a href="#虚树" class="headerlink" title="虚树"></a>虚树</h2><p>Virtual Tree，去掉大部分点做出简化图，配合树剖求lca和单调栈建关键点与其LCA的新树。再在新树上进行树上问题。</p>
<h3 id="P2495-SDOI2011-消耗战"><a href="#P2495-SDOI2011-消耗战" class="headerlink" title="P2495 [SDOI2011] 消耗战"></a>P2495 [SDOI2011] 消耗战</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> endl <span class="meta-string">&quot;\n&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ff double</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mem(a, b) memset(a, b, sizeof a)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rep(i, a, b) for(int i = (int)a; i &lt;= (int)b; i ++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> per(i, a, b) for(int i = (int)a; i &gt;= (int)b; i --)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IOS ios::sync_with_stdio(0); cin.tie(0); cout.tie(0)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">25e4</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = N &lt;&lt; <span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> n, q;</span><br><span class="line"><span class="keyword">int</span> h[N], e[M], w[M], ne[M], idx;</span><br><span class="line"><span class="keyword">int</span> dep[N], top[N], siz[N], dfn[N];</span><br><span class="line"><span class="keyword">int</span> son[N], fa[N], ord[N], cnt;</span><br><span class="line"><span class="keyword">int</span> a[M], sta[M], tt;</span><br><span class="line">vector&lt;<span class="keyword">int</span>&gt; virt[N];   </span><br><span class="line"><span class="keyword">int</span> f[N];</span><br><span class="line"><span class="keyword">int</span> kpt[N], dis[N];     <span class="comment">//Key PoinT 和 距离</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x = <span class="number">0</span>, f = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> c = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(!<span class="built_in">isdigit</span>(c)) &#123; <span class="keyword">if</span>(c == <span class="string">&#x27;-&#x27;</span>) f = <span class="number">-1</span>; c = <span class="built_in">getchar</span>();&#125;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">isdigit</span>(c)) &#123; x = x * <span class="number">10</span> + c - <span class="string">&#x27;0&#x27;</span>; c = <span class="built_in">getchar</span>();&#125;</span><br><span class="line">    <span class="keyword">return</span> x * f;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b, <span class="keyword">int</span> c)</span> </span>&#123;</span><br><span class="line">    e[idx] = b; w[idx] = c; ne[idx] = h[a]; h[a] = idx ++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">    virt[a].<span class="built_in">pb</span>(b); virt[b].<span class="built_in">pb</span>(a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs1</span><span class="params">(<span class="keyword">int</span> pos, <span class="keyword">int</span> father, <span class="keyword">int</span> depth)</span> </span>&#123;</span><br><span class="line">    dep[pos] = depth; fa[pos] = father; son[pos] = <span class="number">-1</span>; siz[pos] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = h[pos]; ~i; i = ne[i]) &#123;</span><br><span class="line">        <span class="keyword">int</span> j = e[i];</span><br><span class="line">        <span class="keyword">if</span>(j == father) <span class="keyword">continue</span>;</span><br><span class="line">        dis[j] = <span class="built_in">min</span>(dis[pos], w[i]);		<span class="comment">//处理距离</span></span><br><span class="line">        <span class="built_in">dfs1</span>(j, pos, depth + <span class="number">1</span>);</span><br><span class="line">        siz[pos] += siz[j];</span><br><span class="line">        <span class="keyword">if</span>(son[pos] == <span class="number">-1</span> || siz[son[pos]] &lt; siz[j]) son[pos] = j;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> pos, <span class="keyword">int</span> tp)</span> </span>&#123;</span><br><span class="line">    dfn[pos] = ++ cnt; ord[cnt] = pos; top[pos] = tp;</span><br><span class="line">    <span class="keyword">if</span>(son[pos] == <span class="number">-1</span>) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="built_in">dfs2</span>(son[pos], tp);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = h[pos]; ~i; i = ne[i]) &#123;</span><br><span class="line">        <span class="keyword">int</span> j = e[i];</span><br><span class="line">        <span class="keyword">if</span>(j == fa[pos] || j == son[pos]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfs2</span>(j, j);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lca</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(; top[u] != top[v]; dep[top[u]] &gt; dep[top[v]] ? u = fa[top[u]] : v = fa[top[v]]);</span><br><span class="line">    <span class="keyword">return</span> dep[u] &lt; dep[v] ? u : v;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">sort</span>(a + <span class="number">1</span>, a + k + <span class="number">1</span>, [&amp;](<span class="keyword">int</span> a, <span class="keyword">int</span> b) &#123;</span><br><span class="line">        <span class="keyword">return</span> dfn[a] &lt; dfn[b];</span><br><span class="line">    &#125;); </span><br><span class="line">	<span class="built_in">unique</span>(a + <span class="number">1</span>, a + k + <span class="number">1</span>);</span><br><span class="line">    sta[tt = <span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">rep</span>(i, <span class="number">1</span>, k) &#123;</span><br><span class="line">        <span class="keyword">if</span>(a[i] != <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> g = <span class="built_in">lca</span>(a[i], sta[tt]);</span><br><span class="line">            <span class="keyword">if</span>(sta[tt] != g) &#123;</span><br><span class="line">                <span class="keyword">while</span>(tt &gt;= <span class="number">2</span> &amp;&amp; dfn[g] &lt; dfn[sta[tt - <span class="number">1</span>]]) &#123; </span><br><span class="line">                    <span class="built_in">add</span>(sta[tt], sta[tt - <span class="number">1</span>]); tt --;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(dfn[g] &gt; dfn[sta[tt - <span class="number">1</span>]]) &#123;</span><br><span class="line">                    <span class="built_in">add</span>(g, sta[tt]); sta[tt] = g;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="built_in">add</span>(g, sta[tt]); tt --; </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            sta[++ tt] = a[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">rep</span>(i, <span class="number">1</span>, tt - <span class="number">1</span>) <span class="built_in">add</span>(sta[i], sta[i + <span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dp</span><span class="params">(<span class="keyword">int</span> pos, <span class="keyword">int</span> fa)</span> </span>&#123;</span><br><span class="line">    f[pos] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> it : virt[pos]) &#123;</span><br><span class="line">        <span class="keyword">int</span> w = dis[it];</span><br><span class="line">        <span class="keyword">if</span>(it == fa) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dp</span>(it, pos);</span><br><span class="line">        <span class="keyword">if</span>(kpt[it]) f[pos] += w;</span><br><span class="line">        <span class="keyword">else</span> f[pos] += <span class="built_in">min</span>(f[it], w);</span><br><span class="line">    &#125;</span><br><span class="line">    virt[pos].<span class="built_in">clear</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    n = <span class="built_in">read</span>();</span><br><span class="line">    <span class="built_in">rep</span>(i, <span class="number">1</span>, n) h[i] = <span class="number">-1</span>; idx = cnt = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">rep</span>(i, <span class="number">2</span>, n) &#123;</span><br><span class="line">        <span class="keyword">int</span> u = <span class="built_in">read</span>(), v = <span class="built_in">read</span>(), x = <span class="built_in">read</span>();</span><br><span class="line">        <span class="built_in">add</span>(u, v, x); <span class="built_in">add</span>(v, u, x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">rep</span>(i, <span class="number">1</span>, n) dis[i] = <span class="number">1e18</span>;</span><br><span class="line">    <span class="built_in">dfs1</span>(<span class="number">1</span>, <span class="number">-1</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">dfs2</span>(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    q = <span class="built_in">read</span>();</span><br><span class="line">    <span class="keyword">while</span>(q -- ) &#123;</span><br><span class="line">        <span class="keyword">int</span> k = <span class="built_in">read</span>();</span><br><span class="line">        <span class="built_in">rep</span>(i, <span class="number">1</span>, k) &#123;</span><br><span class="line">            a[i] = <span class="built_in">read</span>();</span><br><span class="line">            kpt[a[i]] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">build</span>(k);</span><br><span class="line">        <span class="built_in">dp</span>(<span class="number">1</span>, <span class="number">-1</span>);</span><br><span class="line">        cout &lt;&lt; f[<span class="number">1</span>] &lt;&lt; endl;</span><br><span class="line">        <span class="built_in">rep</span>(i, <span class="number">1</span>, k) kpt[a[i]] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2022杭电多校2-A-Static-query-on-tree"><a href="#2022杭电多校2-A-Static-query-on-tree" class="headerlink" title="2022杭电多校2 A - Static query on tree"></a>2022杭电多校2 A - Static query on tree</h3><p>建起来虚树后染色，C染子树，AB染1~AB的路径，找有多少点三色都有</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> endl <span class="meta-string">&quot;\n&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ff double</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></span><br><span class="line"><span class="comment">// #define int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> all(x) x.begin(), x.end()</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mem(a, b) memset(a, b, sizeof a)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rep(i, a, b) for(int i = (int)a; i &lt;= (int)b; i ++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> per(i, a, b) for(int i = (int)a; i &gt;= (int)b; i --)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IOS ios::sync_with_stdio(0); cin.tie(0); cout.tie(0)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">2e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">int</span> n, q;</span><br><span class="line"><span class="keyword">int</span> h[N], e[N], ne[N], idx;</span><br><span class="line"><span class="keyword">int</span> dep[N], top[N], dfn[N], ord[N];</span><br><span class="line"><span class="keyword">int</span> son[N], fa[N], cnt, siz[N];</span><br><span class="line"><span class="keyword">int</span> a[N], b[N], c[N];</span><br><span class="line"><span class="keyword">int</span> sta[N], tt, ans;</span><br><span class="line">vector&lt;<span class="keyword">int</span>&gt; virt[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b, <span class="keyword">int</span> c)</span> </span>&#123;</span><br><span class="line">    e[idx] = b; ne[idx] = h[a]; h[a] = idx ++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">    virt[a].<span class="built_in">pb</span>(b); virt[b].<span class="built_in">pb</span>(a);   </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x = <span class="number">0</span>, f = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> c = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(!<span class="built_in">isdigit</span>(c)) &#123; <span class="keyword">if</span>(c == <span class="string">&#x27;-&#x27;</span>) f = <span class="number">-1</span>; c = <span class="built_in">getchar</span>();&#125;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">isdigit</span>(c)) &#123; x = x * <span class="number">10</span> + c - <span class="string">&#x27;0&#x27;</span>; c = <span class="built_in">getchar</span>();&#125;</span><br><span class="line">    <span class="keyword">return</span> x * f;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs1</span><span class="params">(<span class="keyword">int</span> pos, <span class="keyword">int</span> father, <span class="keyword">int</span> depth)</span> </span>&#123;</span><br><span class="line">    son[pos] = <span class="number">-1</span>; fa[pos] = father; dep[pos] = depth; siz[pos] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = h[pos]; ~i; i = ne[i]) &#123;</span><br><span class="line">        <span class="keyword">int</span> j = e[i];</span><br><span class="line">        <span class="keyword">if</span>(j == fa[pos]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfs1</span>(j, pos, depth + <span class="number">1</span>);</span><br><span class="line">        siz[pos] += siz[j];</span><br><span class="line">        <span class="keyword">if</span>(son[pos] == <span class="number">-1</span> || siz[son[pos]] &lt; siz[j]) son[pos] = j;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> pos, <span class="keyword">int</span> tp)</span> </span>&#123;</span><br><span class="line">    dfn[pos] = ++ cnt; ord[cnt] = pos; top[pos] = tp;</span><br><span class="line">    <span class="keyword">if</span>(son[pos] == <span class="number">-1</span>) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="built_in">dfs2</span>(son[pos], tp);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = h[pos]; ~i; i = ne[i]) &#123;</span><br><span class="line">        <span class="keyword">int</span> j = e[i];</span><br><span class="line">        <span class="keyword">if</span>(j == son[pos] || j == fa[pos]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfs2</span>(j, j);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lca</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(; top[u] != top[v]; dep[top[u]] &gt; dep[top[v]] ? u = fa[top[u]] : v = fa[top[v]]); </span><br><span class="line">    <span class="keyword">return</span> dep[u] &lt; dep[v] ? u : v;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt; v)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">sort</span>(<span class="built_in">all</span>(v), [&amp;](<span class="keyword">int</span> a, <span class="keyword">int</span> b) &#123;</span><br><span class="line">        <span class="keyword">return</span> dfn[a] &lt; dfn[b];</span><br><span class="line">    &#125;);</span><br><span class="line">    v.<span class="built_in">erase</span>(<span class="built_in">unique</span>(<span class="built_in">all</span>(v)), v.<span class="built_in">end</span>());</span><br><span class="line">    sta[tt = <span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> it : v) &#123;</span><br><span class="line">        <span class="keyword">if</span>(it != <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> g = <span class="built_in">lca</span>(it, sta[tt]);</span><br><span class="line">            <span class="keyword">if</span>(sta[tt] != g) &#123;</span><br><span class="line">                <span class="keyword">while</span>(tt &gt;= <span class="number">2</span> &amp;&amp; dfn[g] &lt; dfn[sta[tt - <span class="number">1</span>]]) &#123; </span><br><span class="line">                    <span class="built_in">add</span>(sta[tt], sta[tt - <span class="number">1</span>]); tt --;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(dfn[g] &gt; dfn[sta[tt - <span class="number">1</span>]]) &#123;</span><br><span class="line">                    <span class="built_in">add</span>(g, sta[tt]); sta[tt] = g;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="built_in">add</span>(g, sta[tt]); tt --; </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            sta[++ tt] = it;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">rep</span>(i, <span class="number">1</span>, tt - <span class="number">1</span>) <span class="built_in">add</span>(sta[i], sta[i + <span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> pos, <span class="keyword">int</span> fa)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> it : virt[pos]) &#123;</span><br><span class="line">        <span class="keyword">if</span>(it == fa) <span class="keyword">continue</span>;</span><br><span class="line">        c[it] |= c[pos];</span><br><span class="line">        <span class="built_in">dfs</span>(it, pos);</span><br><span class="line">        a[pos] |= a[it];</span><br><span class="line">        b[pos] |= b[it];</span><br><span class="line">        <span class="keyword">if</span>(c[pos] &amp;&amp; a[it] &amp;&amp; b[it]) &#123;</span><br><span class="line">            ans += dep[pos] + dep[it] - <span class="number">2</span> * dep[<span class="built_in">lca</span>(pos, it)] - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(a[pos] &amp;&amp; b[pos] &amp;&amp; c[pos]) ans ++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">(<span class="keyword">int</span> pos, <span class="keyword">int</span> fa)</span> </span>&#123;</span><br><span class="line">    a[pos] = b[pos] = c[pos] = <span class="number">0</span>; </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> it : virt[pos]) &#123;</span><br><span class="line">        <span class="keyword">if</span>(it == fa) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">clear</span>(it, pos); </span><br><span class="line">    &#125;</span><br><span class="line">    virt[pos].<span class="built_in">clear</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    n = <span class="built_in">read</span>(); q = <span class="built_in">read</span>();</span><br><span class="line">    <span class="built_in">rep</span>(i, <span class="number">1</span>, n) h[i] = <span class="number">-1</span>; idx = cnt = <span class="number">0</span>; </span><br><span class="line">    <span class="built_in">rep</span>(i, <span class="number">2</span>, n) &#123;</span><br><span class="line">        <span class="keyword">int</span> x = <span class="built_in">read</span>();</span><br><span class="line">        <span class="built_in">add</span>(x, i, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">dfs1</span>(<span class="number">1</span>, <span class="number">-1</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">dfs2</span>(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">while</span>(q --) &#123;</span><br><span class="line">        <span class="keyword">int</span> x = <span class="built_in">read</span>(), y = <span class="built_in">read</span>(), z = <span class="built_in">read</span>();</span><br><span class="line">        vector&lt;<span class="keyword">int</span>&gt; tmp;</span><br><span class="line">        <span class="built_in">rep</span>(i, <span class="number">1</span>, x) &#123;<span class="keyword">int</span> u = <span class="built_in">read</span>(); a[u] = <span class="number">1</span>; tmp.<span class="built_in">pb</span>(u); &#125;</span><br><span class="line">        <span class="built_in">rep</span>(i, <span class="number">1</span>, y) &#123;<span class="keyword">int</span> u = <span class="built_in">read</span>(); b[u] = <span class="number">1</span>; tmp.<span class="built_in">pb</span>(u); &#125;</span><br><span class="line">        <span class="built_in">rep</span>(i, <span class="number">1</span>, z) &#123;<span class="keyword">int</span> u = <span class="built_in">read</span>(); c[u] = <span class="number">1</span>; tmp.<span class="built_in">pb</span>(u); &#125;</span><br><span class="line">        <span class="built_in">build</span>(tmp);</span><br><span class="line">        ans = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">dfs</span>(<span class="number">1</span>, <span class="number">-1</span>);</span><br><span class="line">        <span class="built_in">clear</span>(<span class="number">1</span>, <span class="number">-1</span>);</span><br><span class="line">        tmp.<span class="built_in">clear</span>();</span><br><span class="line">        cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> t = <span class="built_in">read</span>();</span><br><span class="line">    <span class="keyword">while</span>(t --) <span class="built_in">solve</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="树链剖分"><a href="#树链剖分" class="headerlink" title="树链剖分"></a>树链剖分</h2><p>$O(nlog^2n)$</p>
<h3 id="点权"><a href="#点权" class="headerlink" title="点权"></a>点权</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ff double</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lc i &lt;&lt; 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rc i &lt;&lt; 1 | 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mem(a, b) memset(a, b, sizeof a)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rep(i, a, b) for(int i = (int)a; i &lt;= (int)b; i ++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> per(i, a, b) for(int i = (int)a; i &gt;= (int)b; i --)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IOS ios::sync_with_stdio(0); cin.tie(0); cout.tie(0)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = N &lt;&lt; <span class="number">1</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> l, r, w, f;</span><br><span class="line">&#125;tr[N &lt;&lt; <span class="number">2</span>];</span><br><span class="line"><span class="keyword">int</span> n, m;</span><br><span class="line"><span class="keyword">int</span> a[N];</span><br><span class="line"><span class="keyword">int</span> h[N], e[M], ne[M], idx;</span><br><span class="line"><span class="keyword">int</span> fa[N], son[N], dep[N], siz[N];</span><br><span class="line"><span class="keyword">int</span> top[N], dfn[N], ord[N], val[N];</span><br><span class="line"><span class="keyword">int</span> cnt;</span><br><span class="line"><span class="comment">//fa[i]  父结点</span></span><br><span class="line"><span class="comment">//son[i] 子结点</span></span><br><span class="line"><span class="comment">//dep[i] 深度</span></span><br><span class="line"><span class="comment">//siz[i] 子树大小</span></span><br><span class="line"><span class="comment">//top[i] 重链头</span></span><br><span class="line"><span class="comment">//dfn[i] 结点x的dfs序，也是线段树中的编号</span></span><br><span class="line"><span class="comment">//ord[i]  dfs序对应的结点编号  ord[dfn[x]] = x;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">    e[idx] = b; ne[idx] = h[a]; h[a] = idx ++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs1</span><span class="params">(<span class="keyword">int</span> pos, <span class="keyword">int</span> father, <span class="keyword">int</span> depth)</span> </span>&#123;     <span class="comment">//找重儿子, 分配深度和结点</span></span><br><span class="line">    son[pos] = <span class="number">-1</span>;</span><br><span class="line">    siz[pos] = <span class="number">1</span>; dep[pos] = depth; fa[pos] = father;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = h[pos]; ~i; i = ne[i]) &#123;</span><br><span class="line">        <span class="keyword">int</span> j = e[i];</span><br><span class="line">        <span class="keyword">if</span>(j == father) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfs1</span>(j, pos, depth + <span class="number">1</span>);</span><br><span class="line">        siz[pos] += siz[j];</span><br><span class="line">        <span class="keyword">if</span>(son[pos] == <span class="number">-1</span> || siz[son[pos]] &lt; siz[j]) son[pos] = j;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> pos, <span class="keyword">int</span> tp)</span> </span>&#123;    <span class="comment">//找重链, 分配dfs序</span></span><br><span class="line">    top[pos] = tp; dfn[pos] = ++ cnt; ord[cnt] = pos; val[cnt] = a[pos];</span><br><span class="line">    <span class="keyword">if</span>(son[pos] == <span class="number">-1</span>) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="built_in">dfs2</span>(son[pos], tp);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = h[pos]; ~i; i = ne[i]) &#123;</span><br><span class="line">        <span class="keyword">int</span> j = e[i];</span><br><span class="line">        <span class="keyword">if</span>(j == fa[pos] || j == son[pos]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfs2</span>(j, j);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    tr[i].w = tr[lc].w + tr[rc].w;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(tr[i].f) &#123;</span><br><span class="line">        tr[lc].w += (tr[lc].r - tr[lc].l + <span class="number">1</span>) * tr[i].f; tr[lc].f += tr[i].f;</span><br><span class="line">        tr[rc].w += (tr[rc].r - tr[rc].l + <span class="number">1</span>) * tr[i].f; tr[rc].f += tr[i].f;</span><br><span class="line">        tr[i].f = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">    tr[i] = &#123;l, r, val[r], <span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">if</span>(l == r) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="keyword">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">build</span>(lc, l, mid); <span class="built_in">build</span>(rc, mid + <span class="number">1</span>, r);</span><br><span class="line">    <span class="built_in">pushup</span>(i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">modify</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l &lt;= tr[i].l &amp;&amp; tr[i].r &lt;= r) &#123;</span><br><span class="line">        tr[i].f += v; </span><br><span class="line">        tr[i].w += (tr[i].r - tr[i].l + <span class="number">1</span>) * v;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">pushdown</span>(i);</span><br><span class="line">    <span class="keyword">int</span> mid = tr[i].l + tr[i].r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(l &lt;= mid) <span class="built_in">modify</span>(lc, l, r, v);</span><br><span class="line">    <span class="keyword">if</span>(mid &lt; r) <span class="built_in">modify</span>(rc, l, r, v);</span><br><span class="line">    <span class="built_in">pushup</span>(i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">modifyPath</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(top[u] != top[v]) &#123;</span><br><span class="line">        <span class="keyword">if</span>(dep[top[u]] &lt; dep[top[v]]) <span class="built_in">swap</span>(u, v);</span><br><span class="line">        <span class="built_in">modify</span>(<span class="number">1</span>, dfn[top[u]], dfn[u], x);</span><br><span class="line">        u = fa[top[u]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(dep[u] &lt; dep[v]) <span class="built_in">swap</span>(u, v);</span><br><span class="line">    <span class="built_in">modify</span>(<span class="number">1</span>, dfn[v], dfn[u], x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">modifyTree</span><span class="params">(<span class="keyword">int</span> pos, <span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">modify</span>(<span class="number">1</span>, dfn[pos], dfn[pos] + siz[pos] - <span class="number">1</span>, x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l &lt;= tr[i].l &amp;&amp; tr[i].r &lt;= r) <span class="keyword">return</span> tr[i].w;</span><br><span class="line">    <span class="built_in">pushdown</span>(i);</span><br><span class="line">    <span class="keyword">int</span> mid = tr[i].l + tr[i].r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(l &lt;= mid) ans = <span class="built_in">query</span>(lc, l, r);</span><br><span class="line">    <span class="keyword">if</span>(mid &lt; r) ans += <span class="built_in">query</span>(rc, l, r);</span><br><span class="line">    <span class="keyword">return</span> ans; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">queryPath</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(top[u] != top[v]) &#123;</span><br><span class="line">        <span class="keyword">if</span>(dep[top[u]] &lt; dep[top[v]]) <span class="built_in">swap</span>(u, v);</span><br><span class="line">        ans += <span class="built_in">query</span>(<span class="number">1</span>, dfn[top[u]], dfn[u]);</span><br><span class="line">        u = fa[top[u]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(dep[u] &lt; dep[v]) <span class="built_in">swap</span>(u, v);</span><br><span class="line">    ans += <span class="built_in">query</span>(<span class="number">1</span>, dfn[v], dfn[u]);</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">queryTree</span><span class="params">(<span class="keyword">int</span> pos)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">query</span>(<span class="number">1</span>, dfn[pos], dfn[pos] + siz[pos] - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    IOS;</span><br><span class="line">    <span class="built_in">mem</span>(h, <span class="number">-1</span>); idx = <span class="number">0</span>;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="built_in">rep</span>(i, <span class="number">1</span>, n) cin &gt;&gt; a[i];</span><br><span class="line">    <span class="built_in">rep</span>(i, <span class="number">2</span>, n) &#123;</span><br><span class="line">        <span class="keyword">int</span> u, v; cin &gt;&gt; u &gt;&gt; v;</span><br><span class="line">        <span class="built_in">add</span>(u, v); <span class="built_in">add</span>(v, u);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">dfs1</span>(<span class="number">1</span>, <span class="number">-1</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">dfs2</span>(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">build</span>(<span class="number">1</span>, <span class="number">1</span>, n);</span><br><span class="line">    cin &gt;&gt; m;</span><br><span class="line">    <span class="keyword">while</span>(m --) &#123;</span><br><span class="line">        <span class="keyword">int</span> op;</span><br><span class="line">        cin &gt;&gt; op;</span><br><span class="line">        <span class="keyword">if</span>(op == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> u, v, k;</span><br><span class="line">            cin &gt;&gt; u &gt;&gt; v &gt;&gt; k;</span><br><span class="line">            <span class="built_in">modifyPath</span>(u, v, k);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(op == <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> x, v;</span><br><span class="line">            cin &gt;&gt; x &gt;&gt; v;</span><br><span class="line">            <span class="built_in">modifyTree</span>(x, v);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(op == <span class="number">3</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> x, v;</span><br><span class="line">            cin &gt;&gt; x &gt;&gt; v;</span><br><span class="line">            cout &lt;&lt; <span class="built_in">queryPath</span>(x, v) &lt;&lt; endl;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> x; cin &gt;&gt; x;</span><br><span class="line">            cout &lt;&lt; <span class="built_in">queryTree</span>(x) &lt;&lt; endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="边权"><a href="#边权" class="headerlink" title="边权"></a>边权</h3><ul>
<li>例题 - QTREE</li>
</ul>
<p>一棵树有 n 个结点与 n-1 条边，边的编号为 1 到 n-1。需要进行以下操作：</p>
<ul>
<li><strong>CHANGE $i$ $t_i$</strong> : 将第 i 条边的权值变为 $t_i$</li>
<li><strong>QUERY $a$ $b$</strong> : 询问点 a 到点 b 路径上最大的边权</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize(2)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> endl <span class="meta-string">&quot;\n&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ff double</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lc i &lt;&lt; 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rc i &lt;&lt; 1 | 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mem(a, b) memset(a, b, sizeof a)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rep(i, a, b) for(int i = (int)a; i &lt;= (int)b; i ++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> per(i, a, b) for(int i = (int)a; i &gt;= (int)b; i --)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IOS ios::sync_with_stdio(0); cin.tie(0); cout.tie(0)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e4</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = N &lt;&lt; <span class="number">1</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">1e8</span>;</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="keyword">int</span> h[N], e[M], ne[M], w[M], widx[M], idx;</span><br><span class="line"><span class="keyword">int</span> top[N], dfn[N], siz[N], ord[N], val[N];</span><br><span class="line"><span class="keyword">int</span> dep[N], son[N], fa[N], num[N], cnt;</span><br><span class="line"><span class="comment">// ord[i] dfs序号表示的原来的点</span></span><br><span class="line"><span class="comment">// val[i] 赋给点的边权</span></span><br><span class="line"><span class="comment">// num[i] = x 第 i 条边赋给点 x</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> x = <span class="number">0</span>, f = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">char</span> c = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(!<span class="built_in">isdigit</span>(c)) &#123; <span class="keyword">if</span>(c == <span class="string">&#x27;-&#x27;</span>) f = <span class="number">-1</span>; c = <span class="built_in">getchar</span>();&#125;</span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">isdigit</span>(c)) &#123; x = x * <span class="number">10</span> + c - <span class="string">&#x27;0&#x27;</span>; c = <span class="built_in">getchar</span>();&#125;</span><br><span class="line">	<span class="keyword">return</span> x * f;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> l, r, w;</span><br><span class="line">&#125;tr[N &lt;&lt; <span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b, <span class="keyword">int</span> c, <span class="keyword">int</span> d)</span> </span>&#123;</span><br><span class="line">	e[idx] = b; w[idx] = c; widx[idx] = d; ne[idx] = h[a]; h[a] = idx ++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs1</span><span class="params">(<span class="keyword">int</span> pos, <span class="keyword">int</span> father, <span class="keyword">int</span> depth)</span> </span>&#123;</span><br><span class="line">	siz[pos] = <span class="number">1</span>; fa[pos] = father; dep[pos] = depth; son[pos] = <span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = h[pos]; ~i; i = ne[i]) &#123;</span><br><span class="line">		<span class="keyword">int</span> j = e[i];</span><br><span class="line">		<span class="keyword">if</span>(j == fa[pos]) <span class="keyword">continue</span>;</span><br><span class="line">		val[j] = w[i];</span><br><span class="line">		num[widx[i]] = j;</span><br><span class="line">		<span class="built_in">dfs1</span>(j, pos, depth + <span class="number">1</span>);</span><br><span class="line">		<span class="keyword">if</span>(son[pos] == <span class="number">-1</span> || siz[son[pos]] &lt; siz[j]) son[pos] = j;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> pos, <span class="keyword">int</span> tp)</span> </span>&#123;</span><br><span class="line">	top[pos] = tp; dfn[pos] = ++ cnt; ord[cnt] = pos;</span><br><span class="line">	<span class="keyword">if</span>(son[pos] == <span class="number">-1</span>) <span class="keyword">return</span> ;</span><br><span class="line">	<span class="built_in">dfs2</span>(son[pos], tp);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = h[pos]; ~i; i = ne[i]) &#123;</span><br><span class="line">		<span class="keyword">int</span> j = e[i];</span><br><span class="line">		<span class="keyword">if</span>(j == fa[pos] || j == son[pos]) <span class="keyword">continue</span>;</span><br><span class="line">		<span class="built_in">dfs2</span>(j, j);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">	tr[i].w = <span class="built_in">max</span>(tr[lc].w, tr[rc].w);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">	tr[i] = &#123;l, r&#125;;</span><br><span class="line">	<span class="keyword">if</span>(l == r) &#123;</span><br><span class="line">		tr[i].w = val[ord[l]];</span><br><span class="line">		<span class="keyword">return</span> ;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">	<span class="built_in">build</span>(lc, l, mid); <span class="built_in">build</span>(rc, mid + <span class="number">1</span>, r);</span><br><span class="line">	<span class="built_in">pushup</span>(i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">modify</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> x, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(tr[i].l == tr[i].r) &#123;</span><br><span class="line">		tr[i].w = v; <span class="keyword">return</span> ;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">int</span> mid = tr[i].l + tr[i].r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span>(x &lt;= mid) <span class="built_in">modify</span>(lc, x, v);</span><br><span class="line">	<span class="keyword">else</span> <span class="built_in">modify</span>(rc, x, v);</span><br><span class="line">	<span class="built_in">pushup</span>(i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(l &lt;= tr[i].l &amp;&amp; tr[i].r &lt;= r) <span class="keyword">return</span> tr[i].w;</span><br><span class="line">	<span class="keyword">int</span> mid = tr[i].l + tr[i].r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">int</span> ans = -INF;</span><br><span class="line">	<span class="keyword">if</span>(l &lt;= mid) ans = <span class="built_in">max</span>(ans, <span class="built_in">query</span>(lc, l, r));</span><br><span class="line">	<span class="keyword">if</span>(mid &lt; r) ans = <span class="built_in">max</span>(ans, <span class="built_in">query</span>(rc, l, r));</span><br><span class="line">	<span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">queryPath</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> ans = -INF;</span><br><span class="line">	<span class="keyword">while</span>(top[u] != top[v]) &#123;</span><br><span class="line">		<span class="keyword">if</span>(dep[top[u]] &lt; dep[top[v]]) <span class="built_in">swap</span>(u, v);</span><br><span class="line">		ans = <span class="built_in">max</span>(ans, <span class="built_in">query</span>(<span class="number">1</span>, dfn[top[u]], dfn[u]));</span><br><span class="line">		u = fa[top[u]];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(u == v) <span class="keyword">return</span> ans;</span><br><span class="line">	<span class="keyword">if</span>(dep[u] &lt; dep[v]) <span class="built_in">swap</span>(u, v);</span><br><span class="line">	ans = <span class="built_in">max</span>(ans, <span class="built_in">query</span>(<span class="number">1</span>, dfn[son[v]], dfn[u]));</span><br><span class="line">	<span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">mem</span>(h, <span class="number">-1</span>); idx = cnt = <span class="number">0</span>;</span><br><span class="line">	n = <span class="built_in">read</span>();</span><br><span class="line">	<span class="built_in">rep</span>(i, <span class="number">1</span>, n - <span class="number">1</span>) &#123;</span><br><span class="line">		<span class="keyword">int</span> u = <span class="built_in">read</span>(), v = <span class="built_in">read</span>(), x = <span class="built_in">read</span>(); </span><br><span class="line">		<span class="built_in">add</span>(u, v, x, i); <span class="built_in">add</span>(v, u, x, i);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">dfs1</span>(<span class="number">1</span>, <span class="number">-1</span>, <span class="number">1</span>);</span><br><span class="line">	<span class="built_in">dfs2</span>(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">	<span class="built_in">build</span>(<span class="number">1</span>, <span class="number">1</span>, n);</span><br><span class="line">	<span class="keyword">char</span> op[<span class="number">20</span>];</span><br><span class="line">	<span class="keyword">while</span>(~<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, op)) &#123;</span><br><span class="line">		<span class="keyword">if</span>(op[<span class="number">0</span>] == <span class="string">&#x27;D&#x27;</span>) <span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">if</span>(op[<span class="number">0</span>] == <span class="string">&#x27;C&#x27;</span>) &#123;</span><br><span class="line">			<span class="keyword">int</span> u = <span class="built_in">read</span>(), v = <span class="built_in">read</span>();</span><br><span class="line">			<span class="built_in">modify</span>(<span class="number">1</span>, dfn[num[u]], v);</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span>(op[<span class="number">0</span>] == <span class="string">&#x27;Q&#x27;</span>) &#123;</span><br><span class="line">			<span class="keyword">int</span> u = <span class="built_in">read</span>(), v = <span class="built_in">read</span>();</span><br><span class="line">			cout &lt;&lt; <span class="built_in">queryPath</span>(u, v) &lt;&lt; endl;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> t; cin &gt;&gt; t;</span><br><span class="line">	<span class="keyword">while</span>(t --) <span class="built_in">solve</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="数学"><a href="#数学" class="headerlink" title="数学"></a>数学</h1><h2 id="素数"><a href="#素数" class="headerlink" title="素数"></a>素数</h2><h3 id="线性筛"><a href="#线性筛" class="headerlink" title="线性筛"></a>线性筛</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> primes[N], cnt;   <span class="comment">// primes[]存储所有素数</span></span><br><span class="line"><span class="keyword">bool</span> st[N];     <span class="comment">// st[x]存储x是否被筛掉</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">get_primes</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; i ++ )&#123;</span><br><span class="line">     <span class="keyword">if</span> (!st[i]) primes[cnt ++ ] = i;</span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; primes[j] &lt;= n / i; j ++ )&#123;</span><br><span class="line">       st[primes[j] * i] = <span class="literal">true</span>;</span><br><span class="line">       <span class="keyword">if</span> (i % primes[j] == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">     &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="分解质因数"><a href="#分解质因数" class="headerlink" title="分解质因数"></a>分解质因数</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">divide</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;=  x / i; i ++ )</span><br><span class="line">     <span class="keyword">if</span> (x % i == <span class="number">0</span>)&#123;</span><br><span class="line">       <span class="keyword">int</span> s = <span class="number">0</span>;</span><br><span class="line">       <span class="keyword">while</span> (x % i == <span class="number">0</span>) x /= i, s ++ ;</span><br><span class="line">       cout &lt;&lt; i &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; s &lt;&lt; endl;</span><br><span class="line">     &#125;</span><br><span class="line">  <span class="keyword">if</span> (x &gt; <span class="number">1</span>) cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; <span class="number">1</span> &lt;&lt; endl;</span><br><span class="line">  cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="求约数"><a href="#求约数" class="headerlink" title="求约数"></a>求约数</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">vector&lt;<span class="keyword">int</span>&gt; <span class="title">get_divisors</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">  vector&lt;<span class="keyword">int</span>&gt; res;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= x / i; i ++ )</span><br><span class="line">     <span class="keyword">if</span> (x % i == <span class="number">0</span>)</span><br><span class="line">     &#123;</span><br><span class="line">       res.<span class="built_in">push_back</span>(i);</span><br><span class="line">       <span class="keyword">if</span> (i != x / i) res.<span class="built_in">push_back</span>(x / i);</span><br><span class="line">     &#125;</span><br><span class="line">  <span class="built_in">sort</span>(res.<span class="built_in">begin</span>(), res.<span class="built_in">end</span>());</span><br><span class="line">  <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>
<h2 id="求欧拉函数"><a href="#求欧拉函数" class="headerlink" title="求欧拉函数"></a>求欧拉函数</h2><p>欧拉函数是小于n的正整数中与n互质的数的数目</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">phi</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> res = x;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= x / i; i ++ )</span><br><span class="line">     <span class="keyword">if</span> (x % i == <span class="number">0</span>)&#123;</span><br><span class="line">       res = res / i * (i - <span class="number">1</span>);</span><br><span class="line">       <span class="keyword">while</span> (x % i == <span class="number">0</span>) x /= i;</span><br><span class="line">     &#125;</span><br><span class="line">  <span class="keyword">if</span> (x &gt; <span class="number">1</span>) res = res / x * (x - <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="筛法求欧拉函数"><a href="#筛法求欧拉函数" class="headerlink" title="筛法求欧拉函数"></a>筛法求欧拉函数</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> primes[N], cnt;   <span class="comment">// primes[]存储所有素数</span></span><br><span class="line"><span class="keyword">int</span> euler[N];      <span class="comment">// 存储每个数的欧拉函数</span></span><br><span class="line"><span class="keyword">bool</span> st[N];     <span class="comment">// st[x]存储x是否被筛掉</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">get_eulers</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">  euler[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; i ++ )&#123;</span><br><span class="line">     <span class="keyword">if</span> (!st[i])&#123;</span><br><span class="line">       primes[cnt ++ ] = i;</span><br><span class="line">       euler[i] = i - <span class="number">1</span>;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; primes[j] &lt;= n / i; j ++ )&#123;</span><br><span class="line">       <span class="keyword">int</span> t = primes[j] * i;</span><br><span class="line">       st[t] = <span class="literal">true</span>;</span><br><span class="line">       <span class="keyword">if</span> (i % primes[j] == <span class="number">0</span>)&#123;</span><br><span class="line">         euler[t] = euler[i] * primes[j];</span><br><span class="line">         <span class="keyword">break</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       euler[t] = euler[i] * (primes[j] - <span class="number">1</span>);</span><br><span class="line">     &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="扩欧"><a href="#扩欧" class="headerlink" title="扩欧"></a>扩欧</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 求x, y，使得ax + by = gcd(a, b)</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">exgcd</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b, <span class="keyword">int</span> &amp;x, <span class="keyword">int</span> &amp;y)</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!b)&#123;</span><br><span class="line">     x = <span class="number">1</span>; y = <span class="number">0</span>;</span><br><span class="line">     <span class="keyword">return</span> a;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">int</span> d = <span class="built_in">exgcd</span>(b, a % b, y, x);</span><br><span class="line">  y -= (a/b) * x;</span><br><span class="line">  <span class="keyword">return</span> d;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="高斯消元"><a href="#高斯消元" class="headerlink" title="高斯消元"></a>高斯消元</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a[N][N]是增广矩阵</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">gauss</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> c, r;</span><br><span class="line">  <span class="keyword">for</span> (c = <span class="number">0</span>, r = <span class="number">0</span>; c &lt; n; c ++ )&#123;</span><br><span class="line">     <span class="keyword">int</span> t = r;</span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">int</span> i = r; i &lt; n; i ++ )  <span class="comment">// 找到绝对值最大的行</span></span><br><span class="line">       <span class="keyword">if</span> (<span class="built_in">fabs</span>(a[i][c]) &gt; <span class="built_in">fabs</span>(a[t][c]))</span><br><span class="line">         t = i;</span><br><span class="line">     <span class="keyword">if</span> (<span class="built_in">fabs</span>(a[t][c]) &lt; eps) <span class="keyword">continue</span>;</span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">int</span> i = c; i &lt;= n; i ++ ) <span class="built_in">swap</span>(a[t][i], a[r][i]);  <span class="comment">// 将绝对值最大的行换到最顶端</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = n; i &gt;= c; i -- ) a[r][i] /= a[r][c];   <span class="comment">// 将当前行的首位变成1</span></span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">int</span> i = r + <span class="number">1</span>; i &lt; n; i ++ )    <span class="comment">// 用当前行将下面所有的列消成0</span></span><br><span class="line">       <span class="keyword">if</span> (<span class="built_in">fabs</span>(a[i][c]) &gt; eps)</span><br><span class="line">         <span class="keyword">for</span> (<span class="keyword">int</span> j = n; j &gt;= c; j -- )</span><br><span class="line">           a[i][j] -= a[r][j] * a[i][c];</span><br><span class="line">     r ++ ;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (r &lt; n)&#123;</span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">int</span> i = r; i &lt; n; i ++ )</span><br><span class="line">       <span class="keyword">if</span> (<span class="built_in">fabs</span>(a[i][n]) &gt; eps)</span><br><span class="line">         <span class="keyword">return</span> <span class="number">2</span>; <span class="comment">// 无解</span></span><br><span class="line">     <span class="keyword">return</span> <span class="number">1</span>; <span class="comment">// 有无穷多组解</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = n - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i -- )</span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">int</span> j = i + <span class="number">1</span>; j &lt; n; j ++ )</span><br><span class="line">       a[i][n] -= a[i][j] * a[j][n];</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>; <span class="comment">// 有唯一解</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="求组合数"><a href="#求组合数" class="headerlink" title="求组合数"></a>求组合数</h2><h3 id="递归"><a href="#递归" class="headerlink" title="递归"></a>递归</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// c[a][b] 表示从a个苹果中选b个的方案数</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i ++ )</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= i; j ++ )</span><br><span class="line">     <span class="keyword">if</span> (!j) c[i][j] = <span class="number">1</span>;</span><br><span class="line">     <span class="keyword">else</span> c[i][j] = (c[i - <span class="number">1</span>][j] + c[i - <span class="number">1</span>][j - <span class="number">1</span>]) % mod;</span><br></pre></td></tr></table></figure>
<h3 id="预处理逆元求组合数"><a href="#预处理逆元求组合数" class="headerlink" title="预处理逆元求组合数"></a>预处理逆元求组合数</h3><p>首先预处理出所有阶乘取模的余数 $fac[N]$ ，以及所有阶乘取模的逆元 $inv[N]$<br>如果取模的数是质数，可以用费马小定理求逆元</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rep(i, a, b) for(int i = (int)a; i &lt;= (int)b; i ++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> per(i, a, b) for(int i = (int)a; i &gt;= (int)b; i --)</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">2e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> mod = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"><span class="keyword">int</span> fac[N], inv[N];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">qpow</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b, <span class="keyword">int</span> p)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> ans = <span class="number">1</span> % p;</span><br><span class="line">    a %= p;</span><br><span class="line">    <span class="keyword">while</span>(b)&#123;</span><br><span class="line">		<span class="keyword">if</span>(b &amp; <span class="number">1</span>) ans = (ans * a) % p;</span><br><span class="line">    	a = (a * a) % p;</span><br><span class="line">    	b &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">	fac[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">   	<span class="built_in">rep</span>(i, <span class="number">1</span>, N - <span class="number">1</span>) fac[i] = (<span class="number">1LL</span> * fac[i - <span class="number">1</span>] * i) % mod;</span><br><span class="line">    inv[N - <span class="number">1</span>] = <span class="built_in">qpow</span>(fac[N - <span class="number">1</span>], mod - <span class="number">2</span>, mod);</span><br><span class="line">    <span class="built_in">per</span>(i, N - <span class="number">2</span>, <span class="number">0</span>) inv[i] = (<span class="number">1LL</span> * inv[i + <span class="number">1</span>] * (i + <span class="number">1</span>)) % mod;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">C</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">int</span> m)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="number">1LL</span> * fac[n] * inv[m] % mod * inv[n - m]) % mod;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="错排公式"><a href="#错排公式" class="headerlink" title="错排公式"></a>错排公式</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* n &gt;= 3 D[n] = (D[n - 1] + D[n - 2]) * (n - 1);</span></span><br><span class="line"><span class="comment">	D[1] = 0; D[2] = 1;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rep(i, a, b) for(int i = a; i &lt;= b; i ++)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> mod = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"></span><br><span class="line">D[<span class="number">1</span>] = <span class="number">0</span>; D[<span class="number">2</span>] = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">rep</span>(i, <span class="number">3</span>, N - <span class="number">1</span>) D[i] = ((i - <span class="number">1</span>) * (D[i - <span class="number">1</span>] + D[i - <span class="number">2</span>])) % mod;</span><br></pre></td></tr></table></figure>
<h2 id="卢卡斯定理"><a href="#卢卡斯定理" class="headerlink" title="卢卡斯定理"></a>卢卡斯定理</h2><p>若p是质数，则对于任意整数 1 &lt;= m &lt;= n，有：</p>
<p>C(n, m) = C(n % p, m % p) * C(n / p, m / p) (mod p)</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">qmi</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> k, <span class="keyword">int</span> p)</span> </span>&#123; <span class="comment">// 快速幂模板</span></span><br><span class="line">    <span class="keyword">int</span> res = <span class="number">1</span> % p;</span><br><span class="line">    <span class="keyword">while</span> (k)&#123;</span><br><span class="line">    	<span class="keyword">if</span> (k &amp; <span class="number">1</span>) res = (LL)res * a % p;</span><br><span class="line">    	a = (LL)a * a % p;</span><br><span class="line">    	k &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">C</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b, <span class="keyword">int</span> p)</span> </span>&#123; <span class="comment">// 通过定理求组合数C(a, b)</span></span><br><span class="line">    <span class="keyword">if</span> (a &lt; b) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    LL x = <span class="number">1</span>, y = <span class="number">1</span>; <span class="comment">// x是分子，y是分母</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = a, j = <span class="number">1</span>; j &lt;= b; i --, j ++ ) &#123;</span><br><span class="line">        x = (LL)x * i % p;</span><br><span class="line">        y = (LL) y * j % p;</span><br><span class="line">   &#125;</span><br><span class="line">	<span class="keyword">return</span> x * (LL)<span class="built_in">qmi</span>(y, p - <span class="number">2</span>, p) % p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lucas</span><span class="params">(LL a, LL b, <span class="keyword">int</span> p)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (a &lt; p &amp;&amp; b &lt; p) <span class="keyword">return</span> <span class="built_in">C</span>(a, b, p);</span><br><span class="line">	<span class="keyword">return</span> (LL)<span class="built_in">C</span>(a % p, b % p, p) * <span class="built_in">lucas</span>(a / p, b / p, p) % p;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="卡特兰数"><a href="#卡特兰数" class="headerlink" title="卡特兰数"></a>卡特兰数</h2><p>给定n个0和n个1，它们按照某种顺序排成长度为2n的序列，满足任意前缀中0的个数都不少于1的个数的序列的数量为： Cat(n) = C(2n, n) / (n + 1)</p>
<h2 id="快速幂"><a href="#快速幂" class="headerlink" title="快速幂"></a>快速幂</h2><p>求 $m^k$ $mod$ $p$，时间复杂度 $O(logk)$。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">qpow</span><span class="params">(<span class="keyword">int</span> m, <span class="keyword">int</span> k, <span class="keyword">int</span> p)</span></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> res = <span class="number">1</span> % p, t = m;</span><br><span class="line">  <span class="keyword">while</span> (k)&#123;</span><br><span class="line">     <span class="keyword">if</span> (k&amp;<span class="number">1</span>) res = res * t % p;</span><br><span class="line">     t = t * t % p;</span><br><span class="line">     k &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="博弈"><a href="#博弈" class="headerlink" title="博弈"></a>博弈</h2><h3 id="巴什博奕"><a href="#巴什博奕" class="headerlink" title="巴什博奕"></a>巴什博奕</h3><p>有一堆石子n个 , 每次可以取1~m个石子 , 没有石子可取的那方输 , 问第一个取的人的输赢</p>
<p>$n$ $mod$ $%$ $(m+1)$ $!=$ $0$ 先手赢</p>
<p>变形：最后取的输 $(n-1)$ $mod$ $(m+1)$ $!=$ $0$</p>
<h3 id="威佐夫博弈"><a href="#威佐夫博弈" class="headerlink" title="威佐夫博弈"></a>威佐夫博弈</h3><p>有两堆各若干个物品，两个人轮流从某一堆或同时从两堆中取同样多的物品，规定每次至少取一个，多者不限，最后取光者得胜。</p>
<p>我们用 ( a [ k ] ， b [ k ] ) (a[k]，b[k]) (a[k]，b[k])表示两堆物品的数量并称其为局势，显然(0，0)为必输局势，这种必输局势我们称为奇异局势。</p>
<p>前几个奇异局势是：（0，0）,（1，2）,（3，5）,（4，7）,（6，10）,（8，13）,（9，15）,（11，18）,（12，20）</p>
<p>奇异局势判断 :</p>
<p>直接判断小的那堆能不能写成上面a的公式 ( k = b − a )</p>
<p>$a[k]=[k(1+√5)/2],b[k]=a[k]+k$</p>
<h3 id="Nim博弈"><a href="#Nim博弈" class="headerlink" title="Nim博弈"></a>Nim博弈</h3><p>有k堆各若干个物品，两个人轮流从某一堆取任意多的物品，规定每次至少取一个，多者不限，最后取光者得胜。</p>
<p>如果k堆全部异或结果 == 0 则先手必败，否则先手必胜</p>
<h3 id="Fibonacci博弈"><a href="#Fibonacci博弈" class="headerlink" title="Fibonacci博弈"></a>Fibonacci博弈</h3><p>有一堆石子,两个人轮流从其中取走一定的石子,取走最后所有石子的人为赢家,不过得遵循如下规则:</p>
<p>1.第一次取不能取完,至少取1颗.</p>
<p>2.从第二次开始,每个人取的石子数至少为1,至多为对手刚取的石子数的两倍。</p>
<p>当n为Fibonacci数时，先手必败。否则先手必胜</p>
<h2 id="2-SAT"><a href="#2-SAT" class="headerlink" title="2-SAT"></a>2-SAT</h2><p>$a$ $→$ $b$  $&lt;=&gt;$ $¬$ $a$  $∨$ $b$</p>
<p>$a$  $∨$ $b$ $&lt;=&gt;$ $¬$ $a$  $→$ $b$  $∧$ $¬$ $b$  $→$ $a$ </p>
<p>$a$ $=$ 1 $&lt;=&gt;$ $a$ $∨$ $a$</p>
<p>$a$ $=$ $0$ $&lt;=&gt;$ $¬<script type="math/tex">a$ $∨$ $¬</script>a$</p>
<p>没有一条路径将所有条件串起来即为无解</p>
<p>即</p>
<p>$ョ$ $¬$ $x$ 和 $x$ 在同一个强连通分量内无解</p>
<p>正反编号可以任意，可以 $add(<script type="math/tex">i$ $<<$ $1$, $i$ $<<$ $1$ $+$ $1$);  亦可 $add(</script>i$ , $i$ $+$ $n$);</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> endl <span class="meta-string">&quot;\n&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ff double</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mem(a, b) memset(a, b, sizeof a)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rep(i, a, b) for(int i = (int)a; i &lt;= (int)b; i ++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> per(i, a, b) for(int i = (int)a; i &gt;= (int)b; i --)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IOS ios::sync_with_stdio(0); cin.tie(0); cout.tie(0)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">2e6</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = N &lt;&lt; <span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> n, m;</span><br><span class="line"><span class="keyword">int</span> h[N], e[M], ne[M], idx;</span><br><span class="line"><span class="keyword">int</span> dfn[N], low[N], ts, ins[N], belong[N], cnt;</span><br><span class="line">stack&lt;<span class="keyword">int</span>&gt; sta;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">	e[idx] = b; ne[idx] = h[a]; h[a] = idx ++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">tarjan</span><span class="params">(<span class="keyword">int</span> pos)</span> </span>&#123;</span><br><span class="line">	dfn[pos] = low[pos] = ++ ts;</span><br><span class="line">	sta.<span class="built_in">push</span>(pos); ins[pos] = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = h[pos]; ~i; i = ne[i]) &#123;</span><br><span class="line">		<span class="keyword">int</span> j = e[i];</span><br><span class="line">		<span class="keyword">if</span>(!dfn[j]) &#123;</span><br><span class="line">			<span class="built_in">tarjan</span>(j);</span><br><span class="line">			low[pos] = <span class="built_in">min</span>(low[pos], low[j]);</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span>(ins[j]) low[pos] = <span class="built_in">min</span>(low[pos], dfn[j]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(low[pos] == dfn[pos]) &#123;</span><br><span class="line">		<span class="keyword">int</span> y; </span><br><span class="line">		cnt ++;</span><br><span class="line">		<span class="keyword">do</span> &#123;	</span><br><span class="line">			y = sta.<span class="built_in">top</span>(); sta.<span class="built_in">pop</span>();</span><br><span class="line">			ins[y] = <span class="number">0</span>; belong[y] = cnt;</span><br><span class="line">		&#125; <span class="keyword">while</span>(pos != y);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">mem</span>(h, <span class="number">-1</span>); idx = <span class="number">0</span>;</span><br><span class="line">	IOS; cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">	<span class="built_in">rep</span>(i, <span class="number">1</span>, m) &#123;</span><br><span class="line">		<span class="keyword">int</span> x, a, y, b;</span><br><span class="line">		cin &gt;&gt; x &gt;&gt; a &gt;&gt; y &gt;&gt; b;</span><br><span class="line">		x --; y --;</span><br><span class="line">		<span class="built_in">add</span>(<span class="number">2</span> * x + !a, <span class="number">2</span> * y + b);</span><br><span class="line">		<span class="built_in">add</span>(<span class="number">2</span> * y + !b, <span class="number">2</span> * x + a); </span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">rep</span>(i, <span class="number">0</span>, n * <span class="number">2</span> - <span class="number">1</span>) </span><br><span class="line">		<span class="keyword">if</span>(!dfn[i]) <span class="built_in">tarjan</span>(i);</span><br><span class="line">	<span class="built_in">rep</span>(i, <span class="number">0</span>, n - <span class="number">1</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span>(belong[i &lt;&lt; <span class="number">1</span>] == belong[(i &lt;&lt; <span class="number">1</span>) + <span class="number">1</span>]) &#123;</span><br><span class="line">			cout &lt;&lt; <span class="string">&quot;IMPOSSIBLE\n&quot;</span>; <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;POSSIBLE\n&quot;</span>;</span><br><span class="line">	<span class="built_in">rep</span>(i, <span class="number">0</span>, n - <span class="number">1</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span>(belong[i &lt;&lt; <span class="number">1</span>] &lt; belong[(i &lt;&lt; <span class="number">1</span>) + <span class="number">1</span>]) cout &lt;&lt; <span class="string">&quot;0 &quot;</span>;</span><br><span class="line">		<span class="keyword">else</span> cout &lt;&lt; <span class="string">&quot;1 &quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="杂项"><a href="#杂项" class="headerlink" title="杂项"></a>杂项</h1><h2 id="归并排序"><a href="#归并排序" class="headerlink" title="归并排序"></a>归并排序</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">merge</span><span class="params">(<span class="keyword">int</span> q[], <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (l &gt;= r) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">merge</span>(q, l, mid);</span><br><span class="line">  <span class="built_in">merge</span>(q, mid + <span class="number">1</span>, r);</span><br><span class="line">  <span class="keyword">int</span> k = <span class="number">0</span>, i = l, j = mid + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span> (i &lt;= mid &amp;&amp; j &lt;= r)</span><br><span class="line">    <span class="keyword">if</span> (q[i] &lt;= q[j]) tmp[k ++ ] = q[i ++ ];</span><br><span class="line">    <span class="keyword">else</span> tmp[k ++ ] = q[j ++ ];</span><br><span class="line">  <span class="keyword">while</span> (i &lt;= mid) tmp[k ++ ] = q[i ++ ];</span><br><span class="line">  <span class="keyword">while</span> (j &lt;= r) tmp[k ++ ] = q[j ++ ];</span><br><span class="line">  <span class="keyword">for</span> (i = l, j = <span class="number">0</span>; i &lt;= r; i ++, j ++ ) q[i] = tmp[j];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="高精度"><a href="#高精度" class="headerlink" title="高精度"></a>高精度</h2><h3 id="高精加法"><a href="#高精加法" class="headerlink" title="高精加法"></a>高精加法</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">vector&lt;<span class="keyword">int</span>&gt; <span class="title">add</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt; &amp;A,vector&lt;<span class="keyword">int</span>&gt; &amp;B)</span></span>&#123;</span><br><span class="line">    vector&lt;<span class="keyword">int</span>&gt;C;</span><br><span class="line">    <span class="keyword">int</span> t = <span class="number">0</span>;<span class="comment">//进位</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i&lt;A.<span class="built_in">size</span>()||i&lt;B.<span class="built_in">size</span>();i++)&#123;</span><br><span class="line">      <span class="keyword">if</span>(i&lt;A.<span class="built_in">size</span>()) t+ = A[i];</span><br><span class="line">      <span class="keyword">if</span>(i&lt;B.<span class="built_in">size</span>()) t+ = B[i];</span><br><span class="line">      C.<span class="built_in">push_back</span>(t%<span class="number">10</span>);</span><br><span class="line">      t/=<span class="number">10</span>;</span><br><span class="line">   	&#125;</span><br><span class="line">    <span class="keyword">if</span>(t) C.<span class="built_in">push_back</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> C;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="高精减法"><a href="#高精减法" class="headerlink" title="高精减法"></a>高精减法</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt;&amp;A,vector&lt;<span class="keyword">int</span>&gt;&amp;B)</span></span>&#123;     <span class="comment">//判断AB谁大</span></span><br><span class="line">  <span class="keyword">if</span>(A.<span class="built_in">size</span>()!=B.<span class="built_in">size</span>()) <span class="keyword">return</span> A.<span class="built_in">size</span>()&gt;B.<span class="built_in">size</span>();</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = A.<span class="built_in">size</span>()<span class="number">-1</span>;i&gt;= <span class="number">0</span>;i--)</span><br><span class="line">    <span class="keyword">if</span>(A[i]!=B[i]) <span class="keyword">return</span> A[i]&gt;B[i];</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">vector&lt;<span class="keyword">int</span>&gt; <span class="title">sub</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt; &amp;A,vector&lt;<span class="keyword">int</span>&gt; &amp;B)</span></span>&#123;</span><br><span class="line">  vector&lt;<span class="keyword">int</span>&gt; C;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>,t = <span class="number">0</span>;i&lt;A.<span class="built_in">size</span>();i++)&#123;</span><br><span class="line">    t = A[i]-t;</span><br><span class="line">    <span class="keyword">if</span>(i&lt;B.<span class="built_in">size</span>()) t- = B[i];</span><br><span class="line">    C.<span class="built_in">push_back</span>((t+<span class="number">10</span>)%<span class="number">10</span>);</span><br><span class="line">    <span class="keyword">if</span>(t&lt;<span class="number">0</span>) t = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> t = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span>(C.<span class="built_in">size</span>()&gt;<span class="number">1</span>&amp;&amp;C.<span class="built_in">back</span>() ==<span class="number">0</span>) C.<span class="built_in">pop_back</span>();         <span class="comment">//去前导零</span></span><br><span class="line">  <span class="keyword">return</span> C;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="高精乘法"><a href="#高精乘法" class="headerlink" title="高精乘法"></a>高精乘法</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;<span class="keyword">int</span>&gt;<span class="built_in">div</span>(vector&lt;<span class="keyword">int</span>&gt; &amp;A,<span class="keyword">int</span> b,<span class="keyword">int</span> &amp;r)&#123;</span><br><span class="line">  vector&lt;<span class="keyword">int</span>&gt;C;</span><br><span class="line">  r = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = A.<span class="built_in">size</span>()<span class="number">-1</span>;i&gt;= <span class="number">0</span>;i--)&#123;</span><br><span class="line">     r = r*<span class="number">10</span>+A[i];</span><br><span class="line">    C.<span class="built_in">push_back</span>(r/b);</span><br><span class="line">    r% = b;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">reverse</span>(C.<span class="built_in">begin</span>(),C.<span class="built_in">end</span>());</span><br><span class="line">  <span class="keyword">while</span>(C.<span class="built_in">size</span>()&gt;<span class="number">1</span>&amp;&amp;C.<span class="built_in">back</span>() ==<span class="number">0</span>) C.<span class="built_in">pop_back</span>();</span><br><span class="line">  <span class="keyword">return</span> C;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="高精除法"><a href="#高精除法" class="headerlink" title="高精除法"></a>高精除法</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;<span class="keyword">int</span>&gt;<span class="built_in">div</span>(vector&lt;<span class="keyword">int</span>&gt; &amp;A,<span class="keyword">int</span> b,<span class="keyword">int</span> &amp;r)&#123;</span><br><span class="line">  vector&lt;<span class="keyword">int</span>&gt;C;</span><br><span class="line">  r = <span class="number">0</span>;                <span class="comment">//余数</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = A.<span class="built_in">size</span>()<span class="number">-1</span>;i&gt;= <span class="number">0</span>;i--)&#123;</span><br><span class="line">    r = r*<span class="number">10</span>+A[i];</span><br><span class="line">     C.<span class="built_in">push_back</span>(r/b);</span><br><span class="line">     r% = b;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">reverse</span>(C.<span class="built_in">begin</span>(),C.<span class="built_in">end</span>());</span><br><span class="line">  <span class="keyword">while</span>(C.<span class="built_in">size</span>()&gt;<span class="number">1</span>&amp;&amp;C.<span class="built_in">back</span>() ==<span class="number">0</span>) C.<span class="built_in">pop_back</span>();</span><br><span class="line">  <span class="keyword">return</span> C;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> C = <span class="built_in">F</span>(A,B);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = C.<span class="built_in">size</span>()<span class="number">-1</span>;i&gt;= <span class="number">0</span>;i--) cout&lt;&lt;C[i];</span><br></pre></td></tr></table></figure>
<h2 id="二分"><a href="#二分" class="headerlink" title="二分"></a>二分</h2><h3 id="整数二分"><a href="#整数二分" class="headerlink" title="整数二分"></a>整数二分</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 区间[l, r]被划分成[l, mid]和[mid + 1, r]时使用：</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">bsearch_1</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">  <span class="keyword">while</span> (l &lt; r)&#123;</span><br><span class="line">     <span class="keyword">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">     <span class="keyword">if</span> (<span class="built_in">check</span>(mid)) r = mid;  <span class="comment">// check()判断mid是否满足性质</span></span><br><span class="line">     <span class="keyword">else</span> l = mid + <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> l;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 区间[l, r]被划分成[l, mid - 1]和[mid, r]时使用：</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">bsearch_2</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">  <span class="keyword">while</span> (l &lt; r)&#123;</span><br><span class="line">     <span class="keyword">int</span> mid = l + r + <span class="number">1</span> &gt;&gt; <span class="number">1</span>;</span><br><span class="line">     <span class="keyword">if</span> (<span class="built_in">check</span>(mid)) l = mid;</span><br><span class="line">     <span class="keyword">else</span> r = mid - <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> l;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="浮点二分"><a href="#浮点二分" class="headerlink" title="浮点二分"></a>浮点二分</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">bsearch_3</span><span class="params">(<span class="keyword">double</span> l, <span class="keyword">double</span> r)</span></span>&#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">double</span> eps = <span class="number">1e-6</span>;  <span class="comment">// eps 表示精度，取决于题目对精度的要求</span></span><br><span class="line">  <span class="keyword">while</span> (r - l &gt; eps)&#123;</span><br><span class="line">     <span class="keyword">double</span> mid = (l + r) / <span class="number">2</span>;</span><br><span class="line">     <span class="keyword">if</span> (<span class="built_in">check</span>(mid)) r = mid;</span><br><span class="line">     <span class="keyword">else</span> l = mid;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> l;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="前缀和"><a href="#前缀和" class="headerlink" title="前缀和"></a>前缀和</h2><h3 id="一维"><a href="#一维" class="headerlink" title="一维"></a>一维</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">S[<span class="number">1</span>] = a[<span class="number">1</span>];</span><br><span class="line">S[i] = S[i<span class="number">-1</span>]+a[i];<span class="comment">//(i&gt;= 2)</span></span><br><span class="line">a[l]+a[l+<span class="number">1</span>]+…+a[r] = S[r]-S[l<span class="number">-1</span>];</span><br></pre></td></tr></table></figure>
<h3 id="二维"><a href="#二维" class="headerlink" title="二维"></a>二维</h3><p>S[i, j] = 第i行j列格子左上部分所有元素的和</p>
<p>以(x1, y1)为左上角，(x2, y2)为右下角的子矩阵的和为：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">S[x2, y2] - S[x1 - <span class="number">1</span>, y2] - S[x2, y1 - <span class="number">1</span>] + S[x1 - <span class="number">1</span>, y1 - <span class="number">1</span>];</span><br></pre></td></tr></table></figure>
<h2 id="差分"><a href="#差分" class="headerlink" title="差分"></a>差分</h2><h3 id="一维-1"><a href="#一维-1" class="headerlink" title="一维"></a>一维</h3><p>给区间[l, r]中的每个数加上c：B[l] + =  c, B[r + 1] - =  c</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">S[l] += c; b[r + <span class="number">1</span>] -= c; </span><br></pre></td></tr></table></figure>
<h3 id="二维-1"><a href="#二维-1" class="headerlink" title="二维"></a>二维</h3><p>给以(x1, y1)为左上角，(x2, y2)为右下角的子矩阵中的所有元素加上c：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">S[x1, y1] + =  c, S[x2 + <span class="number">1</span>, y1] - =  c, S[x1, y2 + <span class="number">1</span>] - =  c, S[x2 + <span class="number">1</span>, y2 + <span class="number">1</span>] + =  c;</span><br></pre></td></tr></table></figure>
<h2 id="位运算"><a href="#位运算" class="headerlink" title="位运算"></a>位运算</h2><p>求n的第k位数字: n &gt;&gt; k &amp; 1</p>
<p>返回n的最后一位1：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lowbit</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123; <span class="keyword">return</span> n &amp; -n; &#125; </span><br></pre></td></tr></table></figure>
<p>返回n的二进制中1的个数：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> cnt = __builtin_popcount(n);</span><br></pre></td></tr></table></figure>
<h2 id="STL"><a href="#STL" class="headerlink" title="STL"></a>STL</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">vector, 变长数组，倍增的思想</span><br><span class="line">  <span class="built_in">size</span>() 返回元素个数</span><br><span class="line">  <span class="built_in">empty</span>() 返回是否为空</span><br><span class="line">  <span class="built_in">clear</span>() 清空</span><br><span class="line">  <span class="built_in">front</span>()/<span class="built_in">back</span>()</span><br><span class="line">  <span class="built_in">push_back</span>()/<span class="built_in">pop_back</span>()</span><br><span class="line">  <span class="built_in">begin</span>()/<span class="built_in">end</span>()</span><br><span class="line">  []</span><br><span class="line">  支持比较运算，按字典序</span><br><span class="line">  </span><br><span class="line">pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;</span><br><span class="line">  first, 第一个元素</span><br><span class="line">  second, 第二个元素</span><br><span class="line">  支持比较运算，以first为第一关键字，以second为第二关键字（字典序）</span><br><span class="line"></span><br><span class="line">string，字符串</span><br><span class="line">  <span class="built_in">size</span>()/<span class="built_in">length</span>() 返回字符串长度</span><br><span class="line">  <span class="built_in">empty</span>()</span><br><span class="line">  <span class="built_in">clear</span>()</span><br><span class="line">  <span class="built_in">substr</span>(起始下标，(子串长度)) 返回子串</span><br><span class="line">  <span class="built_in">c_str</span>() 返回字符串所在字符数组的起始地址</span><br><span class="line"></span><br><span class="line">queue, 队列</span><br><span class="line">  <span class="built_in">size</span>()</span><br><span class="line">  <span class="built_in">empty</span>()</span><br><span class="line">  <span class="built_in">push</span>() 向队尾插入一个元素</span><br><span class="line">  <span class="built_in">front</span>() 返回队头元素</span><br><span class="line">  <span class="built_in">back</span>() 返回队尾元素</span><br><span class="line">  <span class="built_in">pop</span>() 弹出队头元素</span><br><span class="line">  </span><br><span class="line">priority_queue, 优先队列，默认是大根堆</span><br><span class="line">  <span class="built_in">size</span>()</span><br><span class="line">  <span class="built_in">empty</span>()</span><br><span class="line">  <span class="built_in">push</span>() 插入一个元素</span><br><span class="line">  <span class="built_in">top</span>() 返回堆顶元素</span><br><span class="line">  <span class="built_in">pop</span>() 弹出堆顶元素</span><br><span class="line">  定义成小根堆的方式：priority_queue&lt;<span class="keyword">int</span>, vector&lt;<span class="keyword">int</span>&gt;, greater&lt;<span class="keyword">int</span>&gt;&gt; q;</span><br><span class="line"></span><br><span class="line">stack, 栈</span><br><span class="line">  <span class="built_in">size</span>()</span><br><span class="line">  <span class="built_in">empty</span>()</span><br><span class="line">  <span class="built_in">push</span>() 向栈顶插入一个元素</span><br><span class="line">  <span class="built_in">top</span>() 返回栈顶元素</span><br><span class="line">  <span class="built_in">pop</span>() 弹出栈顶元素</span><br><span class="line"></span><br><span class="line">deque, 双端队列</span><br><span class="line">  <span class="built_in">size</span>()</span><br><span class="line">  <span class="built_in">empty</span>()</span><br><span class="line">  <span class="built_in">clear</span>()</span><br><span class="line">  <span class="built_in">front</span>()/<span class="built_in">back</span>()</span><br><span class="line">  <span class="built_in">push_back</span>()/<span class="built_in">pop_back</span>()</span><br><span class="line">  <span class="built_in">push_front</span>()/<span class="built_in">pop_front</span>()</span><br><span class="line">  <span class="built_in">begin</span>()/<span class="built_in">end</span>()</span><br><span class="line">  []</span><br><span class="line"></span><br><span class="line">set, map, multiset, multimap, 基于平衡二叉树（红黑树），动态维护有序序列</span><br><span class="line">  <span class="built_in">size</span>()</span><br><span class="line">  <span class="built_in">empty</span>()</span><br><span class="line">  <span class="built_in">clear</span>()</span><br><span class="line">  <span class="built_in">begin</span>()/<span class="built_in">end</span>()</span><br><span class="line">  ++, -- 返回前驱和后继，时间复杂度 <span class="built_in">O</span>(logn)</span><br><span class="line">  </span><br><span class="line">set/<span class="function">multiset</span></span><br><span class="line"><span class="function">     <span class="title">insert</span><span class="params">()</span> 插入一个数</span></span><br><span class="line"><span class="function">     <span class="title">find</span><span class="params">()</span> 查找一个数</span></span><br><span class="line"><span class="function">     <span class="title">count</span><span class="params">()</span> 返回某一个数的个数</span></span><br><span class="line"><span class="function">     <span class="title">erase</span><span class="params">()</span></span></span><br><span class="line"><span class="function">       <span class="params">(<span class="number">1</span>)</span> 输入是一个数x，删除所有x  <span class="title">O</span><span class="params">(k + logn)</span></span></span><br><span class="line"><span class="function">       <span class="params">(<span class="number">2</span>)</span> 输入一个迭代器，删除这个迭代器</span></span><br><span class="line"><span class="function">     <span class="title">lower_bound</span><span class="params">()</span>/<span class="title">upper_bound</span><span class="params">()</span></span></span><br><span class="line"><span class="function">       <span class="title">lower_bound</span><span class="params">(x)</span> 返回大于等于x的最小的数的迭代器</span></span><br><span class="line"><span class="function">       <span class="title">upper_bound</span><span class="params">(x)</span> 返回大于x的最小的数的迭代器</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">map/multimap</span></span><br><span class="line"><span class="function">     <span class="title">insert</span><span class="params">()</span> 插入的数是一个pair</span></span><br><span class="line"><span class="function">     <span class="title">erase</span><span class="params">()</span> 输入的参数是pair或者迭代器</span></span><br><span class="line"><span class="function">     <span class="title">find</span><span class="params">()</span></span></span><br><span class="line"><span class="function">     [] 注意multimap不支持此操作。 时间复杂度是 <span class="title">O</span><span class="params">(logn)</span></span></span><br><span class="line"><span class="function">     <span class="title">lower_bound</span><span class="params">()</span>/<span class="title">upper_bound</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">unordered_set, unordered_map, unordered_multiset, </span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">unordered_multimap, 哈希表</span></span><br><span class="line"><span class="function">  和上面类似，增删改查的时间复杂度是 <span class="title">O</span><span class="params">(<span class="number">1</span>)</span></span></span><br><span class="line"><span class="function">  不支持 <span class="title">lower_bound</span><span class="params">()</span>/<span class="title">upper_bound</span><span class="params">()</span>， 迭代器的++，--</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">bitset, 圧位</span></span><br><span class="line"><span class="function">  bitset&lt;10000&gt; s</span>;</span><br><span class="line">  ~, &amp;, |, ^</span><br><span class="line">  \&gt;&gt;, &lt;&lt;</span><br><span class="line">   ==, !=</span><br><span class="line">  []</span><br><span class="line">  <span class="built_in">count</span>() 返回有多少个<span class="number">1</span></span><br><span class="line">  <span class="built_in">any</span>() 判断是否至少有一个<span class="number">1</span></span><br><span class="line">  <span class="built_in">none</span>() 判断是否全为<span class="number">0</span></span><br><span class="line">  <span class="built_in">set</span>() 把所有位置成<span class="number">1</span></span><br><span class="line">  <span class="built_in">set</span>(k, v) 将第k位变成v</span><br><span class="line">  <span class="built_in">reset</span>() 把所有位变成<span class="number">0</span></span><br><span class="line">  <span class="built_in">flip</span>() 等价于~</span><br><span class="line">  <span class="built_in">flip</span>(k) 把第k位取反</span><br></pre></td></tr></table></figure>
<h2 id="一般哈希"><a href="#一般哈希" class="headerlink" title="一般哈希"></a>一般哈希</h2><p>(1) 拉链法</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">int</span> h[N], e[N], ne[N], idx;</span><br><span class="line"> <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;      <span class="comment">// 向哈希表中插入一个数</span></span><br><span class="line">     <span class="keyword">int</span> k = (x % N + N) % N;</span><br><span class="line">     e[idx] = x;</span><br><span class="line">     ne[idx] = h[k];</span><br><span class="line">     h[k] = idx ++ ;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="function"><span class="keyword">bool</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;   <span class="comment">// 在哈希表中查询某个数是否存在</span></span><br><span class="line">     <span class="keyword">int</span> k = (x % N + N) % N;</span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">int</span> i = h[k]; i != <span class="number">-1</span>; i = ne[i])</span><br><span class="line">       <span class="keyword">if</span> (e[i] == x)</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">     <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>(2) 开放寻址法</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> h[N];</span><br><span class="line"><span class="comment">// 如果x在哈希表中，返回x的下标；如果x不在哈希表中，返回x应该插入的位置</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">   <span class="keyword">int</span> t = (x % N + N) % N;</span><br><span class="line">   <span class="keyword">while</span> (h[t] != null &amp;&amp; h[t] != x)&#123;</span><br><span class="line">     t ++ ;</span><br><span class="line">     <span class="keyword">if</span> (t == N) t = <span class="number">0</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> t;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="背包"><a href="#背包" class="headerlink" title="背包"></a>背包</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> nValue,nKind;</span><br><span class="line"> <span class="comment">//0-1 背包，代价为 cost, 获得的价值为 weight</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ZeroOnePack</span><span class="params">(<span class="keyword">int</span> cost,<span class="keyword">int</span> weight)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=nValue;i&gt;=cost;i−−)</span><br><span class="line"> 		dp[i]=<span class="built_in">max</span>(dp[i],dp[i−cost]+weight);</span><br><span class="line">&#125;</span><br><span class="line"> <span class="comment">//完全背包，代价为 cost, 获得的价值为 weight</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CompletePack</span><span class="params">(<span class="keyword">int</span> cost,<span class="keyword">int</span> weight)</span></span>&#123;</span><br><span class="line"> 	<span class="keyword">for</span>(<span class="keyword">int</span> i=cost;i&lt;=nValue;i++)</span><br><span class="line">		dp[i]=<span class="built_in">max</span>(dp[i],dp[i−cost]+weight);</span><br><span class="line">&#125;</span><br><span class="line"> <span class="comment">//多重背包</span></span><br><span class="line"> <span class="function"><span class="keyword">void</span> <span class="title">MultiplePack</span><span class="params">(<span class="keyword">int</span> cost,<span class="keyword">int</span> weight,<span class="keyword">int</span> amount)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(cost*amount&gt;=nValue) <span class="built_in">CompletePack</span>(cost,weight);</span><br><span class="line"> 	<span class="keyword">else</span>&#123;</span><br><span class="line"> 		<span class="keyword">int</span> k=<span class="number">1</span>;</span><br><span class="line"> 		<span class="keyword">while</span>(k&lt;amount)&#123;</span><br><span class="line">            <span class="built_in">ZeroOnePack</span>(k*cost,k*weight);</span><br><span class="line">            amount−=k;</span><br><span class="line">            k&lt;&lt;=<span class="number">1</span>;</span><br><span class="line"> 		&#125;</span><br><span class="line"> 		<span class="built_in">ZeroOnePack</span>(amount*cost,amount*weight);<span class="comment">//这个不要忘记了，经常掉了</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//分组背包：</span></span><br><span class="line"><span class="keyword">for</span> k = <span class="number">1</span> to K</span><br><span class="line">    <span class="keyword">for</span> v = V to <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> item i in group k</span><br><span class="line">        	F[v] = maxF[v],F[v-C[i]]+W</span><br><span class="line"></span><br></pre></td></tr></table></figure>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E5%9F%BA%E7%A1%80%E7%AE%97%E6%B3%95/" rel="tag"># 基础算法</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item"></div>
      <div class="post-nav-item">
    <a href="/2021/11/12/%E6%91%86%E7%83%82%E9%A2%98%E5%8D%95/" rel="next" title="摆烂题单">
      摆烂题单 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="nav-number">1.</span> <span class="nav-text">数据结构</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B9%B6%E6%9F%A5%E9%9B%86"><span class="nav-number">1.1.</span> <span class="nav-text">并查集</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%9C%B4%E7%B4%A0%E5%B9%B6%E6%9F%A5%E9%9B%86%EF%BC%9A"><span class="nav-number">1.1.1.</span> <span class="nav-text">(1)朴素并查集：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E7%BB%B4%E6%8A%A4size%E7%9A%84%E5%B9%B6%E6%9F%A5%E9%9B%86%EF%BC%9A"><span class="nav-number">1.1.2.</span> <span class="nav-text">(2)维护size的并查集：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E7%BB%B4%E6%8A%A4%E5%88%B0%E7%A5%96%E5%AE%97%E8%8A%82%E7%82%B9%E8%B7%9D%E7%A6%BB%E7%9A%84%E5%B9%B6%E6%9F%A5%E9%9B%86%EF%BC%9A"><span class="nav-number">1.1.3.</span> <span class="nav-text">(3)维护到祖宗节点距离的并查集：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A0%86"><span class="nav-number">1.2.</span> <span class="nav-text">堆</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BA%BF%E6%AE%B5%E6%A0%91"><span class="nav-number">1.3.</span> <span class="nav-text">线段树</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#pushup-amp-amp-pushdown-%E7%B1%BB"><span class="nav-number">1.3.1.</span> <span class="nav-text">pushup &amp;&amp; pushdown 类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BB%BA%E6%A0%91-%E7%B1%BB"><span class="nav-number">1.3.2.</span> <span class="nav-text">建树 类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%95%E7%82%B9%E4%BF%AE%E6%94%B9-%E7%B1%BB"><span class="nav-number">1.3.3.</span> <span class="nav-text">单点修改 类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8C%BA%E9%97%B4%E6%B1%82%E5%92%8C-%E7%B1%BB"><span class="nav-number">1.3.4.</span> <span class="nav-text">区间求和 类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8C%BA%E9%97%B4%E6%9F%A5%E8%AF%A2-%E7%B1%BB"><span class="nav-number">1.3.5.</span> <span class="nav-text">区间查询 类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%AB%E6%8F%8F%E7%BA%BF-%E7%B1%BB"><span class="nav-number">1.3.6.</span> <span class="nav-text">扫描线 类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%8B%E9%A2%98"><span class="nav-number">1.3.7.</span> <span class="nav-text">例题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Luogu-P2572-SCOI2010-%E5%BA%8F%E5%88%97%E6%93%8D%E4%BD%9C"><span class="nav-number">1.3.7.1.</span> <span class="nav-text">Luogu P2572 [SCOI2010] 序列操作</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%80%E5%A4%A7%E5%AD%90%E6%AE%B5%E5%92%8C"><span class="nav-number">1.3.7.2.</span> <span class="nav-text">最大子段和</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BA%BF%E6%AE%B5%E6%A0%91%E4%B8%8A%E5%B7%AE%E5%88%86"><span class="nav-number">1.3.7.3.</span> <span class="nav-text">线段树上差分</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RMQ-%E5%8C%BA%E9%97%B4%E6%9C%80%E5%80%BC%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.4.</span> <span class="nav-text">RMQ 区间最值查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A2%84%E5%A4%84%E7%90%86-O-nlogn"><span class="nav-number">1.4.1.</span> <span class="nav-text">预处理         $O(nlogn)$</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2-O-1"><span class="nav-number">1.4.2.</span> <span class="nav-text">查询        $O(1)$</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BB%E5%B8%AD%E6%A0%91-%E5%8C%BA%E9%97%B4%E7%AC%ACK%E5%B0%8F%E6%95%B0"><span class="nav-number">1.5.</span> <span class="nav-text">主席树 - 区间第K小数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Splay"><span class="nav-number">1.6.</span> <span class="nav-text">Splay</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%8B%E9%A2%98%EF%BC%9A%E9%83%81%E9%97%B7%E7%9A%84%E5%87%BA%E7%BA%B3%E5%91%98"><span class="nav-number">1.6.1.</span> <span class="nav-text">例题：郁闷的出纳员</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Splay%E6%A0%91%E4%B8%8A%E5%90%88%E5%B9%B6"><span class="nav-number">1.6.2.</span> <span class="nav-text">Splay树上合并</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-number">2.</span> <span class="nav-text">字符串</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#KMP"><span class="nav-number">2.1.</span> <span class="nav-text">KMP</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%8B%E6%A0%87%E4%BB%8E-1-%E5%BC%80%E5%A7%8B"><span class="nav-number">2.1.1.</span> <span class="nav-text">下标从 1 开始</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%8B%E6%A0%87%E4%BB%8E-0-%E5%BC%80%E5%A7%8B"><span class="nav-number">2.1.2.</span> <span class="nav-text">下标从 0 开始</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Trie"><span class="nav-number">2.2.</span> <span class="nav-text">Trie</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%93%88%E5%B8%8C"><span class="nav-number">2.3.</span> <span class="nav-text">字符串哈希</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Ex-KMP"><span class="nav-number">2.4.</span> <span class="nav-text">Ex - KMP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Manacher"><span class="nav-number">2.5.</span> <span class="nav-text">Manacher</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%8E%E7%BC%80%E6%95%B0%E7%BB%84"><span class="nav-number">2.6.</span> <span class="nav-text">后缀数组</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%8E%E7%BC%80%E6%95%B0%E7%BB%84%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">2.6.1.</span> <span class="nav-text">后缀数组应用场景</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%8E%E7%BC%80%E8%87%AA%E5%8A%A8%E6%9C%BA"><span class="nav-number">2.7.</span> <span class="nav-text">后缀自动机</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9D%BF"><span class="nav-number">2.7.1.</span> <span class="nav-text">板</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%8B%E9%A2%98-1"><span class="nav-number">2.7.2.</span> <span class="nav-text">例题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%80%E9%95%BF%E5%85%AC%E5%85%B1%E5%89%8D%E7%BC%80"><span class="nav-number">2.7.2.1.</span> <span class="nav-text">最长公共前缀</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%80%E9%95%BF%E5%85%AC%E5%85%B1%E5%AD%90%E4%B8%B2"><span class="nav-number">2.7.2.2.</span> <span class="nav-text">最长公共子串</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2022%E7%89%9B%E5%AE%A23-H-Hacker"><span class="nav-number">2.7.2.3.</span> <span class="nav-text">2022牛客3 H - Hacker</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%AE%A1%E7%AE%97%E5%87%A0%E4%BD%95"><span class="nav-number">3.</span> <span class="nav-text">计算几何</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%82%B9%E3%80%81%E7%BA%BF%E3%80%81%E5%87%B8%E5%8C%85%E3%80%81%E5%9C%86%E3%80%81%E4%B8%89%E7%BB%B4%E7%82%B9%E3%80%81%E4%B8%89%E7%BB%B4%E7%BA%BF%E3%80%81%E4%B8%89%E7%BB%B4%E5%B9%B3%E9%9D%A2"><span class="nav-number">3.1.</span> <span class="nav-text">点、线、凸包、圆、三维点、三维线、三维平面</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%87%B8%E5%8C%85%E6%97%8B%E8%BD%AC%E5%8D%A1%E5%A3%B3%E6%B1%82%E5%AE%BD%E5%BA%A6%E7%94%A8%E6%B3%95"><span class="nav-number">3.2.</span> <span class="nav-text">凸包旋转卡壳求宽度用法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%89%AB%E6%8F%8F%E7%BA%BF"><span class="nav-number">3.3.</span> <span class="nav-text">扫描线</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9A%B4%E5%8A%9B"><span class="nav-number">3.3.1.</span> <span class="nav-text">暴力</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BA%BF%E6%AE%B5%E6%A0%91%E6%89%AB%E6%8F%8F%E7%BA%BF"><span class="nav-number">3.3.2.</span> <span class="nav-text">线段树扫描线</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9B%BE%E8%AE%BA"><span class="nav-number">4.</span> <span class="nav-text">图论</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8B%93%E6%89%91%E6%8E%92%E5%BA%8F"><span class="nav-number">4.1.</span> <span class="nav-text">拓扑排序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A0%86%E4%BC%98%E5%8C%96Dijkstra"><span class="nav-number">4.2.</span> <span class="nav-text">堆优化Dijkstra</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E5%B1%82%E5%9B%BE"><span class="nav-number">4.2.1.</span> <span class="nav-text">分层图</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SPFA"><span class="nav-number">4.3.</span> <span class="nav-text">SPFA</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A4%E8%B4%9F%E7%8E%AF"><span class="nav-number">4.3.1.</span> <span class="nav-text">判负环</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%80%E5%B0%8F%E7%94%9F%E6%88%90%E6%A0%91"><span class="nav-number">4.4.</span> <span class="nav-text">最小生成树</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Kruskal"><span class="nav-number">4.4.1.</span> <span class="nav-text">Kruskal</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Prim"><span class="nav-number">4.4.2.</span> <span class="nav-text">Prim</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E5%88%86%E5%9B%BE"><span class="nav-number">4.5.</span> <span class="nav-text">二分图</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%93%E8%89%B2"><span class="nav-number">4.5.1.</span> <span class="nav-text">染色</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8C%88%E7%89%99%E5%88%A9%E7%AE%97%E6%B3%95"><span class="nav-number">4.5.2.</span> <span class="nav-text">匈牙利算法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#LCA"><span class="nav-number">4.6.</span> <span class="nav-text">LCA</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Tarjan-%E7%A6%BB%E7%BA%BF"><span class="nav-number">4.6.1.</span> <span class="nav-text">Tarjan 离线</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%80%8D%E5%A2%9E"><span class="nav-number">4.6.2.</span> <span class="nav-text">倍增</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%91%E5%89%96"><span class="nav-number">4.6.3.</span> <span class="nav-text">树剖</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Tarjan-%E6%B1%82%E5%BC%BA%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F"><span class="nav-number">4.7.</span> <span class="nav-text">Tarjan 求强连通分量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E6%B5%81"><span class="nav-number">4.8.</span> <span class="nav-text">网络流</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#EK%E6%B1%82%E6%9C%80%E5%A4%A7%E6%B5%81"><span class="nav-number">4.8.1.</span> <span class="nav-text">EK求最大流</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#dinic%E6%B1%82%E6%9C%80%E5%A4%A7%E6%B5%81"><span class="nav-number">4.8.2.</span> <span class="nav-text">dinic求最大流</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%99%9A%E6%A0%91"><span class="nav-number">4.9.</span> <span class="nav-text">虚树</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#P2495-SDOI2011-%E6%B6%88%E8%80%97%E6%88%98"><span class="nav-number">4.9.1.</span> <span class="nav-text">P2495 [SDOI2011] 消耗战</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2022%E6%9D%AD%E7%94%B5%E5%A4%9A%E6%A0%A12-A-Static-query-on-tree"><span class="nav-number">4.9.2.</span> <span class="nav-text">2022杭电多校2 A - Static query on tree</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A0%91%E9%93%BE%E5%89%96%E5%88%86"><span class="nav-number">4.10.</span> <span class="nav-text">树链剖分</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%82%B9%E6%9D%83"><span class="nav-number">4.10.1.</span> <span class="nav-text">点权</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BE%B9%E6%9D%83"><span class="nav-number">4.10.2.</span> <span class="nav-text">边权</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%95%B0%E5%AD%A6"><span class="nav-number">5.</span> <span class="nav-text">数学</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B4%A0%E6%95%B0"><span class="nav-number">5.1.</span> <span class="nav-text">素数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BA%BF%E6%80%A7%E7%AD%9B"><span class="nav-number">5.1.1.</span> <span class="nav-text">线性筛</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%86%E8%A7%A3%E8%B4%A8%E5%9B%A0%E6%95%B0"><span class="nav-number">5.2.</span> <span class="nav-text">分解质因数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B1%82%E7%BA%A6%E6%95%B0"><span class="nav-number">5.3.</span> <span class="nav-text">求约数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B1%82%E6%AC%A7%E6%8B%89%E5%87%BD%E6%95%B0"><span class="nav-number">5.4.</span> <span class="nav-text">求欧拉函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AD%9B%E6%B3%95%E6%B1%82%E6%AC%A7%E6%8B%89%E5%87%BD%E6%95%B0"><span class="nav-number">5.5.</span> <span class="nav-text">筛法求欧拉函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%89%A9%E6%AC%A7"><span class="nav-number">5.6.</span> <span class="nav-text">扩欧</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%AB%98%E6%96%AF%E6%B6%88%E5%85%83"><span class="nav-number">5.7.</span> <span class="nav-text">高斯消元</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B1%82%E7%BB%84%E5%90%88%E6%95%B0"><span class="nav-number">5.8.</span> <span class="nav-text">求组合数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%92%E5%BD%92"><span class="nav-number">5.8.1.</span> <span class="nav-text">递归</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A2%84%E5%A4%84%E7%90%86%E9%80%86%E5%85%83%E6%B1%82%E7%BB%84%E5%90%88%E6%95%B0"><span class="nav-number">5.8.2.</span> <span class="nav-text">预处理逆元求组合数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%94%99%E6%8E%92%E5%85%AC%E5%BC%8F"><span class="nav-number">5.8.3.</span> <span class="nav-text">错排公式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%A2%E5%8D%A1%E6%96%AF%E5%AE%9A%E7%90%86"><span class="nav-number">5.9.</span> <span class="nav-text">卢卡斯定理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%A1%E7%89%B9%E5%85%B0%E6%95%B0"><span class="nav-number">5.10.</span> <span class="nav-text">卡特兰数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BF%AB%E9%80%9F%E5%B9%82"><span class="nav-number">5.11.</span> <span class="nav-text">快速幂</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%9A%E5%BC%88"><span class="nav-number">5.12.</span> <span class="nav-text">博弈</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B7%B4%E4%BB%80%E5%8D%9A%E5%A5%95"><span class="nav-number">5.12.1.</span> <span class="nav-text">巴什博奕</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A8%81%E4%BD%90%E5%A4%AB%E5%8D%9A%E5%BC%88"><span class="nav-number">5.12.2.</span> <span class="nav-text">威佐夫博弈</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Nim%E5%8D%9A%E5%BC%88"><span class="nav-number">5.12.3.</span> <span class="nav-text">Nim博弈</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Fibonacci%E5%8D%9A%E5%BC%88"><span class="nav-number">5.12.4.</span> <span class="nav-text">Fibonacci博弈</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-SAT"><span class="nav-number">5.13.</span> <span class="nav-text">2-SAT</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9D%82%E9%A1%B9"><span class="nav-number">6.</span> <span class="nav-text">杂项</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F"><span class="nav-number">6.1.</span> <span class="nav-text">归并排序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%AB%98%E7%B2%BE%E5%BA%A6"><span class="nav-number">6.2.</span> <span class="nav-text">高精度</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E7%B2%BE%E5%8A%A0%E6%B3%95"><span class="nav-number">6.2.1.</span> <span class="nav-text">高精加法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E7%B2%BE%E5%87%8F%E6%B3%95"><span class="nav-number">6.2.2.</span> <span class="nav-text">高精减法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E7%B2%BE%E4%B9%98%E6%B3%95"><span class="nav-number">6.2.3.</span> <span class="nav-text">高精乘法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E7%B2%BE%E9%99%A4%E6%B3%95"><span class="nav-number">6.2.4.</span> <span class="nav-text">高精除法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BE%93%E5%87%BA"><span class="nav-number">6.2.5.</span> <span class="nav-text">输出</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E5%88%86"><span class="nav-number">6.3.</span> <span class="nav-text">二分</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B4%E6%95%B0%E4%BA%8C%E5%88%86"><span class="nav-number">6.3.1.</span> <span class="nav-text">整数二分</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B5%AE%E7%82%B9%E4%BA%8C%E5%88%86"><span class="nav-number">6.3.2.</span> <span class="nav-text">浮点二分</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E7%BC%80%E5%92%8C"><span class="nav-number">6.4.</span> <span class="nav-text">前缀和</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E7%BB%B4"><span class="nav-number">6.4.1.</span> <span class="nav-text">一维</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8C%E7%BB%B4"><span class="nav-number">6.4.2.</span> <span class="nav-text">二维</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B7%AE%E5%88%86"><span class="nav-number">6.5.</span> <span class="nav-text">差分</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E7%BB%B4-1"><span class="nav-number">6.5.1.</span> <span class="nav-text">一维</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8C%E7%BB%B4-1"><span class="nav-number">6.5.2.</span> <span class="nav-text">二维</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%8D%E8%BF%90%E7%AE%97"><span class="nav-number">6.6.</span> <span class="nav-text">位运算</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#STL"><span class="nav-number">6.7.</span> <span class="nav-text">STL</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E8%88%AC%E5%93%88%E5%B8%8C"><span class="nav-number">6.8.</span> <span class="nav-text">一般哈希</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%83%8C%E5%8C%85"><span class="nav-number">6.9.</span> <span class="nav-text">背包</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Reza Kung</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">15</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Reza Kung</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">68k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">1:02</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script size="300" alpha="0.6" zIndex="-1" src="/lib/canvas-ribbon/canvas-ribbon.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

  
  <script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
  
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>

    <canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" ></canvas> 
    <script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script> 
    <script type="text/javascript" src="/js/src/fireworks.js"></script>
    

</html>
